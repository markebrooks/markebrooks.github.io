XWiki.AnnotationSettings=Class.create({initialize:function(){this.addCheckboxListeners();this.addClearListeners();this.addToggleFilterVisibility(".criterion-label",".criterion","collapsed");this.addToggleFilterVisibility(".annotation-filters-toggler a",".annotation-filters","collapsed");document.fire("xwiki:annotations:filter:changed",this.getCurrentFilter())},addCheckboxListeners:function(){$$(".criteria input[type=checkbox]").each(function(A){A.observe("click",function(E){var C=this.getCurrentFilter();document.fire("xwiki:annotations:filter:changed",C);var B=E.element();B.up().toggleClassName("selected");var D=B.up(".criterion");if(D.select("label.selected").size()>0){D.addClassName("active")}else{D.removeClassName("active")}}.bindAsEventListener(this))},this)},addClearListeners:function(){$$(".criterion .clear").each(function(A){A.observe("click",function(D){D.stop();var C=D.element().up(".criterion");C.select("label.selected").each(function(E){E.removeClassName("selected");E.down("input").checked=false});C.removeClassName("active");var B=this.getCurrentFilter();document.fire("xwiki:annotations:filter:changed",B)}.bindAsEventListener(this))},this)},getCurrentFilter:function(){var A=[];$$(".criteria .criterion").each(function(E){var D=E.down("input[type=hidden]");if(!D){return }D=D.name;var B=[];E.select("input[type=checkbox]").each(function(F){if(F.checked){B.push(F.value)}});for(var C=0;C<B.length;C++){A.push({"name":D,"value":B[C]})}});return A},addToggleFilterVisibility:function(B,C,A){$$(B).each(function(D){D.observe("click",function(F){F.stop();var E=F.element().up(C);if(E){E.toggleClassName(A)}})})}});document.observe("xwiki:annotations:settings:loaded",function(){new XWiki.AnnotationSettings()})
