<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Background and Rationale (Community Group tools.rationale) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Community+Group+tools/rationale" />
                    <link rel="canonical" href="/bin/view/Community+Group+tools/rationale" />
                            <meta name="document" content="Community Group tools.rationale"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Community Group tools"/>
    <meta name="page" content="rationale"/>
    <meta name="version" content="1.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Community+Group+tools/pages/rationale"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Background and Rationale" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="admin" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Community Group tools";
XWiki.currentPage = "rationale";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Community+Group+tools/rationale";
window.docediturl = "/bin/edit/Community+Group+tools/rationale";
window.docsaveurl = "/bin/save/Community+Group+tools/rationale";
window.docgeturl = "/bin/get/Community+Group+tools/rationale";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Community_Group_tools viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FCommunity%2BGroup%2Btools%2Frationale"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+tools/"><strong>Community Group tools</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Community+Group+tools" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
            </td>
            <td id="logo-text" style="width: 1%;">
                Solaris
            </td>         
            <td style="width: 98%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Community+Group+tools/gcc'>GCC</a> <span class='separator'>&#187;</span> <span class='current'>Background and Rationale</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Community+Group+tools/rationale?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/rationale?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/rationale?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/rationale?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+tools/rationale?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/rationale?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/rationale?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/rationale?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/rationale?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/rationale?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Community+Group+tools/rationale?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Community+Group+tools/rationale?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Background and Rationale</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h2 id="Hgcc:BackgroundandRationale"><span>gcc: Background and Rationale</span></h2><pre>

Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
Use is subject to license terms.

ident	"@(#)d-compilers.txt	1.7	06/03/17 SMI"

OpenSolaris
SUPPORTED COMPILER POLICY, V1 [DRAFT 2]

1.  Summary

    This policy defines that the OpenSolaris build process for the ON
    consolidation will introduce the concept of primary and secondary
    supported compilers.  Compilation cleanliness across all supported
    compilers is a requirement for committing a changeset to ON.
    ON will support the Sun Studio compiler as the primary compiler on
    current platforms and the GCC compiler as the secondary compiler.
    Constraints on the implementation of this policy are identified.
    Specific exceptions for changesets affecting C++ source files are
    defined.

    Management of coding conventions is described in cases of
    different valid language interpretations within the set of
    supported compilers.  Conventions are established for
    functionality requiring knowledge of compiler behaviour and
    output, beyond that embodied in existing language and platform
    standards.

2.  Discussion

    There are a number of arguments that might be made for supporting
    multiple compilers for the ON consolidation; the principal reasons
    to support the GCC compiler specifically include

    - decreased service costs, as distinct compiler execution can
      identify potential defects prior to release to users [0],

    - decreased porting costs due to compiler unavailability, and

    - potential defect elimination from GCC-derived automatic code
      examination systems [1, 2]

    This policy recognizes that there is an additional intangible
    benefit from supporting toolsets common across numerous software
    development communities.  This policy can be implemented so that
    the benefits are maintained with no significant increase in active
    developer time expended; see the Implementation Addendum [3].

2.1.  Potential support scenarios

    There are three levels of support we can require for gcc on each
    platform; the levels are described here with the requirements they
    impose on engineers and the C-team as well as any additional
    resource requirements.  In all scenarios, ON source, build tools,
    and processes may be modified to minimize developer intervention
    times.  See the Implementation Addendum for details.

    1.  Full support.  Require testing equally with both compilers on
	all applicable platforms.  In this scenario, any putback that
	introduces compiler dependent differences other than
	differential runtime performance will be backed out.
	Gatekeepers will need to perform both incremental and full
	nightly builds using both compilers, and make both sets of
	archives available to developers and users.  A mechanism will
	be required to distinguish between these sets of archives both
	at runtime and in cores and crash dumps.  Projects will have
	to provide test results for both compilers as part of the
	integration criteria.  This requirement increases (by about
	70% at present) build time requirements for all putbacks and
	gate builds.  It also increases (by 100%) testing requirements
	for all putbacks and administrative overhead associated with
	tracking test plans and status for all projects.  This would
	likely require substantial additional build and test hardware.

    2.  Build-only support.  Require only that ON build with both
	compilers.  Runtime behaviour differences will not be cause
	for backout; however, these differences will constitute bugs
	as they are often serious violations of standards anyway.
	These bugs will be prioritized like all others in accordance
	with business needs.  Gatekeepers will need to perform both
	incremental and full nightly builds with both compilers;
	gcc-built archives need not be made available, and no
	expectation of their correctness can be established.  Projects
	will need to show that they build with gcc but need not
	provide duplicate results for other tests.  Costs include
	build time increases as for (1) and possible additional build
	machine requirements as for (1).  Several possible
	implementations are presented in the Implementation Addendum,
	and their relative costs and benefits are described there in
	detail.

	Owing to the distinct C++ ABIs across the primary and
	secondary compilers, projects modifying C++ code must perform
	actions equivalent to those outlined in (1), including
	sufficient testing to verify that both runtime and link-time
	dependencies are satisfied by the objects built by both
	compilers.

    3.  One-shot.  Require nothing; gcc support will be maintained on
	an ad-hoc basis.  Build and runtime breakage reports will be
	considered RFEs.  There are no requirements for project teams
	nor for the C-team, and no ongoing costs since no one will be
	expected to find or fix gcc breakage.  However, as soon as
	code that breaks the gcc build is introduced, the gcc QDS
	begins and our efforts would have little long-term impact.

    In principle, SPARC and x86 could have different levels of support
    on temporary or permanent bases.  As an interim milestone,
    building with nonfatal warnings on either platform could be
    supported to encourage and ease fixing of remaining bugs, most of
    which are for warnings.  Additionally, current and future
    supported platforms could identify different primary-secondary
    compiler pairs.

2.2.  Proposed scenario and implementation thereof

    The proposed scenario is to require build-only support.  The
    expectation is that there will be sufficient interest in an
    alternative compiler on one or more supported platforms to manage
    the defect introduction rate not covered by the first-pass
    verification.  Tools and source changes will be introduced to make
    possible a standard invocation that executes a "complete" build in
    this sense.  The Implementation Addendum describes several
    possible implementations.  *WE ARE RECOMMENDING OPTION 1, SHADOW
    COMPILATION.*

2.2.1.  Consequences

    A consequence of this strategy is that separate testing of builds
    made with both compilers is not required at any time; all relevant
    tests must be run against the primary compiler build.  This choice
    reduces greatly the resource commitments that full support would
    require, to a level believed sustainable.  Since elevating from
    build-only to full support at some future time would have a
    relatively low one-time cost, our options remain open if we
    determine that a Studio exit strategy is required.  Such an exit
    strategy is neither the effect of nor the motivation for this
    proposal.

2.2.2.  Constraints

    Although the implementation is not expected to produce an
    executable proto area, package set, or archives from the secondary
    compiler's output, the tools are expected to allow swapping the
    primary and secondary compiler roles such that the full set of
    build products can be constructed using either compiler.
    Incremental builds that produce working bits with the primary
    compiler must remain possible and generate correct bits even after
    any secondary compiler pass executes.

2.2.3.  Timeline

    Each architecture requires a different amount of work before the
    baseline requirement will be met in onnv.  Code built into amd64
    objects already offers full support for gcc, although its
    correctness can no longer be certain since the default amd64
    compiler was changed from gcc to cc.  Code built into i386, sparc,
    and sparcv9 objects requires some changes, mainly in generic
    userland code, before build-only support will be provided.
    Although sparc and sparcv9 code was initially at a substantial
    disadvantage with respect to gcc support, this gap has been almost
    entirely eliminated.  In the interest of expediency, all
    architectures will be made fully build-clean prior to or
    simultaneous with this policy's effectiveness and the introduction
    of tools changes required to support it.

2.3.  Language ambiguity management

    In the process of pursuing an initial clean state, a number of
    standard differences between the compiler pair have been identified.
    A reasonable partition of these differences is into two sets:

	(a). Unsafe implementation: One compiler or the other is
	defective; that is, it fails to adhere to relevant published
	standards or documented behaviour, emits output which is
	semantically different from its input, or fails to accept
	unambiguous valid input.

	(b). Local convention: An architecture's secondary compiler
	rejects input which is acceptable by the primary compiler and
	is considered valid according to local conventions, even
	though the code's behaviour is undefined or unspecified by
	standards.  These differences generally involve implementation
	choices where the language standard is ambiguous.

2.3.1.  Unsafe implementation

    A recent example of the secondary compiler emitting unsafe code is

    6362144 gcc breaks libc by turning structure assignments into
            calls to memcpy()

    For such cases, while the release team may choose to identify a
    clarified coding convention (such as explicit member assignment for
    the example), the correct outcome is to engage with the compiler
    vendor or our designate to same to secure a fix for the unsafe
    behavior.

    Project teams may not generally be blocked from putback by unsafe
    secondary compiler implementation exposed by their correct code.
    While the release team may direct otherwise, it is expected that
    project teams in this position will generally take the following
    actions:

	1. File a high-priority defect against the secondary compiler.

	2. Modify makefiles, flags, or other infrastructure so as to
	avoid triggering any compile-time warnings or errors generated
	by the secondary compiler as a result of its unsafe
	implementation.

	3. Document for ON developers the differences, if known,
	between each compiler's output as they affect user- or
	developer-visible functionality delivered by their project.

2.3.2.  Local convention

    The bulk of the differences have been where the secondary compiler
    has found the previous local convention, which may merely derive
    from the primary compiler's defaults, to be ambiguous.  For
    example:

    6367203 Studio 10 C compiler and gcc 3.4.3 disagree about
	    preprocessing #pragma redefine_extname

    In such cases, the release team should examine the choices before
    them: they may either propose to abandon the local convention and
    require an unambiguous invocation, or engage with the secondary
    compiler vendor or our designate to same to secure a fix that
    introduces an option to accept the local convention as
    unambiguous.  The proposal should weigh the costs associated with
    the change, including vendor costs, the absolute number of
    affected sites within the code, and the general acceptance of the
    local convention.  If the release team elects to pursue a change
    to the secondary compiler, an affected project team will, subject
    to the release team's direction, take actions similar to those
    described in 2.3.1.

2.4.  Compiler Implementation Knowledge

    Projects which are directly or indirectly tied to the compiler
    used to build ON will be expected to function properly when built
    with the secondary compiler.  In particular, mdb, the CTF
    infrastructure, DTrace, and other similar tools and libraries must
    behave substantially the same way regardless of the compiler used
    to build them.  This requirement is intended to apply specifically
    to tools with intimate knowledge of compiler artifacts above and
    beyond that provided by standards such as an ISA's ABI or a
    published debugging format standard.  In some cases, this
    requirement may be waived for business or technical reasons if the
    following are true:

	(a) There is substantial marginal cost associated with
	delivering an implementation compatible with the secondary
	compiler, and

	(b) There is no known or reasonably forseen build-time
	dependency on this functionality.  For example, if the project
	team delivers a utility with compiler-dependent knowledge, and
	the correct and complete output of that utility is required to
	complete a successful build of ON, this requirement cannot be
	waived.  This exception is not intended to apply to arbitrary
	code solely because it it executed during the build (e.g., a
	non-compiler-dependent tool built natively).

    If this requirement is waived, the project team is expected to
    deliver stubs for use when the project's functionality is built
    with the secondary compiler.  If the functionality consists of
    programs which would ordinarily be run interactively, these
    programs should print a message when run indicating that they are
    unavailable when built with the secondary compiler.  LIbrary
    interfaces should fail with an appropriate error return, and other
    interfaces should generally make a reasonable effort to inform
    callers or users of the reason for failure.  In particular,
    unpredictable output or program behaviour when built with the
    secondary compiler is not acceptable even if this requirement is
    waived.

    The release team may instead, after evaluating the relative costs
    and benefits, direct a project team delivering this type of
    functionality to request appropriate changes to the secondary
    compiler.

3.  Modified roles in proposed scenario

    Once all bugs preventing successful builds with gcc are are fixed,
    we will need to establish a clear set of guidelines for maintaining
    gcc compatibility within ON (and possibly in other consolidations as
    well).  Contributors in several roles will have additional
    responsibilities in support of these guidelines.

3.1.  ON C-Team

    The ON C-team will enforce build-only support across all supported
    architectures and platforms.  That is, changes are not acceptable
    which prevent using the C-team-approved version of gcc to
    successfully complete a full build for any supported architecture.
    However, implementations which simply disable compilation of a
    functional component or subdirectory when gcc is in use, without
    delivering alternate functionally equivalent code suitable for use
    with gcc, will not be considered to have fulfilled this
    requirement.  The gatekeepers will be responsible for monitoring
    compliance with this requirement and for backing out non-compliant
    changes or, at their option, coordinating timely corrections to
    non-compliant code.  Changes which fulfill the build requirement
    but introduce functional differences dependent on the compiler
    used may be acceptable, but such functional differences will, if
    discovered, be tracked and fixed as defects; such differences
    often result from violation of applicable standards or
    conventions.

    The C-team will also be required to evaluate differences between
    the primary and secondary compilers as discussed in sections 2.3
    and 2.4, to direct project teams encountering these differences,
    and to ensure that timely fixes to the secondary compiler are made
    as required.

3.2.  ON Implementors

    Implementors will be expected to understand compiler-dependent
    behaviours and the standards governing their operation, and to
    utilize that understanding toward the creation of portable,
    standards-compliant code.  They will also be expected to maintain
    tools such as the compiler wrapper used to support the use of
    multiple compilers, and to update those tools when their other
    changes require it.  Implementors will correct any alternate
    compiler specific build failures induced by their changes prior to
    putback.  Clear instructions for performing the necessary builds
    or passes will be disseminated by the Tonic team prior to these
    requirements becoming effective.

    The first pass proposal requires that implementors modifying C++
    files perform a complete build of the affected component and its
    dependents with both supported compilers.

4.  Acknowledgements

    Keith Wesolowski developed the initial version of this policy.
    Stephen Hahn clarified this policy and contributed the description
    of build-only support it proposes.

5.  References

[0] Of the 475 gcc defects (this count excludes those CRs which are
    actual RFEs or were closed without requiring a fix), at least 28
    are indisputable: the code violates an applicable de jure standard
    and/or de facto ON conventions, is semantically incorrect, works
    only because of undocumented and unreliable Studio behaviours that
    cannot reasonably be considered de facto ON/Studio conventions, or
    will be harmful to customers who use gcc (a supported feature of
    Solaris) even if we don't.  These 28 bugs are tangible evidence of
    code quality improvement demanded by the use of multiple
    compilers; many of these defects would be expected to affect
    customers.  Note that these defects still existed even after most
    common kernel and library code was fixed by the amd64 team, so the
    actual number of bugs was likely much higher.  The list of these
    serious bugs follows:

6254191 uninitialized variable in elfsignlib.c
6241993 SPARC siglongjump symbol aliasing is wrong
6241314 ctfconvert should understand SPARC real types in DWARF
6241287 g++ doesn't want wchar_t under any circumstances
6241296 kernel files must include sys/note.h rather than note.h
6277636 *sh* can crash if it creates too many temporary files
6358155 When compiled with gcc, the socal driver panic's the machine
6359607 kstat perl module compiled with gcc breaks on x86
6272173 cpumem diag module writes to constant memory, crashing fmd
6268345 fmd is insufficiently careful with alignment
6264775 lpadmin expects to write into string constants
6254408 many forthdebug templates are incorrect
6281909 bootadm writes into string constants
6281951 ikeadm writes into string constants
6280646 amd64 memlist structure mismatch causes panic
6277643 ksh is insufficiently careful with alignment
6274664 libcurses has an unterminated comment
6272179 relocation processing should be bypassed when building libgenunix et al
6272155 svcs writes into string constants, can crash as a result
6268299 libumem is insufficiently careful with alignment
6267468 rpcgen generated code gcc doesn't like
6267352 libld_malloc provides inadequate alignment
6267482 lex generates code gcc doesn't like
6266620 mi2cv shouldn't #include 
6264767 cfgadm expects to write into string constants
6264469 fbt is confused by jump tables in code
6264473 fbt is confused by the return instruction
6258738 fbt refuses to instrument functions starting with branches

[1] Andy Chou, Junfeng Yang, Benjamin Chelf, Seth Hallem, and Dawson
    Engler.  An Empirical Study of Operating System Errors.  Symposium on
    Operating System Principles, 2001.

[2] smatch, the Source Matcher.  http://smatch.sourceforge.net/

[3] OpenSolaris Supported Compiler Policy, Implementation Addendum.
    /net/tonic-gate.sfbay/gates/devproc/src/implementation/d-compilers-impl.txt

</pre>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:11<br/>
          </div>
    <div class="xdocLastModification">       Last modified by admin on 2009/10/26 12:11
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Community Group tools Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/building_opensolaris">Build/Install OpenSolaris (Part 1)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/building_opensolaris_part2">Build/Install OpenSolaris (Part 2)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/downloads">Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/files">Files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/gcc">GCC</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/bug_fixing_notes">Bug Fixing Notes</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/build_instr">Build Instructions</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/flagday">Important Notes</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/on_policy">ONNV Policy</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/rationale">Background and Rationale</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/shadow">Shadow Compilation</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/status">Current Status</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg">Mercurial Tools</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/linker">Dynamic Linking</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scm">OpenSolaris Source Code Management</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/bzr%2Deval">OpenSolaris DSCM Evaluation: Bzr (Interim Report)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/dcm_evaluation_mercurial">OpenSolaris DSCM Evaluation: Mercurial</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/dscmreqdoc">DSCM Requirements Document</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/evalform">Candidate Evaluation Form</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/evalplan">Evaluation Plan</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg_help">How To Use Mercurial (hg) Repositories</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg_teamware_transition">How To Transition from Teamware to Mercurial</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/history">SCM Project History</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/on%2Dscm%2Dtools">ON SCM&#45;Related Tools</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scm_milestone">Source Code Management for OpenSolaris: MILESTONES</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmconsolespec">SCM console specification</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmhostspec">SCM hosting implementation specification</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/svn_help">How To Use SVN Repositories</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmdownloads">Source Code Management Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_tools">Sun Studio Downloads</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/faqs">Sun Studio FAQs</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/getstarted">Sun Studio Getting Started</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sss11ent">Sun Studio 11 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sss12ent_license">Sun Studio 12 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sssent">Sun Studio 10 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_10_tools">Sun Studio 10 Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_11_tools">Sun Studio 11 Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_11_tools_previous">Sun Studio 11&#45;&#45; Previous Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_12_tools">Sun Studio 12 Compilers and Tools for the OpenSolaris Common Build Environment (CBE)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/support">Sun Studio Support</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/testing+nightly">testing nightly</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2012, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
