<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Bug Fixing Notes (Community Group tools.bug_fixing_notes) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Community+Group+tools/bug_fixing_notes" />
                    <link rel="canonical" href="/bin/view/Community+Group+tools/bug_fixing_notes" />
                            <meta name="document" content="Community Group tools.bug_fixing_notes"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Community Group tools"/>
    <meta name="page" content="bug_fixing_notes"/>
    <meta name="version" content="1.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Community+Group+tools/pages/bug_fixing_notes"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Bug Fixing Notes" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="admin" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Community Group tools";
XWiki.currentPage = "bug_fixing_notes";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Community+Group+tools/bug_fixing_notes";
window.docediturl = "/bin/edit/Community+Group+tools/bug_fixing_notes";
window.docsaveurl = "/bin/save/Community+Group+tools/bug_fixing_notes";
window.docgeturl = "/bin/get/Community+Group+tools/bug_fixing_notes";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Community_Group_tools viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FCommunity%2BGroup%2Btools%2Fbug_fixing_notes"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+tools/"><strong>Community Group tools</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Community+Group+tools" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
            </td>
            <td id="logo-text" style="width: 1%;">
                Solaris
            </td>         
            <td style="width: 98%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Community+Group+tools/gcc'>GCC</a> <span class='separator'>&#187;</span> <span class='current'>Bug Fixing Notes</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Community+Group+tools/bug_fixing_notes?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/bug_fixing_notes?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/bug_fixing_notes?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/bug_fixing_notes?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+tools/bug_fixing_notes?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/bug_fixing_notes?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/bug_fixing_notes?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/bug_fixing_notes?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/bug_fixing_notes?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/bug_fixing_notes?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Community+Group+tools/bug_fixing_notes?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Community+Group+tools/bug_fixing_notes?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Bug Fixing Notes</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h2 id="HCommonMistakesandHowtoFixThem"><span>Common Mistakes and How to Fix Them</span></h2><p>Most of the practices listed here are incorrect regardless of the compiler you<br/>use; gcc just happens to be very good at catching them and warning you. &nbsp;In<br/>fact gcc's warnings are more like lint's than a normal compiler's. &nbsp;And of<br/>course gcc can catch many errors which lint does not, or has been configured<br/>within ON to disregard.</p><p>-<del>-</del></p><p>So you've seen all the tonic-gcc bugs, and you're wondering what's the deal. Well, here it is: Tonic needs to be able to build with gcc, and our code currently upsets it. Mostly this is just making the code cleaner but gcc also catches a few bugs.</p><p>gcc is pretty good about telling you what's wrong, but here are the main types of problems we ran into:</p><ul><li>Implicit ints</li></ul><p>Old code sometimes treats int as optional (or left it off function declarations long before void existed). Such as:</p><pre>
    f(){}
</pre><pre>
    c.c:15: warning: return type defaults to 'int'
</pre><p>Or do:</p><pre>
    register i;
	
    c.c:16: warning: type defaults to 'int' in declaration of 'i'
</pre><p>These are easy, just add the int in the right place (and delete register, let the compiler optimize, if it even pays attention to that keyword).</p><ul><li>pointer&lt;-&gt;int assignments that aren't the same size</li></ul><p>There are a lot of places that assign pointers to ints (or the other way around) where they both aren't the same size. This can be bad as gcc seems to treat pointers as signed and might sign-extend the pointer:</p><pre>
    {mike_s:reliant:466} cat c.c
    #include &lt;stdio.h&gt;
    #include &lt;sys/types.h&gt;
    #include &lt;stdlib.h&gt;
    int
    main()
    {
            uint64_t        i;
            uint64_t        \*p;
            p = &amp;i;
            i = (uint64_t)p;
            (void) printf("p = %p\n", (void \*)p);
            (void) printf("i = %llx\n", i);
    }
    {mike_s:yavin:467} cc -o c c.c
    {mike_s:yavin:468} ./c
    p = ffbfedb8
    i = ffbfedb8
    {mike_s:yavin:469} gcc -o c c.c
    c.c: In function 'main':
    c.c:13: warning: cast from pointer to integer of different size
    {mike_s:yavin:470} ./c
    p = ffbfeda8
    i = ffffffffffbfeda8
</pre><p>This can be bad if the integer is expected to be a valid pointer still. &nbsp;Also note that lint doesn't catch this either:</p><pre>
    {mike_s:yavin:488} lint -s c.c
    {mike_s:yavin:489} lint -s -errchk=%all c.c
    {mike_s:yavin:490}
</pre><p>Though perhaps there is an option, or this is just because it matches the compiler's behavior and cc doesn't do this.</p><p>The fix for this is to have a uintptr_t cast in between. Or to rely on the compiler promoting a uintptr_t to uint64_t anyway and just cast the pointer to uintptr_t in the test program:</p><pre>
    {mike_s:yavin:537} cc -o c c.c
    {mike_s:yavin:538} ./c
    p = ffbfedb8
    i = ffbfedb8
    {mike_s:yavin:539} gcc -o c c.c
    {mike_s:yavin:540} ./c
    p = ffbfeda8
    i = ffbfeda8
</pre><ul><li>Functions that don't return something when they should</li></ul><p>gcc is pretty good about catching functions that fall off the end without returning something, or mix &amp; match return; and return (something), which is just wrong. Sometimes this is fallout from #1 above, where the function is really void but it's old and defaults to int because there was no void. Other times it is just a bug. And other times it's that the code really doesn't hit the end but gcc doesn't know that. Here is a simple example:</p><pre>
    {mike_s:yavin:611} cat c.c
    #include &lt;stdio.h&gt;
    #include &lt;sys/types.h&gt;
    #include &lt;stdlib.h&gt;
    static void
    usage(void)
    {
            (void) printf("you used me wrong\n");
            exit(1);
            /\* NOTREACHED \*/
    }
    int
    main()
    {
            usage();
            /\* NOTREACHED \*/
    }
</pre><pre>
    {mike_s:yavin:612} gcc -Wall -o c c.c
    c.c: In function 'main':
    c.c:19: warning: control reaches end of non-void function
</pre><p>gcc doesn't understand NOTREACHED, that's a lint directive (and actually lint doesn't seem to understand it well either since it still complains main has no return statement). But you can tell gcc a function doesn't return with the _\<em>NORETURN attribute attached to a prototype (see <span class="box code"><span style="color: #666666; ">&lt;</span>sys<span style="color: #666666; ">/</span>ccompile.h<span style="color: #666666; ">&gt;</span></span>). Add this after the includes:</em></p><pre>
    static void usage(void) \//~_NORETURN;
	
And gcc is happy:
</pre><pre>
    {mike_s:yavin:619} gcc -Wall -o c c.c
    {mike_s:yavin:620} 
</pre><p>Sometimes the right fix can be to add a 'default' case to a switch statement that doesn't have one. It is the last thing in the function, and all cases return, but the coder knew that he would never call the function with an argument the switch statement wouldn't handle. So no default was added and a NOTREACHED was put after the switch. That's (personally) a bad thing to do because someone else could come along and call it wrong, so it would seem better to have a default (failure) case or perhaps an assert added.</p><p>Sadly sometimes the last thing a function calls is something that takes an argument that makes it not return, but gcc can't be told that. Like a generic error printing routine that takes a 'fatal error call exit' flag. &nbsp;I have just added bogus returns in that case but perhaps someone can find a better way.</p><ul><li>Undefined order of operations</li></ul><p>gcc has caught a few bugs where the order of operations is undefined. &nbsp;For example, I have seen some function calls like this:</p><pre>
    f(i, i++);
</pre><p>this causes gcc to reply:</p><pre>
    c.c:16: warning: operation on 'i' may be undefined
</pre><p>because the order function arguments are evaluated is unspecified by the C standard. It may be left to right, like the programmer expected, or it may be right to left, or neither. &nbsp;This can also happen when an argument with side effects is passed to a macro that evaluates it twice. Or in assignments like this:</p><pre>
    i = i++;
</pre><pre>
    c.c:17: warning: operation on 'i' may be undefined
</pre><ul><li>Main functions defined as returning void</li></ul><p>main doesn't return void, it returns int, and gcc complains. &nbsp;So don't do that <img src="/resources/icons/silk/emoticon_smile.gif" class="wikimodel-freestanding" alt="emoticon_smile"/>&nbsp;And don't forget that it may then want main to return something (or lint may) so if you have an exit at the end that can just be a return.</p><ul><li>Extra tokens after preprocessor directives</li></ul><p>This is usually for #else and #endif directives. Don't do this:</p><pre>
    #ifdef DEBUG
    ...
    #else DEBUG
    ...
    #endif DEBUG
</pre><p>do this:</p><pre>
    #ifdef DEBUG
    ...
    #else /\* DEBUG \*/
    ...
    #endif /\* DEBUG \*/
</pre><ul><li>Writing into string constants.</li></ul><p>gcc puts puts string constants in read-only memory because, well, they are constant. Unfortunately some code writes into string constants because Studio doesn't do that by default (see -xstrconst). &nbsp;Sadly this is not something found by compilation but only by testing, and we know of a few:</p><ul><li><ul><li>6264767 cfgadm expects to write into string constants</li><li>6264775 lpadmin expects to write into string constants</li><li>6272155 svcs writes into string constants, can crash as a result</li></ul></li></ul><p>There is a flag that can be used to have gcc make string constants non-constant (-fwritable-strings), and we do (sadly) use it. But note what it says:</p><pre>
    {mike_s:yavin:683} /usr/sfw/bin/gcc -Wall -fwritable-strings -o c c.c
    cc1: note: -fwritable-strings is deprecated; see documentation for details
</pre><p>And in gcc 4.0 guess what:</p><pre>
    {mike_s:yavin:684} gcc -Wall -fwritable-strings -o c c.c
    cc1: error: unrecognized command line option "-fwritable-strings"
</pre><p>Code that wants to write to constants should just be fixed. &nbsp;Using -xstrconst in the CFLAGS may also help catch these in testing sooner. &nbsp;You can use the gcc flag -Wwrite-strings to help you find these bugs, but unfortunately it's too noisy to be useful all the time; any nontrivial code is likely to trigger a few of these.</p><ul><li>Incorrect format strings</li></ul><p>Format strings need to correspond to the types being passed, otherwise &nbsp;gcc complains. &nbsp;Common problems are:</p><ul><li><ul><li>Using <span class="box code"><span style="font-weight: italic; color: #408080; ">%p</span></span> corresponding to an argument which is not a pointer.</li><li>Using <span class="box code"><span style="font-weight: italic; color: #408080; ">%x</span></span> or <span class="box code"><span style="font-weight: italic; color: #408080; ">%lx</span></span> corresponding to a pointer argument.</li><li>Use of incorrect or unnecessary size specifiers.</li></ul></li></ul><p>Here are some usage guidelines:</p><ul><li><ul><li>Use <span class="box code"><span style="font-weight: italic; color: #408080; ">%d</span></span> or <span class="box code"><span style="font-weight: italic; color: #408080; ">%x</span></span> for int, int32_t, and, in the kernel, smaller <em>signed</em> integer types.</li><li>Use <span class="box code"><span style="font-weight: italic; color: #408080; ">%u</span></span> or <span class="box code"><span style="font-weight: italic; color: #408080; ">%x</span></span> for unsigned int, uint32_t, and, in the kernel, smaller <em>unsigned</em> integer types.</li><li>Use the "l" modifier for long, unsigned long, and (u)intptr_t types. &nbsp;Additionally, use the "l" modifier in the kernel for size_t, off_t, ssize_t, and other types which are equivalent to long or unsigned long.<br/><tt class="wikimodel-verbatim">
    // Use {{code}}%p{{/code}} for any pointer or caddr_t type.  Do not cast pointers to any other type for the purpose of display (especially types which may be less than 64 bits long) unless you are absolutely sure it is both correct and necessary.  For example, kernel text addresses on SPARC are guaranteed to fit into 32-bit integers, but such a cast is unlikely to be needed if it is only for display/debugging purposes, and in fact it may even hide bugs.  Note that you may need to case to {{code}}void //{{/code}} to make lint happy; this is fine.
</tt></li></ul></li></ul><p>Special note on long long and the "ll" modifier: the SPARC kernel is no longer built 32-bit; therefore you may use "ll" only for those variables which are explicitly declared long long or a type equivalent to long long (the most notable examples are hrtime_t variables). &nbsp;However, code using int64_t or uint64_t and compiled for both 32-bit and 64-bit must instead use the macros in <span class="box code"><span style="color: #666666; ">&lt;</span>sys<span style="color: #666666; ">/</span>int_fmtio.h<span style="color: #666666; ">&gt;</span></span>.</p><p>Wrong:</p><pre>
    uint64_t    variable;
    void        \*ptr;
    cmn_err(CE_NOTE, "oh dear: %llx (%x)", variable, (uint_t)ptr);
</pre><p>Right:</p><pre>
    #include &lt;sys/int_fmtio.h&gt;
    uint64_t    variable;
    void        \*ptr
    cmn_err(CE_NOTE, "oh dear: %" PRIx64 " (%p)", variable, ptr);
</pre><p>It is good practice to use these any time a variable's size is explicit in its type (uint8_t, int16_t, etc).</p><p>Note on cmn_err "%b" format: gcc warns if you include a field width with the "%b" specifier. &nbsp;This is a bug in gcc that will be fixed in the near future. &nbsp;To work around it, use the -Wno-format flag (with the compiler wrapper, -_gcc=-Wno-format).</p><ul><li>Useless comparisons</li></ul><p>Comparisons which are always true or always false will cause gcc to emit warnings (and, in many cases, lint to emit warnings as well). &nbsp;Common mistakes are comparing unsigned variables with 0 and comparing variables with constants larger than that variable could contain. &nbsp;Example of wrong code:</p><pre>
    #define    MAX_LITTLE	1024
    #define    MAX_MEDIUM	0x10000
    uint8_t	little;
    uint16_t	medium;
    int8_t	slittle;
    ...
    if (little &lt; 0 || little &gt; MAX_LITTLE)
            return;
    if (medium &lt; 0 || medium &gt;= MAX_MEDIUM)
            return;
    if (slittle &gt;= MAX_LITTLE)
            return;
</pre><p>Questions:</p><ul><li>Why doesn't the tonic team fix these?</li></ul><p>There are a few reasons. One is that the resources aren't there. &nbsp;Another is that it would seem better for the owners of the code to fix it, if there are any owners around. See 6272018, where the RE determined we could just delete a file instead of fixing it. &nbsp;Or the owners might know that they need to coordinate changes with other folks. There is also the faint hope that more testing would be performed on the result just to be sure there aren't any optimization-related bugs or perhaps cases where the code writes into string constants.</p><p>The bugs were mostly filed in an attempt to identify the minimum change required, and get the change to the appropriate people, who hopefully could then work in parallel with others.</p><div class="wikimodel-emptyline"></div><ul><li>Why don't we just turn off these warnings?</li></ul><p>Well, because it seems better to fix the code rather than slap the compiler. After all, it's not just gcc that may be upset about it, the Studio compiler could easily decide to do the same thing. And in fact does in many cases if C99 is turned on (we turn it off because there were far, far more warnings in ON with it on. &nbsp;But it would be really nice to have it on as it requires the use of prototypes and prototypes catch problems). &nbsp;Another reason is that turning off warnings rather than fixing them is one reason the code so upsets gcc - see all the lint warnings we disable and again the fact C99 is disabled. Taking the easy road before is not paying off now.</p>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:11<br/>
          </div>
    <div class="xdocLastModification">       Last modified by admin on 2009/10/26 12:11
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Community Group tools Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/building_opensolaris">Build/Install OpenSolaris (Part 1)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/building_opensolaris_part2">Build/Install OpenSolaris (Part 2)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/downloads">Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/files">Files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/gcc">GCC</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/bug_fixing_notes">Bug Fixing Notes</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/build_instr">Build Instructions</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/flagday">Important Notes</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/on_policy">ONNV Policy</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/rationale">Background and Rationale</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/shadow">Shadow Compilation</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/status">Current Status</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg">Mercurial Tools</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/linker">Dynamic Linking</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scm">OpenSolaris Source Code Management</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/bzr%2Deval">OpenSolaris DSCM Evaluation: Bzr (Interim Report)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/dcm_evaluation_mercurial">OpenSolaris DSCM Evaluation: Mercurial</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/dscmreqdoc">DSCM Requirements Document</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/evalform">Candidate Evaluation Form</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/evalplan">Evaluation Plan</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg_help">How To Use Mercurial (hg) Repositories</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg_teamware_transition">How To Transition from Teamware to Mercurial</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/history">SCM Project History</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/on%2Dscm%2Dtools">ON SCM&#45;Related Tools</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scm_milestone">Source Code Management for OpenSolaris: MILESTONES</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmconsolespec">SCM console specification</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmhostspec">SCM hosting implementation specification</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/svn_help">How To Use SVN Repositories</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmdownloads">Source Code Management Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_tools">Sun Studio Downloads</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/faqs">Sun Studio FAQs</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/getstarted">Sun Studio Getting Started</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sss11ent">Sun Studio 11 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sss12ent_license">Sun Studio 12 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sssent">Sun Studio 10 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_10_tools">Sun Studio 10 Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_11_tools">Sun Studio 11 Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_11_tools_previous">Sun Studio 11&#45;&#45; Previous Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_12_tools">Sun Studio 12 Compilers and Tools for the OpenSolaris Common Build Environment (CBE)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/support">Sun Studio Support</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/testing+nightly">testing nightly</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2012, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
