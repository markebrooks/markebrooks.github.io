<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Shadow Compilation (Community Group tools.shadow) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Community+Group+tools/shadow" />
                    <link rel="canonical" href="/bin/view/Community+Group+tools/shadow" />
                            <meta name="document" content="Community Group tools.shadow"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Community Group tools"/>
    <meta name="page" content="shadow"/>
    <meta name="version" content="1.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Community+Group+tools/pages/shadow"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Shadow Compilation" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="admin" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Community Group tools";
XWiki.currentPage = "shadow";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Community+Group+tools/shadow";
window.docediturl = "/bin/edit/Community+Group+tools/shadow";
window.docsaveurl = "/bin/save/Community+Group+tools/shadow";
window.docgeturl = "/bin/get/Community+Group+tools/shadow";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Community_Group_tools viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FCommunity%2BGroup%2Btools%2Fshadow"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+tools/"><strong>Community Group tools</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Community+Group+tools" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
            </td>
            <td id="logo-text" style="width: 1%;">
                Solaris
            </td>         
            <td style="width: 98%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Community+Group+tools/gcc'>GCC</a> <span class='separator'>&#187;</span> <span class='current'>Shadow Compilation</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Community+Group+tools/shadow?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/shadow?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/shadow?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+tools/shadow?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+tools/shadow?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/shadow?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/shadow?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/shadow?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/shadow?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+tools/shadow?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Community+Group+tools/shadow?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Community+Group+tools/shadow?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Shadow Compilation</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h2 id="HImplementationOptionsandSpecificationforShadowCompilation"><span>Implementation Options and Specification for Shadow Compilation</span></h2><p>&nbsp;This document describes three implementation options for providing and maintaining gcc support in ON. We've selected shadow compilation as the most cost-effective option. This option is described in detail, along with its costs and benefits.</p><pre>

Copyright 2006 Sun Microsystems, Inc.  All rights reserved.
Use is subject to license terms.

ident	"@(#)d-compilers-impl.txt	1.1	06/03/06 SMI"

OpenSolaris
SUPPORTED COMPILER POLICY, V1 [DRAFT 2]: IMPLEMENTATION ADDENDUM

1.  Summary

    This addendum to the OpenSolaris Supported Compiler Policy describes
three possible tools implementations which would satisfy the
requirements established by that policy[0].  The three approaches are a
modification to the compiler wrapper, a complete second build within the
same workspace, and the use of entirely distinct workspaces for each
compiler.  Estimated costs are provided for each.

    Regardless of which solution is ultimately selected, the Tonic team
will be responsible for implementation, initial testing, and integration
of that solution into ON.

2.  Shadow Compilation

    Shadow compilation is implemented as a modification to the compiler
wrapper (cw).  The concept of primary and shadow compilers is
introduced; the primary compiler is specified by one of the -_cc, -_gcc,
-_CC, or -_g++ options and produces the binary objects, preprocessor
files, and other build products as in the existing cw implementation.
The compiler complementary to the primary compiler which accepts the
same input language(s) is defined to be the shadow compiler.  The shadow
compiler will be invoked in parallel with the primary compiler, with the
following modifications and exceptions:

	(a). If CW_NO_SHADOW is present in the environment, cw will
invoke only the specified primary compiler.

	(b). If the command line given to cw includes '-o ' or
'-o',  is replaced by a temporary file on the command line
given to the shadow compiler.  Otherwise, a -o option is added, along
with a temporary filename, to the shadow compiler's command line.  In
either case, this temporary file is unlinked by cw after the shadow
compiler terminates.

	(c). If the command line given to cw does not include one of
'-c', '-S', '-P', or '-E', the shadow compiler is not invoked.  That is,
no attempt is made to link previously compiled objects into a library or
executable.

	(d). All instances of environment variables whose names begin
with 'SUNPRO_DEPEND' are removed prior to execution of the shadow
compiler.  This prevents corruption of make's dependency tracking files
by the shadow compiler.

	(e). The command line for the shadow compiler is otherwise
translated as it would be if the shadow compiler were the primary
compiler.

    Standard output and standard error for both the primary and shadow
compiler, if invoked, are left unchanged by cw, so that warnings and
errors for both are displayed to the user or logged, as appropriate.  cw
terminates only after both the primary and shadow compiler, if invoked,
have terminated.  cw's exit status will be 0 if both primary and shadow
compilers, if invoked, exit with status 0, or nonzero otherwise.

2.1.   Build Time Cost

2.1.1.  Testing Methodology

    The same 2 machines were used for all tests, and the same system
software was used for all tests.

    "Standard cc" and "Standard gcc" results are taken from the 3
February automatic nightly builds of /net/tonic-gate/tonic/gcc-gate
using the default Studio compiler and gcc 3.4.3 from /usr/sfw,
respectively.  Nightly environment files used for these four builds can
be found at /net/tonic-gate/tonic/gcc-gate/public/env/.

    "Combined-cw" results are taken from nightly builds run on 2
February ("cc") and 3 February ("no shadow") using the default Studio
compiler (and gcc 3.4.3 from /usr/sfw, if shadow compilation is
enabled).  Nightly environment files used for these four builds can be
found at /home/wesolows/env/gcc.{x86,sparc}.  The only difference
between the "cc" and "no shadow" builds is the existence of the
CW_NO_SHADOW environment variable for the "no shadow" build, which
causes cw to fall back to its traditional behaviour by invoking only the
primary compiler.  One would expect these times to be nearly identical
to "Standard cc" times.

    Differences between the built workspaces were no greater than one
day's putbacks; the "Standard" workspaces are sync'd with gcc-gate
daily, while the "Combined-cw" workspaces were sync'd on 1 February
only.

    Both machines were otherwise idle during all builds.

    "user+sys" times include both DEBUG and non-DEBUG time.  The reason
for including this will be made clear in the discussion.

2.1.2.  Results

Table 1: Raw times (wall)

x86 (tonic-gate, 4-way v40z, snv_30)

			DEBUG	non-DEBUG	lint
Standard cc		25:36	52:28		51:22
Standard gcc		16:48	37:42		50:00
Combined-cw (cc)	33:22	1:07:18		50:17
Combined-cw (no shadow)	28:16	52:25		59:17

SPARC (stomper, 8-way x2 V890, fma_gcc[cc] (onnv_33))

			DEBUG	non-DEBUG	lint
Standard cc		41:28	1:04:42		42:22
Standard gcc		34:03	56:21		43:18
Combined-cw (cc)	40:42	1:08:07		43:15
Combined-cw (no shadow)	42:22	1:06:52		43:45

Table 2: user+sys times

x86
			DEBUG+non	lint
Standard cc		3:08:06		1:46:46
Standard gcc		2:11:03		1:44:25
Combined-cw (cc)	4:14:12		1:44:24
Combined-cw (no shadow)	3:06:38		1:59:00

SPARC

			DEBUG+non	lint
Standard cc		6:46:28		1:32:24
Standard gcc		6:22:50		1:33:23
Combined-cw (cc)	10:31:50	1:33:00
Combined-cw (no shadow)	6:43:06		1:33:00

Table 3: Estimated tax rate as a fraction of "Standard cc"

x86

		Shadow gcc	lint
Wall (4-way)	0.29		0.66
user+sys	0.35		0.57

SPARC

		Shadow gcc	lint
Wall (16-way)	0.02		0.40
user+sys	0.55		0.23

2.1.3.  Discussion

    This comparison offers strong evidence that the tax associated with
shadow compilation is, surprisingly, quite small indeed and in some
build environments may even be in the noise.  A reasonable
interpretation holds that since the shadow compilation occurs in
parallel with primary compilation, total build times will be less
affected by it on machines with many otherwise idle slower CPUs (where
build time is governed mainly by serialized java compilation, not C
compilation) than on machines which are fully utilized or have fewer,
faster CPUs.  The shadow compilation tax would therefore be at a maximum
on a uniprocessor system; we can arrive at a reasonable worst-case
estimate of this tax on a uniprocessor build system by using the
user+sys times.

    SPARC systems with 2 or fewer CPUs are rarely used to build ON; all
SPARC public build machines for ON Nevada have at least 6 cores; most
have 12 or more.  Therefore, real-world tax rates for shadow gcc
compilation are likely to range between 0 and 0.35 against 0.40 to 0.66
for lint.  Like lint, shadow gcc can be enabled and disabled easily in a
nightly(1) configuration, can be run selectively within each subtree
from the command line, and does not interfere with incremental builds.
Unlike lint, shadow gcc requires zero additional disk space for each
build and does not require project teams to introduce or use additional
makefile macros or targets.

2.2.  Disk Space Costs

    Because the shadow compiler's additional output is immediately
discarded, the marginal disk space requirement for this implementation
is negligible.

2.3.  Active Engineer Time Costs

    Shadow compilation is fully automatic and requires no configuration
or additional manual activity.  The only active engineering cost
associated with this solution is applicable to all three solutions: time
spent diagnosing and correcting errors or warnings triggered by the
secondary compiler.  This time is expected to vary greatly from project
to project.

2.4.  Risks and Drawbacks

    The most significant drawback to this approach is that linking is
never done by the shadow compiler or on its products.  This affects a
number of commands built from a single source file; there would be no
automated way to ensure that these remain gcc-clean.  It may in some
cases be possible to avoid this problem by executing the shadow compiler
for linking when it is known that the compiler writes only to the
designated output file or safely-named temporary files.

3.  Second Internal Build

    This approach is similar to the Export Source Product build in that
it creates a second source tree within the same build workspace.  That
second tree is then built with the secondary compiler.  This approach
produces a set of build products for each compiler that can be installed
and tested.  This approach requires no changes to any tools except
nightly.  When given the 'g' option, nightly creates and builds the
secondary workspace.  This workspace is built in both DEBUG and
non-DEBUG variants if nightly is so configured.

3.1.  Build Time Costs

    On a 4-way Opteron, a full DEBUG+non-DEBUG build was measured at
2:51:36 wall time without the secondary compiler and 4:35:07 with it.
The time cost is therefore slightly higher than that of shadow
compilation.  We expect that the cost in other build environments would
be similar as the time required to perform builds with gcc is
well-known.

3.2.  Disk Space Costs

    This method requires a full copy of the source and binary products
and therefore has a hefty cost in space.  Measurements on x86 indicate
that secondary compilation adds about 3.0 GB to each full build on x86,
or almost 100% of the primary-compiler-only space requirement.  We would
expect SPARC costs to be slightly higher in absolute terms and similar
relative to the size of a primary-compiler-only build.

3.3.  Active Engineer Time Costs

    This solution is automatic and requires only that engineers add a
single flag to their nightly environment files.  Engineers performing
manual builds with dmake will have to find an alternate means of
verifying that their code is acceptable to the secondary compiler, such
as performing a second manual build or using nightly before putback.
Otherwise, this solution requires only that engineers identify,
diagnose, and correct any warnings or errors generated during the
secondary build.

3.4.  Risks and Drawbacks

    This solution is considerably safer than shadow compilation; it does
not alter the semantics of the compiler wrapper and make it much less
likely that objects may be accidentally overwritten.  It also builds all
binaries and thus offers more complete coverage.  The main drawback to
this approach is massive disk space consumption; a lesser unfortunate
side effect is that it provides no help to engineers wishing to make a
secondary compiler pass over only part of a workspace.

4.  Second Workspace

    The simplest and most obvious solution, this approach requires that
each engineer build his or her workspace a second time on each supported
architecture.  Much as each architecture's build must be done in a
separate workspace, so too would each compiler's.  This solution
requires no modification to existing tools, and all normal build
products would be generated.  A single environment variable (__GNUC)
generally controls which compiler is used for a particular build.

4.1.  Build Time Costs

    The cost of this option is approximately equivalent to that of a
second internal build as described in section 3.

4.2.  Disk Space Costs

    This option approximately doubles the disk space requirements for a
complete build.  Of course, builds could be done with the primary and
secondary compiler on separate hosts and/or at separate times so that at
any given time the disk space consumed might be less than that amount.

4.3.  Active Engineer Time Costs

    Engineers will be required to perform steps similar to those already
required for building on multiple architectures, such as creation of
additional environment files.  No new tasks are associated with this
solution, however; the amount of active time spent on doing builds would
simply be doubled.  We estimate that this amounts to no more than a few
minutes a week for each engineer.

4.4.  Risks and Drawbacks

    Because this solution requires no tools changes and relies only on
well-understood existing behaviours, it presents the fewest risks.
However, it requires the greatest amount of build time and disk space,
and requires an (admittedly trivial) set of additional steps of each
engineer.  Without automated tool assistance, it's likely that secondary
compilation would be overlooked by some fraction of implementors.

</pre>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:11<br/>
          </div>
    <div class="xdocLastModification">       Last modified by admin on 2009/10/26 12:11
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Community Group tools Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/building_opensolaris">Build/Install OpenSolaris (Part 1)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/building_opensolaris_part2">Build/Install OpenSolaris (Part 2)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/downloads">Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/files">Files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/gcc">GCC</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/bug_fixing_notes">Bug Fixing Notes</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/build_instr">Build Instructions</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/flagday">Important Notes</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/on_policy">ONNV Policy</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/rationale">Background and Rationale</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/shadow">Shadow Compilation</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/status">Current Status</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg">Mercurial Tools</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/linker">Dynamic Linking</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scm">OpenSolaris Source Code Management</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/bzr%2Deval">OpenSolaris DSCM Evaluation: Bzr (Interim Report)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/dcm_evaluation_mercurial">OpenSolaris DSCM Evaluation: Mercurial</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/dscmreqdoc">DSCM Requirements Document</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/evalform">Candidate Evaluation Form</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/evalplan">Evaluation Plan</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg_help">How To Use Mercurial (hg) Repositories</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/hg_teamware_transition">How To Transition from Teamware to Mercurial</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/history">SCM Project History</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/on%2Dscm%2Dtools">ON SCM&#45;Related Tools</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scm_milestone">Source Code Management for OpenSolaris: MILESTONES</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmconsolespec">SCM console specification</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmhostspec">SCM hosting implementation specification</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/svn_help">How To Use SVN Repositories</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/scmdownloads">Source Code Management Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_tools">Sun Studio Downloads</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/faqs">Sun Studio FAQs</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/getstarted">Sun Studio Getting Started</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sss11ent">Sun Studio 11 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sss12ent_license">Sun Studio 12 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sssent">Sun Studio 10 License</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_10_tools">Sun Studio 10 Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_11_tools">Sun Studio 11 Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_11_tools_previous">Sun Studio 11&#45;&#45; Previous Downloads</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/sun_studio_12_tools">Sun Studio 12 Compilers and Tools for the OpenSolaris Common Build Environment (CBE)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/support">Sun Studio Support</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+tools/testing+nightly">testing nightly</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2012, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
