<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Xen For OpenSolaris Developers (Community Group xen.developers) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Community+Group+xen/developers" />
                    <link rel="canonical" href="/bin/view/Community+Group+xen/developers" />
                            <meta name="document" content="Community Group xen.developers"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Community Group xen"/>
    <meta name="page" content="developers"/>
    <meta name="version" content="3.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Community+Group+xen/pages/developers"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Xen For OpenSolaris Developers" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="johnlev" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Community Group xen";
XWiki.currentPage = "developers";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Community+Group+xen/developers";
window.docediturl = "/bin/edit/Community+Group+xen/developers";
window.docsaveurl = "/bin/save/Community+Group+xen/developers";
window.docgeturl = "/bin/get/Community+Group+xen/developers";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Community_Group_xen viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FCommunity%2BGroup%2Bxen%2Fdevelopers"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+xen/"><strong>Community Group xen</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Community+Group+xen" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
            </td>
            <td id="logo-text" style="width: 1%;">
                Solaris
            </td>         
            <td style="width: 98%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Community+Group+xen/devdocs'>Developer documentation</a> <span class='separator'>&#187;</span> <span class='current'>Xen For OpenSolaris Developers</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Community+Group+xen/developers?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Community+Group+xen/developers?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+xen/developers?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+xen/developers?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+xen/developers?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Community+Group+xen/developers?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+xen/developers?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+xen/developers?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+xen/developers?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+xen/developers?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Community+Group+xen/developers?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Xen For OpenSolaris Developers</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<p><span class="wikilink"><a href="#Introduction_to_xVM_for_OpenSolaris_Devel"><ul><li>[[Introduction to xVM for OpenSolaris Developers</li></ul></a></span></p><ul><li><ul><li><span class="wikilink"><a href="#1_About_this_document">1. About this document</a></span></li><li><span class="wikilink"><a href="#2_Basic_architecture">2. Basic architecture</a></span></li><li><span class="wikilink"><a href="#3_Resource_Virtualization">3. Resource Virtualization</a></span><ul><li><span class="wikilink"><a href="#3_1_CPUs">3.1. CPUs</a></span></li><li><span class="wikilink"><a href="#3_2_Memory">3.2. Memory</a></span></li><li><span class="wikilink"><a href="#3_3_Devices">3.3. Devices</a></span></li></ul></li><li><span class="wikilink"><a href="#4_Source_structure_and_managemen">4. Source structure and management</a></span><ul><li><span class="wikilink"><a href="#4_1_Hypervisor">4.1 Hypervisor</a></span></li><li><span class="wikilink"><a href="#4_2_Solaris_and_the_Intel_platforms">4.2 Solaris and the Intel platforms</a></span></li></ul></li><li><span class="wikilink"><a href="#5_Booting">5. Booting</a></span></li><li><span class="wikilink"><a href="#6_Observability_debug_capability">6. Observability / debug capability</a></span><ul><li><span class="wikilink"><a href="#6_1_xm">6.1 xm</a></span></li><li><span class="wikilink"><a href="#6_2_Crash_dumps">6.2 Crash dumps</a></span></li><li><span class="wikilink"><a href="#6_3_DTrace">6.3 DTrace</a></span></li></ul></li><li><span class="wikilink"><a href="#7_Known_Problems">7. Known Problems</a></span></li></ul></li></ul><h1 id="HIntroductiontoOpenSolarisxVMDevelopers"><span>Introduction to OpenSolaris xVM Developers</span></h1><h2 id="H1.Aboutthisdocument"><span>1. About this document</span></h2><p>&nbsp;This document is not intended to provide exhaustive documentation about the OpenSolaris xVM architecture, xVM configuration, or domain management. This document is intended to serve as a basic introduction to the components that make up the xVM universe, with a goal of providing developers with some context for understanding the changes introduced by its arrival.</p><p>&nbsp;For more information about using xVM and/or the xVM architecture, please see:</p><ul><li>The OpenSolaris community: <span class="wikilink"><a href="/bin/view/Community+Group+xen/"><span class="wikiexternallink"><a class="wikimodel-freestanding" href="http://www.opensolaris.org/os/community/xen/"><span class="wikigeneratedlinkcontent">http://www.opensolaris.org/os/community/xen/</span></a></span></a></span></li></ul><ul><li>The home of the open source Xen project: <span class="wikiexternallink"><a href="http://www.cl.cam.ac.uk/research/srg/netos/xen/index.html"><span class="wikiexternallink"><a class="wikimodel-freestanding" href="http://www.cl.cam.ac.uk/research/srg/netos/xen/"><span class="wikigeneratedlinkcontent">http://www.cl.cam.ac.uk/research/srg/netos/xen/</span></a></span> index.html</a></span></li></ul><ul><li>xVM Community release documentation: <span class="wikilink"><a href="/bin/view/Community+Group+xen/"><span class="wikiexternallink"><a class="wikimodel-freestanding" href="http://www.opensolaris.org/os/community/xen/documentation/"><span class="wikigeneratedlinkcontent">http://www.opensolaris.org/os/community/xen/documentation/</span></a></span></a></span></li></ul><h2 id="H2.Basicarchitecture"><span>2. Basic architecture</span></h2><p>&nbsp;xVM is based on the work of the Xen community. In a running system, Xen fits between the hardware and the operating system.</p><p>&nbsp;xVM supports multiple operating system instances simultaneously. Each instance is called a 'domain'. There are two different kinds of domains: the control domain (typically called "dom0") and user domains (called "domU"s). Unlike Solaris Zones, each domain runs a full instance of an operating system.</p><p>&nbsp;The xVM hypervisor virtualizes the system's hardware. This means that it transparently shares and partitions the systems resources (CPUs, memory, NICs, etc.) among the user domains.</p><p>&nbsp;The hypervisor performs the low-level plumbing needed to provide a virtualized platform for operating systems, but it relies heavily on the control domain for almost everything else. The control domain decides which domUs are created, which resources they can access, how much memory they can have, and so on. In addition, xVM does not include any device drivers, so the dom0 performs all device access.</p><p>&nbsp;There are two basic kinds of virtualization: full virtualization and paravirtualization. In a full virtualization, the operating system is completely unaware that it is running in a virtualized environment. In paravirtualization, the operating system is aware of the virtualization layer, and works with the hypervisor to achieve higher performance. xVM supports both models. Since it must work closely with the hypervisor layer, dom0 is always paravirtualized. domUs can be either paravirtualized or fully virtualized, and a system can have both varieties running simultaneously.</p><p>&nbsp;Full virtualization requires that the hypervisor transparently intercept many operations that an operating system typically performs directly on the hardware. This interception allows the hypervisor to ensure that a domain cannot read or modify another domain's memory, cannot interfere with its device access, and cannot shut down the CPUs it is using. To implement full virtualization, xVM requires special hardware support. Specifically, you must be using Intel CPUs with VT support (such as the Intel Core Duo) or AMD CPUs with AMD-v technology. Full virtualization allows any x86 operating system to run in a guest domain, including Solaris, Linux, or Windows.</p><p>&nbsp;Paravirtualization is built on top of a hypercall interface. Hypercalls are analagous to system calls, but they are made by the operating system into the hypervisor layer. These hypercalls allow a domain to initiate the creation of a new domain, request the creation of address mappings, pass a buffer from one domain to another, send an interrupt between CPUs, etc. The hypervisor layer allows the OS to explicitly initiate the operations that are transparently intercepted in a fully virtualized environment. Since there is no interception required, paravirtualization does not require any special hardware support, and will run on any CPU. Since paravirtualization requires changes to the OS, only specific operating systems can be hosted in a paravirtualized domU. Currently those are limited to Solaris, Linux, and FreeBSD.</p><h2 id="H3.ResourceVirtualization"><span>3. Resource Virtualization</span></h2><h3 id="H3.1.CPUs"><span>3.1. CPUs</span></h3><p>&nbsp;xVM assigns domains one or more virtual CPUs (vcpus). Each vcpu contains all the state one would typically associate with a physical CPU: registers, flags, timestamp, etc. A vcpu in xVM is an entity that can be scheduled, like a thread is in Solaris. When it is a domain's turn to run on a CPU, xVM loads the physical CPU with the state captured in the vcpu, and lets it run.</p><p>&nbsp;Solaris treats each vcpu as it would a physical CPU. When xVM selects a vcpu to run, it will be running the thread that Solaris loaded on the vcpu.</p><h3 id="H3.2.Memory"><span>3.2. Memory</span></h3><p>&nbsp;Solaris manages memory in pages. When running directly on hardware, Solaris uses the physical page frame numbers provided by the system's BIOS or firmware. When running under xVM, the hypervisor provides the list of available physical pages. To isolate the guest OS from the hardware, and to enable features such as live migration, the page numbers provided by xVM do not reflect the physical pages as understood by the hardware. Instead, the pages reflect a virtualized view of the system's memory. xVM maps the guest OS's "physical" page numbers to the "machine frame numbers" (MFNs) recognized by the hardware.</p><p>&nbsp;For the most part, Solaris manages the PFNs provided by xVM exactly as it does the PFNs used on real hardware. The only part of Solaris that needs to understand that PFNs are virtualized is the very lowest level of the HAT layer. Only when we are modifying a process's page tables do we use MFNs rather than PFNs.</p><p>&nbsp;If you find yourself needing to be aware of the distinction between MFNs and PFNs outside of the HAT layer, it almost certainly indicates that you are doing something wrong.</p><h3 id="H3.3.Devices"><span>3.3. Devices</span></h3><p>&nbsp;Dom0 Solaris drivers are identical to Solaris drivers that run on bare metal. As long as these drivers are written entirely with standard DDI interfaces, they will function identically on dom0 and metal Solaris.</p><p>&nbsp;Any driver that works around the DDI might encounter problems when run on dom0. One area of particular vulnerability is DMA. If a driver attempts to use PFNs directly, rather than using the ddi_dma_*_bind_handle() interfaces, it will miss the necessary PFN-&gt;MFN translation, and the driver will be instructing the device to perform I/O to or from the wrong location. The failure will most likely result in a crash of dom0, but it could also lead to silent data corruption.</p><p>&nbsp;There are two different ways device drivers can work in the domU.</p><p>&nbsp;In a fully virtualized domU, xVM will trap any writes to I/O space or any DMA operations, and will transparently forward these requests to the appropriate device in dom0. This trapping and forwarding is an expensive operation, so this kind of device access will likely result in poor performance, particularly for network devices.</p><p>&nbsp;In a paravirtualized domU, each driver has a "front end," which is present within the domU, and a "back end," which runs in dom0. These are referred to as PV drivers. The front end driver takes standard requests from Solaris and forwards them to the back end driver. The back end driver executes the request on the physical hardware and passes any result back to the front end driver, which then notifies Solaris of the request's completion. Since the driver is explicitly hypervisor aware, it is able to work with the hypervisor and the back end driver to deliver much better performance than a driver in a fully virtualized environment.</p><p>&nbsp;There are two main paravirtualized drivers in ON: a virtual block device and a virtual network device. These two drivers present the domU with standard disk and network devices.</p><p>&nbsp;There is also a hybrid method of supporting devices: implement PV drivers in a fully virtualized environment. In this case, the operating system as a whole is still unaware that its environment is virtual, but the PV drivers in the domain are aware of the hypervisor. This method allows us to deliver much better I/O performance without requiring that the full OS be ported to the hypervisor.</p><h2 id="H4.Sourcestructureandmanagement"><span>4. Source structure and management</span></h2><h3 id="H4.1Hypervisor"><span>4.1 Hypervisor</span></h3><p>&nbsp;The xVM hypervisor is based on an open source project, and the xVM community is largely populated by Linux users. Quite a few changes were required to the hypervisor to allow Solaris to act as the dom0. While some of those have been folded back into the main xVM source tree, we have had to maintain the rest ourselves. Thus, you cannot simply download the source from the xVM open source site and expect it to work with a Solaris dom0.</p><h3 id="H4.2SolarisandtheIntelplatforms"><span>4.2 Solaris and the Intel platforms</span></h3><p>&nbsp;With the introduction of xVM, there are now two different platforms on the Intel architecture: i86pc and i86xpv. i86pc refers to Solaris running on bare metal. i86xpv refers to Solaris running paravirtualized on top of a xVM hypervisor.</p><p>&nbsp;The i86xpv and i86pc platforms are much more similar than they are different. The code that is specific to the i86xpv platform is found under usr/src/uts/i86xpv. However, the bulk of the code used to implement the i86xpv platform is taken directly from the i86pc sub-tree, usr/src/uts/i86pc)\.</p><p>&nbsp;There are some header files from the xVM source tree that are needed to build the i86xpv platform code. These headers can be found in common/xen/public. Ensuring that the header files imported into the ON source tree track those in the xVM source tree is a manual process. Any engineer that modifies the head files in one tree must make the identical modification in the other.</p><p>&nbsp;Code that is meant to apply only to i86xpv platforms should be protected with: #ifdef <ins>xpv.</ins></p><p>&nbsp;For the most part, users and userland applications should be completely unaware of which platform they are running on. At user-level, there is complete binary compatibility between i86pc and i86xpv. If you do feel the need to determine which platform you are using, use uname -i.</p><h2 id="H5.Booting"><span>5. Booting</span></h2><p>&nbsp;Whether to run Solaris as a virtualized dom0 or as a standalone operating system is a boot-time decision.</p><p>&nbsp;To run Solaris as a standalone OS, continue to use the same GRUB menu entries that you use currently. To run Solaris as a dom0 with the hypervisor, there must be an entry in /boot/grub/menu.lst that specifies the hypervisor, as described <span class="wikicreatelink"><a href="/bin/create/Community+Group+xen/setupsoldom0?parent=Community+Group+xen.developers">here</a></span>.</p><h2 id="H6.Observability2Fdebugcapability"><span>6. Observability / debug capability</span></h2><h3 id="H6.1xm"><span>6.1 xm</span></h3><p>&nbsp;Although the hypervisor and dom0 work closely together to manage a running system, the dom0 operating system has little direct visibility into the hypervisor. The hypervisor's entire address space is inaccessible to the dom0, so the only source of information is xm, a user-space tool that communicates with the hypervisor via hypercalls.</p><p>&nbsp;Some of the useful xm commands are:</p><ul><li>xm info  - Report static information about the machine, such as number of CPUs, total memory, and xVM version info.</li><li>xm list  - List all domains and some high-level information</li><li>xm top   - Analogous to the Linux "top" command, but it reports domain info rather than process info.</li><li>xm log   - Display the contents of the xend log</li><li>xm help  - List all the available commands</li><li>xentrace - Capture trace buffer data from xVM</li><li>xentop    - Display information about the xVM system and domains in a continuously-updating manner.</li></ul><h3 id="H6.2Crashdumps"><span>6.2 Crash dumps</span></h3><p>&nbsp;On a running system, the hypervisor's memory is completely off-limits to dom0. If the hypervisor crashes, however, the resulting panic dump will generate a core file that provides a unified view of both xVM and dom0. In such a core file, xVM appears as a simple Solaris kernel module called xpv.</p><p>&nbsp;For example:</p><pre>

                &gt; $c
                xpv`panic+0xbf()
                xpv`do_crashdump_trigger+0x19()
                xpv`keypress_softirq+0x35()
                xpv`do_softirq+0x54()
                xpv`idle_loop+0x55()

</pre><p>&nbsp;To be clear: if a dom0 crashes with a standard Solaris panic, the dump will include just the dom0. It is only when the hypervisor itself panics that the resulting dump includes the xVM state as well.</p><p>&nbsp;For more information about handling xVM panics, as well as an example of debugging a xVM panic, see: <span class="wikiexternallink"><a href="http://blogs.sun.com/nilsn/resource/xen_solaris_panic.pdf"><span class="wikiexternallink"><a class="wikimodel-freestanding" href="http://blogs.sun.com/nilsn/resource/xen"><span class="wikigeneratedlinkcontent">http://blogs.sun.com/nilsn/resource/xen</span></a></span> _solaris_panic.pdf</a></span>.</p><p>&nbsp;If a domain appears hung, use xm dump-core to take a dump file. You can look at this file with /bin/mdb.</p><h3 id="H6.3DTrace"><span>6.3 DTrace</span></h3><p>&nbsp;Due to the isolation of the hypervisor from dom0, there is currently no way to apply DTrace directly to the hypervisor. There is a new xpv DTrace provider that allows you to trace the interaction between dom0 and the hypervisor. This provider is constructed of SDT probes introduced into the privcmd device driver. The available probes may be listed by using: dtrace -l -i 'xpv:::'</p><p>&nbsp;While understanding the details of these probes requires a fair bit of knowledge about the OpenSolaris xVM interface, simply enabling them all (dtrace -n 'xpv::: {}') provides a quick high-level introduction to the steps involved with creating domains, destroying domains, migrating domains, etc.</p><h2 id="H7.Knownproblems"><span>7. Known problems</span></h2><p>&nbsp;For descriptions of bugs, known issues, and tips, see the <span class="wikicreatelink"><a href="/bin/create/Community+Group+xen/relnotes?parent=Community+Group+xen.developers">release notes.&nbsp;</a></span></p><p><span class="wikicreatelink"><a href="/bin/create/Community+Group+xen/%2Ftwiki%2Fbin%2Fview%2FMatrix%2FWebHo%0D%0Ame?parent=Community+Group+xen.developers"><span class="wikigeneratedlinkcontent">/twiki/bin/view/Matrix/WebHo
me</span></a></span> Copyright © 1999-2007 Sun Microsystems, Inc.</p>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:11<br/>
          </div>
    <div class="xdocLastModification">       Last modified by johnlev on 2009/10/28 23:16
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Community Group xen Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/Migration+dry%2Drun">Migration+dry&#45;run</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/OVFsupport">Basic Open Virtualization Format Support</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/UpdatedFeatures">Updated Features</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/demos">Demonstrations</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/xvmscreencast">xVM Screencast</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/devdocs">Developer documentation</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/developers">Xen For OpenSolaris Developers</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/install%2Ddepedencies">xVM Dependencies on Installer/LiveCD layouts</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/xVMTests">xVM Tests</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/docs">Documentation</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/2008_11_dom0">How to Set up OpenSolaris as a dom0</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/Bandwidth_VLAN_ID">Configuring VLAN and bandwidth limits for a VNIC</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/SolarisAsGuestHost">Known Issues With Running Solaris OS as a Host and Guest on Different Virtualization Platforms</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/changing%2Dboot%2Dflags">Changing domU boot flags</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/cloning%2Ddomains">Cloning ZFS&#45;based domains</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/configuring%2Ddom0">Configuring dom0</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/guest%2Dcompatibility">Guest types known to work and not work</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/linux%2Ddom0">How To Install an OpenSolaris domU on a Linux dom0</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/manpages">Official docs</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/opensolaris_domu">How to Set up OpenSolaris as a Paravirtual Guest</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/serial%2Dconsole">Enabling serial console for the hypervisor</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/setupvnc">VNC access to guest domains</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/virtinstall">Using virt&#45;install to Install a Domain</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/goals%2Dof%2Dthe%2Dproject">Goals of Project</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/help">Getting help</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/virtcfg+virtadm">virtcfg &amp; virtadm: making xVM guest administration easy</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/virtcfg%2Bvirtadm">virtcfg+virtadm</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/xVM+Visual+Panel">xVM Visual Panel</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/xdt+dtrace">xdt+dtrace</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/xen_faq">FAQ</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+xen/sunxvmfaq">Sun's Announcement on Sun xVM hypervisor</a></span></li>
</ul></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2012, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
