<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Crossbow Hands-on Steps (Project crossbow.handson) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Project+crossbow/handson" />
                    <link rel="canonical" href="/bin/view/Project+crossbow/handson" />
                            <meta name="document" content="Project crossbow.handson"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Project crossbow"/>
    <meta name="page" content="handson"/>
    <meta name="version" content="2.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Project+crossbow/pages/handson"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Crossbow Hands-on Steps" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="admin" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Project crossbow";
XWiki.currentPage = "handson";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Project+crossbow/handson";
window.docediturl = "/bin/edit/Project+crossbow/handson";
window.docsaveurl = "/bin/save/Project+crossbow/handson";
window.docgeturl = "/bin/get/Project+crossbow/handson";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Project_crossbow viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FProject%2Bcrossbow%2Fhandson"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+crossbow/"><strong>Project crossbow</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Project+crossbow" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
            </td>
            <td id="logo-text" style="width: 1%;">
                Solaris
            </td>         
            <td style="width: 98%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                  <span class='current'>Crossbow Hands-on Steps</span>
          </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Project+crossbow/handson?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Project+crossbow/handson?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+crossbow/handson?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+crossbow/handson?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+crossbow/handson?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Project+crossbow/handson?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crossbow/handson?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crossbow/handson?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crossbow/handson?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crossbow/handson?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Project+crossbow/handson?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Project+crossbow/handson?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Crossbow Hands-on Steps</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h2 id="HThesestepsareoldandintheprocessofbeingupdated.20Oct2009"><span><em>&nbsp;These steps are old and in the process of being updated. 20 Oct 2009&nbsp;</em></span></h2><h3 id="HOverviewoftheCrossbowHands-onVignette"><span>Overview of the Crossbow Hands-on Vignette</span></h3><p>&nbsp;Welcome. This session will give you an overview of the key features in Crossbow, Network Virtualization and Resource Control. The version we are using here is currently an add-on to Solaris Neveda build 81, and will be integrated into the main Nevada code base later this yaer, after a beta period that ends late April.</p><p>&nbsp;You need a dedicated Solaris installation as some of the operations, and all system configuration and resource managment, must be done in the global zone. You will configure Crossbow components in the global zone, and then demonstrate them using non-global zones. Zonea are being used only because it is easier to see the effects. An application in the global zone can use a VNIC or have network resource controls in effect.</p><p>&nbsp;The system must have NIC(s) that are GLDv3, such as bge or e1000g. For a full list of NICs, <span class="wikilink"><a href="/bin/view/Project+crossbow/#ipinst_which_nic">see this list</a></span>.</p><h2 id="HSetup"><span><em>&nbsp;Setup&nbsp;</em></span></h2><h3 id="HDownloadandInstallCrossbow"><span>Download and Install Crossbow</span></h3><p>&nbsp;Download the SPARC or x86 Crossbow bits from the <span class="wikicreatelink"><a href="/bin/create/Project+crossbow/snapshots?parent=Project+crossbow.handson">OpenSolaris download site</a></span>. You have the choice of installing from DVD or using an existing Solaris Nevada build 81 installation and adding the Crossbow bits to that via BFU.</p><p>&nbsp;For the demonstration of the Crossbow features, it is simple to use zones to show the capabilities. Lets start by creating a master zone from which it will be easy to quickly create numerous zones for the different tests.</p><p>&nbsp;Cloning zones is extremely fast when the zonepath is on a ZFS file system. If you have the space available, create a zpool, put a file system on that, and set the mount point to <em>/zones</em> just to make it easy. This example has a spare slice available on /dev/dsk/c0t0d0s7. The examples have <span class="wikiexternallink"><a href="https://markebrooks.github.io/bin/download/Project+crossbow/handson/crossbow-vignette.tar">configuration files</a></span> stored locally in /export/data/zones/.</p><pre>

**global#** zpool create mypool c0t0d0s7

**global#** zfs create mypool/zones

**global#** zfs set mountpoint=/zones mypool/zones

</pre><p>&nbsp;Create a VNIC for the master zone. This is not necessary, as any physical NIC could be used, but why not try out VNICs right away. Lets see what device(s) are available to create a VNIC on top of.</p><pre>

**global#** dladm show-dev

</pre><p>&nbsp;Create a single VNIC. VNIC IDs can range from 0 to 899.</p><pre>

**global#** dladm create-vnic -d bge0 -m auto 0

</pre><p>&nbsp;Configure, install, and boot the zone. Per the <span class="wikiexternallink"><a href="http://dlc.sun.com/osol/netvirt/downloads/20080310/release_notes">Crossbow release notes</a></span>, on SPARC systems a sparse zone must also inherit /etc/crypto.</p><pre>

**global#** zonecfg -z zonemaster -f /export/data/zones/zonemaster.cfg

**global#** zoneadm -z zonemaster install

**global#** cp /export/data/zones/zonemaster.sysidcfg /zones/zonemaster/root/etc/sysidcfg

**global#** zoneadm -z zonemaster boot

</pre><p>&nbsp;Customize the zone to my preferences.</p><pre>

**global#** zlogin zonemaster svcadm disable svc:/system/avahi-bridge-dsd:default

**global#** zlogin zonemaster svcadm disable sendmail

**global#** zlogin zonemaster svcadm disable svc:/application/print/ppd-cache-update

**global#** cp /export/data/zones/passwd /zones/zonemaster/root/etc/passwd

**global#** cp /export/data/zones/doc.profile /zones/zonemaster/root/.profile

**global#** cp /export/data/zones/doc.kshrc /zones/zonemaster/root/.kshrc

**global#** zoneadm -z zonemaster halt

**global#** dladm delete-vnic 0

</pre><p>&nbsp;The system is ready to use Crossbow.</p><h2 id="HDemonstratingandUsingtheCrossbowFeatures"><span><em>&nbsp;Demonstrating and Using the Crossbow Features&nbsp;</em></span></h2><h3 id="HToolstoInspectNetworkConfiguration"><span>Tools to Inspect Network Configuration</span></h3><p>&nbsp;The dladm(1M) command displays and sets a variety of network properties. This shows all the network devices configured on the system. dladm has been in Solaris 10 since 1/06, and is also used to manage link properties and aggregations (replaces Sun Trunking). In Solaris Nevada it also manages WiFi, including WEP and WPA security.</p><p>&nbsp;With the integration of Clearview into Nevada in build 83, a number of changes have been made in function and output format. The examples here use features and functions available prior to that.</p><pre>

**global#** dladm show-dev

</pre><p>&nbsp;Show all the data links configured on the system. This will include aggregations, VLANs, VNICs</p><pre>

**global#** dladm show-link

</pre><h3 id="HCreateandConfigureZoneswithVNICs"><span>Create and Configure Zones with VNICs</span></h3><p>&nbsp;Create a VNIC on device bge0 with an automatically generated MAC address, and give it ID #1. If the NIC has factory MAC addresses available, one of them will be used. Otherwise, a random address is selected. The auto mode is the default action if none is specified.</p><pre>

**global#** dladm create-vnic -d bge0 -m auto 1

</pre><p>&nbsp;Create a second VNIC.</p><pre>

**global#** dladm create-vnic -d bge0 -m auto 2

</pre><p>&nbsp;List all the links now, and see that the VNICs are also shown.</p><pre>

**global#** dladm show-link

</pre><p>&nbsp;List only the virtual NICs.</p><pre>

**global#** dladm show-vnic

</pre><p>&nbsp;Two zones have been created and configured (to save time). Zone <em>zone1</em> is assigned the new VNIC <em>vnic1</em>, and similarly, zone <em>zone2</em> has <em>vnic2</em>.</p><pre>

**global#** zoneadm list -cv

</pre><p>&nbsp;Lets configure some zones to use the VNICs just created. To speed this up, a master zone is already set up, so that it can be cloned. The zone path is on ZFS even though Sun does not currently support that configuration. Zone cloning on ZFS is very fast!</p><p>&nbsp;Note that ip-type=exclussive is set and that net only has <em>physical</em> set, but not an <em>address</em>. For exclusive IP Instance zones, the network configuration is set within the zone, not by the global zone using zonecfg(1M).</p><pre>

**global#** cat /export/data/zones/zone1.cfg

**global#** zonecfg -z zone1 -f /export/data/zones/zone1.cfg

**global#** zoneadm -z zone1 clone zonemaster

</pre><p>&nbsp;Configure, clone, and pre-populate the zone's /etc/sysidcfg file. One of the administrative features of zones is that you can manage a lot of the non-global zones' characteristics from the global zone, and this can all be scripted.</p><pre>

**global#** cat /export/data/zones/zone1.sysidcfg

**global#** cp /export/data/zones/zone1.sysidcfg /zones/zone1/root/etc/sysidcfg

</pre><p>&nbsp;Do the same for the second zone.</p><pre>

**global#** zonecfg -z zone2 -f /export/data/zones/zone2.cfg

**global#** zoneadm -z zone2 clone zonemaster

**global#** cp /export/data/zones/zone2.sysidcfg /zones/zone2/root/etc/sysidcfg

</pre><p>&nbsp;Boot both non-global zones.</p><pre>

**global#** zoneadm -z zone1 boot

**global#** zoneadm -z zone2 boot

</pre><p>&nbsp;Put some additional name resolution information into /etc/hosts for each zone</p><pre>

**global#** cat /export/data/zones/hosts.addon &gt;&gt; /zones/zone1/root/etc/hosts

**global#** cat /export/data/zones/hosts.addon &gt;&gt; /zones/zone2/root/etc/hosts

</pre><h3 id="HUsingZoneswithVNICs"><span>Using Zones with VNICs</span></h3><p>&nbsp;Log into the second zone, which is going to be a web server. Use the <em>-C</em> option to log in using the console to see any errors and stay connected on a reboot of the zone.</p><pre>

**global#** zlogin -C zone2

</pre><p>&nbsp;FOR THIS LAB: There apprears to be a small issue with some of the systems where the zone's initial bootup and configuration takes a relatively long time. As a result the console apprears to be hung. So create a second session into the zone while the system does it work.</p><pre>

**global#** zlogin zone2

</pre><p>&nbsp;There is an issue in Nevada build 81 with the SSL configuration of Apache2, so apply a work-around. (It must be <strong><em>mv</em></strong>, not <em>cp</em>.) Then enable the web server via SMF. Next, create a large file and change its ownership to that of the web server processes.</p><pre>

**zone2#** mv /etc/apache2/2.2/conf.d/ssl.conf /etc/apache2/2.2/conf.d/ssl.conf.saved

**zone2#** svcadm enable apache22

**zone2#** mkfile 100m /var/apache2/2.2/htdocs/largefile

**zone2#** chown webservd:webservd /var/apache2/2.2/htdocs/largefile

</pre><p>&nbsp;Test that the web server works locally. Note the speed of the retrieval, especially a second or third time. (NOTE: each time a new file will be created in /tmp, so it can fill up! If running wget a lot, run 'rm /tmp/*file*' occasionally.)</p><pre>

**zone2#** cd /tmp

**zone2#** /usr/sfw/bin/wget http://localhost/largefile

</pre><p>&nbsp;Log into the first zone.</p><pre>

**global#** zlogin -C zone1

</pre><p>&nbsp;Retrieve the same file via HTTP but from a different zone. Since both zones are using the same physical interface for the VNICs, the traffic stays within the system.</p><pre>

**zone1#** cd /tmp

**zone1#** /usr/sfw/bin/wget http://zone2/largefile

</pre><p>&nbsp;Notice the difference in download speed compared to the previous operation within a single zone. Traffic is now traveling down to the VNIC and back up, not just being looped back in IP.</p><p>&nbsp;Now try the same from the global zone</p><pre>

**global#** cd /tmp

**global#** /usr/sfw/bin/wget http://zone2/largefile

</pre><h3 id="HDemonstrateVNICBandwidthControl"><span>Demonstrate VNIC Bandwidth Control</span></h3><p>&nbsp;Reduce the bandwidth for the VNIC associated with the web server zone. Try using 80Mbps since that translates into around 10MBps (Bytes per second), which is easy to see. The dladm command uses bits for its rates. Bandwidth below 10Mbps is not suggested, as the time increments to control the bandwidth are too small. Bandwidth control is done in the kernel, not in hardware.</p><pre>

**global#** dladm set-linkprop -p maxbw=80mb vnic2

**global#** dladm show-linkprop -c -p maxbw vnic2

</pre><pre>

**zone1#** /usr/sfw/bin/wget http://zone2/largefile

</pre><p>&nbsp;Collect some realtime data on the traffic on the VNIC. The <em>-s</em> option is for statistics, and <em>-i</em> set an interval in seconds. The last argument is the VNIC Id.</p><pre>

**global#** dladm show-vnic

**global#** dladm show-vnic -s -i 2 2

</pre><p>&nbsp;Generate some more traffic.</p><pre>

**zone1#** /usr/sfw/bin/wget http://zone2/largefile

</pre><h3 id="HCreatingaVirtualNetworkwithoutaPhysicalNetwork"><span>Creating a Virtual Network without a Physical Network</span></h3><p>&nbsp;It is possible to create a private network within the system, one that does not have a physical NIC associated with it.</p><p>&nbsp;The first step is to create an <em>etherstub</em> as a VNIC anchor.</p><pre>

**global#** dladm create-etherstub 1

</pre><p>&nbsp;Now create more VNICs as was done before on the physical NIC.</p><pre>

**global#** dladm create-vnic -d etherstub1 11

**global#** dladm create-vnic -d etherstub1 12

</pre><p>&nbsp;See how it looks.</p><pre>

**global#** dladm show-vnic

</pre><p>&nbsp;The new NICs need to be assigned to the zones. Using zonecfg interactively.</p><pre>

**global#** zonecfg -z zone1
zonecfg:zone1&gt; add net
zonecfg:zone1:net&gt; set physical=vnic11
zonecfg:zone1:net&gt; end
zonecfg:zone1&gt; exit

</pre><p>&nbsp;And a way that can be scripted.</p><pre>

**global#** zonecfg -z zone2 &lt;&lt; EOF
add net
set physical=vnic12
end
exit
EOF

</pre><p>&nbsp;Verify that the confiration changes took affect.</p><pre>

**global#** zonecfg -z zone1 info net

**global#** zonecfg -z zone2 info net

</pre><p>&nbsp;Reboot the zones to add the new devices.</p><pre>

**global#** zoneadm -z zone1 reboot &amp;

**global#** zoneadm -z zone2 reboot &amp;

</pre><p>&nbsp;The dladm(1M) command can not be run in a non-global zone. One way of seeing what network devices are assigned to the zone is to plumb them all. Note that those interface(s) already plumbed will generate an error message.</p><pre>

**zone1#** ifconfig -a plumb

**zone1#** ifconfig -a

**zone1#** ifconfig vnic11 10.10.10.11/24 up

</pre><p>&nbsp;Do the same for the second zone.</p><pre>

**zone2#** ifconfig -a plumb

**zone2#** ifconfig

**zone2#** ifconfig vnic12 10.10.10.12/24 up

</pre><p>&nbsp;Try reaching one zone from the other via the private network and address.</p><pre>

**zone1#** ping 10.10.10.12

</pre><p>&nbsp;It is possible to snoop on any VNIC assigned to a zone, even a private one.</p><pre>

**zone2#** snoop -d vnic12

</pre><pre>

**zone1#** ping 10.10.10.12

</pre><p>&nbsp;Note that this address is not reachable from the global zone, nor from any other system.</p><pre>

**global#** ping 10.10.10.12

</pre><p>&nbsp;Bring the private interface down</p><pre>

**zone1#** ifconfig vnic1 down unplumb

</pre><p>&nbsp;Now that zone can still reached from the other zone.</p><pre>

**zone2#** ping 10.10.10.11

</pre><p>&nbsp;But it can't be reached from the global zone any more. So the zone is isolated from the outside world, but not from zone <em>zone2</em>.</p><pre>

**global#** ping zone1

</pre><h3 id="HUsingFlows"><span>Using Flows</span></h3><p>&nbsp;VNICs have the option of network bandwidth and CPU resource control. Sometimes, finer control based on layers 3 or 4 is desirable. Flows are designed to categorize data by transport (TCP, UDP), IP address, or port number.</p><p>&nbsp;Create a flow definition on bge0 for HTTP traffice (TCP port 80). (NOTE: A link must be plumbed before a flow is created on that link. At this time, flows on VNICs are supported.)</p><pre>

**global#** flowadm add-flow -l bge0 -a transport=tcp,remote_port=80 tcp80

**global#** flowadm show-flow

</pre><p>&nbsp;Turn on accounting.</p><pre>

**global#** acctadm -e extended -f /var/tmp/net-extended net

</pre><p>&nbsp;Generate traffic. Do this several times.</p><pre>

**global#** /usr/sfw/bin/wget http://webserver/largefile

</pre><p>&nbsp;Data will be collected in the file, and can be processed at another time. The flowadm <em>show-usage</em> option uses the libexxact(3LIB) extended accounting access library. It is also possible to write custom Perl scripts to process this data.</p><pre>

**global#** flowadm show-usage -f /var/tmp/net-extended

</pre><p>&nbsp;Perform some more wget operations.</p><pre>

**global#** flowadm show-usage -d -f /var/tmp/net-extended

**global#** flowadm show-usage -f /var/tmp/net-extended tcp80

</pre><p>&nbsp;Turn data collection for <em>net</em> off.</p><pre>

**global#** acctadm -x net

</pre><h3 id="HAssigningCPU28s29toaVNIC"><span>Assigning CPU(s) to a VNIC</span></h3><p>&nbsp;When creating a VNIC or after is is already created, one or more CPUs can be assigned to a VNIC, so that all system processing for the VNIC is done on that set of CPUs. Any one TCP connection will only use one CPU as there is a one-to-one binding of a soft-ring (where data for a connection comes in and goes out of the system) to a CPU. If there are multiple connections, the distribution of CPUs is performed by hashing the TCP port. To demonstrate this, have to global zone terminals open. In one, look at the load distribution across CPUs.</p><pre>

**global#** mpstat 2

</pre><p>&nbsp;Transfer some data across the physical NIC and notice in the mpstat output which CPUs are utilized.</p><pre>

**zone2#** cd /tmp

**zone2#** /usr/sfw/bin/wget http://webserver/largefile

</pre><p>&nbsp;Assign a CPU to do the VNIC processing.</p><pre>

**global#** dladm set-linkprop -p cpus=23 vnic2

</pre><p>&nbsp;Note how CPU 23 now has heavy utilization. Rerun the wget if necessary, or create a loop...</p><pre>

**zone2#** I=1 ; while [ $I -le 100 ]
do
rm /tmp/*file*
/usr/sfw/bin/wget http://webserver/largefile
I=`expr $I + 1`
done

</pre><p>&nbsp;Assign a different CPU to see the effect better.</p><pre>

**global#** dladm set-linkprop -p cpus=22 vnic2

</pre><p>&nbsp;It is possible to assign a set of CPUs (21,22,23). Multiple streams will be required to show that effect.</p><pre>

**global#** dladm set-linkprop -p cpus=21,22,23 vnic2

</pre><p>&nbsp;The syntax for assigning the CPU when creating the VNIC is as follows.</p><pre>

**global#** dladm create-vnic -d bge0 -p cpus=21,22,23 -m auto 3

</pre><p>&nbsp;Now you are familiar with the basics of Network Virtualization and Resource Control. For more information and copies of DVD images, go to the OpenSolaris Crossbow web site at <span class="wikilink"><a href="/bin/view/Project+crossbow/"><span class="wikiexternallink"><a class="wikimodel-freestanding" href="http://www.opensolaris.org/os/project/crossbow/"><span class="wikigeneratedlinkcontent">http://www.opensolaris.org/os/project/crossbow/</span></a></span></a></span>.</p>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:13<br/>
          </div>
    <div class="xdocLastModification">       Last modified by admin on 2009/10/26 12:39
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Project crossbow Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/CrossbowBeta">Crossbow Project Beta Release</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/Docs">Documentation</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/Features">Crossbow Current and Future Features</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/Overview">Crossbow Overview</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/code%2Dreview">Code Review</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/demo">Crossbow Virtual Wire Builder Demo</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/faq">FAQ</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/getting%2Dstarted">Getting Started</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/handson">Crossbow Hands&#45;on Steps</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crossbow/nic">NIC Driver Features</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2012, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
