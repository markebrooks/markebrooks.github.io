<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>The Source Tree, part 2 (Community Group on.devref_3b) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Community+Group+on/devref_3b" />
                    <link rel="canonical" href="/bin/view/Community+Group+on/devref_3b" />
                            <meta name="document" content="Community Group on.devref_3b"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Community Group on"/>
    <meta name="page" content="devref_3b"/>
    <meta name="version" content="6.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Community+Group+on/pages/devref_3b"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="The Source Tree, part 2" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="Mark Nelson" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Community Group on";
XWiki.currentPage = "devref_3b";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Community+Group+on/devref_3b";
window.docediturl = "/bin/edit/Community+Group+on/devref_3b";
window.docsaveurl = "/bin/save/Community+Group+on/devref_3b";
window.docgeturl = "/bin/get/Community+Group+on/devref_3b";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Community_Group_on viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FCommunity%2BGroup%2Bon%2Fdevref_3b"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+on/"><strong>Community Group on</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Community+Group+on" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <div id="header_banner">
	<table style="width: 100%;">
	    <tr>
		<td style="width: 1%;">
		    <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
		</td>
		<td id="logo-text" style="width: 1%;">
		    Solaris
		</td>         
		<td style="width: 98%;">
		    <table id="loading-indicator">
			<tr>
			    <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
				    alt="Loading" title="Loading"/></td>
			    <td>Loading...</td>
			</tr>
		    </table>
		</td>
		<td style="width: 1%;">
		    <table id="iconbar">
			<tr>
			<td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
			    Collectives</a></td>
			<td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
				Discussions</a></td>
			<td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
				Documentation</a></td>
			<td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
				Download</a></td>
			<td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
				Source Browser</a></td>
			</tr>
		    </table>
		</td>
	    </tr>
	</table>
    </div>
    <div id="site-notice">
	<span>
	    <a href="https://markebrooks.github.io/bin/view/Main/">ATTENTION: This website and all services within the opensolaris.org domain will be unavailable after March 24, 2013.</a>	   
	</span>
    </div>
</div>
 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Community+Group+on/devref_toc'>Developer’s Reference</a> <span class='separator'>&#187;</span> <span class='current'>The Source Tree, part 2</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Community+Group+on/devref_3b?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Community+Group+on/devref_3b?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+on/devref_3b?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+on/devref_3b?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+on/devref_3b?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Community+Group+on/devref_3b?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+on/devref_3b?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+on/devref_3b?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+on/devref_3b?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+on/devref_3b?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Community+Group+on/devref_3b?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>The Source Tree, part 2</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<ul><li><span class="wikilink"><a href="#H3.3UsingYourWorkspace">3.3 Using Your Workspace</a></span><ul><li><span class="wikilink"><a href="#H3.3.1GettingReadytoWork">3.3.1 Getting Ready to Work</a></span></li><li><span class="wikilink"><a href="#H3.3.2EditingFiles">3.3.2 Editing Files</a></span></li><li><span class="wikilink"><a href="#H3.3.3ModifyingtheONBuildSystem">3.3.3 Modifying the ON Build System</a></span><ul><li><span class="wikilink"><a href="#H3.3.3.1AddingaNewKernelModule">3.3.3.1 Adding a New Kernel Module</a></span></li><li><span class="wikilink"><a href="#H3.3.3.2MakingaKernelModuleArchitecture-Independent">3.3.3.2 Making a Kernel Module Architecture-Independent</a></span></li><li><span class="wikilink"><a href="#H3.3.3.3AddingNewLibraries">3.3.3.3 Adding New Libraries</a></span></li></ul></li></ul></li><li><span class="wikilink"><a href="#H3.4KeepingYourWorkspaceinSync">3.4 Keeping Your Workspace in Sync</a></span><ul><li><span class="wikilink"><a href="#H3.4.1WorkspaceUpdateswithMercurial">3.4.1 Workspace Updates with Mercurial</a></span></li></ul></li></ul><h2 id="H3.3UsingYourWorkspace"><span>3.3 Using Your Workspace</span></h2><p>&nbsp;This section describes how to perform common operations on your <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#Hworkspace">workspace</a></span>, such as editing files and modifying the build system.</p><h3 id="H3.3.1GettingReadytoWork"><span>3.3.1 Getting Ready to Work</span></h3><p>&nbsp;Once you have brought over a <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#Hworkspace">workspace</a></span>, you must set up both the workspace itself and your environment before you can safely use it.</p><p>&nbsp;First, you must set your environment variables appropriately so that the build tools will work properly. This must be done once in any shell which will run commands that affect the workspace. Although there are numerous variables which must be set, nearly all of them are set by bldenv(1), which accepts a nightly-style environment file. For example, if your workspace's environment file is in /aux0/testws/opensolaris.sh, you would need to run the following command in each shell from which you will run commands that affect the workspace:</p><pre>

$ bldenv /aux0/testws/opensolaris.sh

</pre><p>&nbsp;It may be tempting to run this command from your shell initialization scripts; however, if you have more than one workspace, it can be inconvenient and even dangerous, as you may inadvertently perform an operation on the wrong workspace.</p><h3 id="H3.3.2EditingFiles"><span>3.3.2 Editing Files</span></h3><p>&nbsp;You can use any text editor you like to edit source files. Although choice of editor is a personal matter, not all editors are equal. In particular, there are two types of editor behavior which are certain to cause problems. First, some editors such as pico and nano wrap lines longer than 72 characters or so. While this is fine for documents, it causes havoc in source files. If you must use such an editor, be sure to turn off line wrapping; otherwise your diffs will include large quantities of noise and the resulting file may not compile. Second, some editors, especially on non-Unix systems which may have different conventions, will change newline characters from '\n' to something else. If you must edit sources on a foreign system, be absolutely certain your editor outputs Unix-style newlines. Source files containing foreign newline characters cannot be integrated into any OpenSolaris consolidation and may not compile.</p><p>&nbsp;When you edit source files, be sure that you are familiar with the style guide; see section 7.2 for more details. Once again, not all editors are equal: some may offer the ability to set parameters that will help you to write conformant code, while others may enforce fixed settings which conflict with our style. Regardless of your choice of editor, you will need to be sure that your code conforms to the style guidelines.</p><h3 id="H3.3.3ModifyingtheONBuildSystem"><span>3.3.3 Modifying the ON Build System</span></h3><p>&nbsp;This section provides detailed, step-by-step instructions for common build-related tasks, such as adding or moving kernel modules and adding new libraries. You should also read the sections regarding makefile layout and operation to gain a better understanding of the overall build system.</p><h4 id="H3.3.3.1AddingaNewKernelModule"><span>3.3.3.1 Adding a New Kernel Module</span></h4><p>&nbsp;The most common build-related operation developers need to perform is adding a new kernel module to the <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#Hgate">gate</a></span>. In this section, we describe the process of adding build instructions for foofs, whose sources are located under usr/src/uts/common/fs/foofs. Adding related commands and libraries (in usr/src/cmd and usr/src/lib) is not covered here.</p><p>&nbsp;0) Create the usr/src/uts/common/fs/foofs directory and populate it with your sources.</p><p>&nbsp;1) Edit uts/*/Makefiles.files to define the set of objects. By convention the symbolic name of this set is of the form MODULE_OBJS, where MODULE is the module name (foofs). The files in each subtree should be defined in the Makefile.files in the root directory of that subtree. Note that they are defined using the += operator, so that the set can be accumulated across multiple makefiles. As example:</p><pre>

FOOFS_OBJS +=	foovfs.o foovno.o

</pre><p>&nbsp;Each source file needs a build rule in the corresponding Makefile.rules file (compilation and linting). A typical pair of entries would be:</p><pre>

$(OBJS_DIR)/%.o:		$(UTSBASE)/common/fs/foofs/%.c
	$(COMPILE.c) -o $@ $&lt;
	$(CTFCONVERT_O)

</pre><pre>

$(LINTS_DIR)/%.ln:		$(UTSBASE)/common/fs/foofs/%.c
	@($(LHEAD) $(LINT.c) $&lt; $(LTAIL))

</pre><p>&nbsp;In this case, these are added to usr/src/uts/common/Makefile.rules. If the module being added is architecture-specific, they must instead be added to the appropriate architecture-specific Makefile.rules file. See section 3.2.3 for more information about specific makefiles.</p><p>&nbsp;2) Create build directories in the appropriate places. If the module can be built in a platform-independent way, this would be in the "instruction set architecture" directory (i.e.: sparc, intel). If not, these directories would be created for all appropriate "implementation architecture"-dependent directories (i.e.: sun4u). In this case, foofs is common code, so two build directories are needed: usr/src/uts/sparc/foofs and usr/src/uts/intel/foofs.</p><p>&nbsp;3) In each build directory, create a makefile. This can usually be accomplished by copying a Makefile from a parallel directory and editing the following lines (in addition to comments).</p><pre>

MODULE		= foofs
OBJECTS		= $(FOOFS_OBJS:%=$(OBJS_DIR)/%)
LINTS		= $(FOOFS_OBJS:%.o=$(LINTS_DIR)/%.ln)
ROOTMODULE	= $(ROOT_FS_DIR)/$(MODULE)

</pre><p>&nbsp;- replace directory part with the appropriate installation directory name (see Makefile.uts)</p><p>&nbsp;If a custom version of modstubs.o is needed to check the undefineds for this routine, the following lines need to appear in the makefile (after the inclusion of Makefile.plat (i.e.: Makefile.sun4u)).</p><pre>

MODSTUBS_DIR	 = $(OBJS_DIR)
$(MODSTUBS_O)	:= AS_CPPFLAGS += -DFOOFS_MODULE

</pre><p>&nbsp;- replace "-DFOOFS_MODULE" with the appropriate flag for the modstubs.o assembly.</p><pre>

CLEANFILES	+= $(MODSTUBS_O)

</pre><p>&nbsp;4) Edit the parent Makefile.mach (i.e.: Makefile.sparc, Makefile.intel) to know about the new module:</p><pre>

FS_KMODS	+= foofs

</pre><p>&nbsp;Note that if your module only applies to a subset of the supported architectures, you will only need to perform this step for the makefiles that are used for those architectures.</p><p>&nbsp;Any additional questions can be easily answered by looking at the many existing examples or by using the mailing lists and fora at <span class="wikiexternallink"><a href="http://opensolaris.org/"><span class="wikiexternallink"><a class="wikimodel-freestanding" href="http://opensolaris.org/"><span class="wikigeneratedlinkcontent">http://opensolaris.org/</span></a></span></a></span>.</p><h4 id="H3.3.3.2MakingaKernelModuleArchitecture-Independent"><span>3.3.3.2 Making a Kernel Module Architecture-Independent</span></h4><p>&nbsp;In some cases, a module which was specific to a particular implementation architecture is adapted to be more general, often because the hardware it supports has become available on more platforms. Once the module itself is able to be used across multiple platforms, its build parameters should be updated to reflect this. Its location in the source tree will also need to change.</p><p>&nbsp;0) Create the build directory under the appropriate "instruction set architecture" build directory (i.e.: sparc/MODULE).</p><p>&nbsp;1) Move the makefile from the "implementation architecture" build directory (i.e.: sun4u/MODULE) to the directory created above. Edit this makefile to reflect the change of parent (trivial: comments, paths and includes).</p><p>&nbsp;2) Edit the "implementation architecture" directory makefile (i.e.: Makefile.sun4u) to *not* know about this module and edit the "instruction set architecture" directory makefile (i.e.: Makefile.sparc) to know about it.</p><p>&nbsp;3) Since the install locations may have changed (as well as the set of systems on which these files are installed) you may also need to adjust the package manifests in usr/src/pkg/manifests to reflect such changes.</p><h4 id="H3.3.3.3AddingNewLibraries"><span>3.3.3.3 Adding New Libraries</span></h4><p>&nbsp;This section describes the overall layout and operation of the library makefiles and provides detailed step-by-step instructions for adding new libraries and enhancing existing library makefiles. This is based very closely on the file usr/src/lib/README.Makefiles and will be updated from time to time to match its contents.</p><p>&nbsp;Your library should consist of a hierarchical collection of Makefiles:</p><ul><li>lib/&lt;library&gt;/Makefile:<br/>&nbsp;This is your library's top-level Makefile. It should contain rules for building any ISA-independent targets, such as installing header files and building message catalogs, but should defer all other targets to ISA-specific Makefiles.</li><li>lib/&lt;library&gt;/Makefile.com<br/>&nbsp;This is your library's common Makefile. It should contain rules and macros which are common to all ISAs. This Makefile should never be built explicitly, but instead should be included (using the make include mechanism) by all of your ISA-specific Makefiles.</li><li>lib/&lt;library&gt;/&lt;isa&gt;/Makefile<br/>&nbsp;These are your library's ISA-specific Makefiles, one per ISA (usually sparc and i386, and sometimes sparcv9 and ia64). These Makefiles should include your common Makefile and then provide any needed ISA-specific rules and definitions, perhaps overriding those provided in your common Makefile.<br/>&nbsp;To simplify their maintenance and construction, $(SRC)/lib has a handful of provided Makefiles that yours must include; the examples provided throughout the document will show how to use them. Please be sure to consult these Makefiles before introducing your own custom build macros or rules.</li><li>lib/Makefile.lib:<br/>&nbsp;This contains the bulk of the macros for building shared objects.</li><li>lib/Makefile.lib.64<br/>&nbsp;This contains macros for building 64-bit objects, and should be included in Makefiles for 64-bit native ISAs.</li><li>lib/Makefile.rootfs<br/>&nbsp;This contains macro overrides for libraries that install into /lib (rather than /usr/lib).</li><li>lib/Makefile.targ<br/>&nbsp;This contains rules for building shared objects.</li></ul><p>&nbsp;The remainder of this document discusses how to write each of your Makefiles in detail, and provides examples from the libinetutil library.</p><p><strong>The Library Top-level Makefile</strong></p><p>&nbsp;As described above, your top-level library Makefile should contain rules for building ISA-independent targets, but should defer the building of all other targets to ISA-specific Makefiles. The ISA-independent targets usually consist of:</p><ul><li>install_h<br/>&nbsp;Install all library header files into the proto area. Can be omitted if your library has no header files.</li><li>check<br/>&nbsp;Check all library header files for hdrchk compliance. Can be omitted if your library has no header files.</li><li>_msg<br/>&nbsp;Build and install a message catalog. Can be omitted if your library has no message catalog.</li></ul><p>&nbsp;Of course, other targets are (such as `cstyle') are fine as well, as long as they are ISA-independent.</p><p>&nbsp;The ROOTHDRS and CHECKHDRS targets are provided in lib/Makefile.lib to make it easy for you to install and check your library's header files. To use these targets, your Makefile must set the HDRS to the list of your library's header files to install and HDRDIR to the their location in the source tree. In addition, if your header files need to be installed in a location other than $(ROOT)/usr/include, your Makefile must also set ROOTHDRDIR to the appropriate location in the proto area. Once HDRS, HDRDIR and (optionally) ROOTHDRDIR have been set, your Makefile need only contain</p><pre>

install_h: $(ROOTHDRS)

</pre><pre>

check: $(CHECKHDRS)

</pre><p>&nbsp;to bind the provided targets to the standard `install_h' and `check' rules.</p><p>&nbsp;Similar rules are provided (in $(SRC)/Makefile.msg.targ) to make it easy for you to build and install message catalogs from your library's source files.</p><p>&nbsp;To install a catalog into the catalog directory in the proto area, define the POFILE macro to be the name of your catalog, and specify that the _msg target depends on $(MSGDOMAINPOFILE). The examples below should clarify this.</p><p>&nbsp;To build a message catalog from arbitrarily many message source files, use the BUILDPO.msgfiles macro.</p><pre>

include ../Makefile.lib

</pre><pre>

POFILE =	  libfoo.po
MSGFILES =	  $(OBJECTS:%.o=%.i)

</pre><pre>

# ...

</pre><pre>

$(POFILE): $(MSGFILES)
		$(BUILDPO.msgfiles)

</pre><pre>

_msg: $(MSGDOMAINPOFILE)

</pre><pre>

include $(SRC)/Makefile.msg.targ

</pre><p>&nbsp;Note that this example doesn't use grep to find message files, since that can mask unreferenced files, and potentially lead to the inclusion of unwanted messages or omission of intended messages in the catalogs. As such, MSGFILES should be derived from a known list of objects or sources.</p><p>&nbsp;It is usually preferable to run the source through the C preprocessor prior to extracting messages. To do this, use the ".i" suffix, as shown in the above example. If you need to skip the C preprocessor, just use the native (.[ch]) suffix.</p><p>&nbsp;The only time you shouldn't use BUILDPO.msgfiles as the preferred means of extracting messages in when you're extracting them from shell scripts; in that case, you can use the BUILDPO.pofiles macro as explained below.</p><p>&nbsp;To build a message catalog from other message catalogs, or from source files that include shell scripts, use the BUILDPO.pofiles macro:</p><pre>

include ../Makefile.lib

</pre><pre>

SUBDIRS =	  $(MACH)

</pre><pre>

POFILE =	  libfoo.po
POFILES =	  $(SUBDIRS:%=%/_%.po)

</pre><pre>

_msg :=	  TARGET = _msg

</pre><pre>

# ...

</pre><pre>

$(POFILE): $(POFILES)
		$(BUILDPO.pofiles)

</pre><pre>

_msg: $(MSGDOMAINPOFILE)

</pre><pre>

include $(SRC)/Makefile.msg.targ

</pre><p>&nbsp;The Makefile above would work in conjunction with the following in its subdirectories' Makefiles:</p><pre>

POFILE =	  _thissubdir.po
MSGFILES =	  $(OBJECTS:%.o=%.i)

</pre><pre>

$(POFILE):	  $(MSGFILES)
		  $(BUILDPO.msgfiles)

</pre><pre>

_msg:		  $(POFILE)

</pre><pre>

include $(SRC)/Makefile.msg.targ

</pre><p>&nbsp;Since this POFILE will be combined with those in other subdirectories by the parent Makefile and that merged file will be installed into the proto area via MSGDOMAINPOFILE, there is no need to use MSGDOMAINPOFILE in this Makefile (in fact, using it would lead to duplicate messages in the catalog).</p><p>&nbsp;When using any of these targets, keep in mind that other macros, like XGETFLAGS and TEXT_DOMAIN may also be set in your Makefile to override or augment the defaults provided in higher-level Makefiles.</p><p>&nbsp;As previously mentioned, you should defer all ISA-specific targets to your ISA-specific Makefiles. You can do this by:</p><ol><li>Setting SUBDIRS to the list of directories to descend into:</li></ol><pre>
SUBDIRS = $(MACH)
</pre><p>&nbsp;Note that if your library is also built 64-bit, then you should also specify</p><pre>
$(BUILD64)SUBDIRS += $(MACH64)
</pre><p>&nbsp;so that SUBDIRS contains $(MACH64) if and only if you're compiling on a 64-bit ISA.</p><ol><li>Providing a common "descend into SUBDIRS" rule:</li></ol><pre>
spec $(SUBDIRS): FRC
	@cd $@; pwd; $(MAKE) $(TARGET)
</pre><pre>
FRC:
</pre><ol><li>Providing a collection of conditional assignments that set TARGET appropriately:</li></ol><pre>
all	:= TARGET= all
clean	:= TARGET= clean
clobber := TARGET= clobber
install := TARGET= install
lint	:= TARGET= lint
</pre><p>&nbsp;The order doesn't matter, but alphabetical is preferable.</p><ol><li>Having the aforementioned targets depend on SUBDIRS:</li></ol><pre>
all clean clobber install: spec .WAIT $(SUBDIRS)
</pre><pre>
lint: $(SUBDIRS)
</pre><p>&nbsp;A few notes are in order here:</p><ul><li>The `all' target must be listed first; the others might as well be listed alphabetically.</li></ul><ul><li>The `lint' target is listed separately because there is nothing to lint in the spec subdirectory.</li></ul><ul><li>The .WAIT between spec and $(SUBDIRS) is suboptimal but currently required to make sure that two different make invocations don't simultaneously build the mapfiles. It will likely be replaced with a more sophisticated mechanism in the future.</li></ul><p>&nbsp;As an example of how all of this goes together, here's libinetutil's top-level library Makefile (copyright omitted):</p><pre>

include ../Makefile.lib

</pre><pre>

HDRS =		libinetutil.h
HDRDIR =	common
SUBDIRS =	$(MACH)
$(BUILD64)SUBDIRS += $(MACH64)

</pre><pre>

all :=		TARGET = all
clean :=	TARGET = clean
clobber :=	TARGET = clobber
install :=	TARGET = install
lint :=		TARGET = lint

</pre><pre>

.KEEP_STATE:

</pre><pre>

all clean clobber install: spec .WAIT $(SUBDIRS)

</pre><pre>

lint:		$(SUBDIRS)

</pre><pre>

install_h:	$(ROOTHDRS)

</pre><pre>

check:		$(CHECKHDRS)

</pre><pre>

$(SUBDIRS) spec: FRC
	@cd $@; pwd; $(MAKE) $(TARGET)

</pre><pre>

FRC:

</pre><pre>

include ../Makefile.targ

</pre><p><strong>The Common Makefile</strong></p><p>&nbsp;In concept, your common Makefile should contain all of the rules and definitions that are the same on all ISAs. However, for reasons of maintainability and cleanliness, you're encouraged to place even ISA-dependent rules and definitions, as long you express them in an ISA-independent way (e.g., by using $(MACH), $(TRANSMACH), and their kin).</p><p>&nbsp;The common Makefile can be conceptually split up into four sections:</p><ol><li>A copyright and comments section.<br/>&nbsp;Please see the prototype files in usr/src/prototypes for examples of how to format the copyright message properly. For brevity and clarity, this section has been omitted from the examples shown here.</li><li>A list of macros that must be defined prior to the inclusion of Makefile.lib.<br/>&nbsp;This section is conceptually terminated by the inclusion of Makefile.lib, followed, if necessary, by the inclusion of Makefile.rootfs (only if the library is to be installed in /lib rather than the default /usr/lib).</li><li>A list of macros that need not be defined prior to the inclusion of Makefile.lib<br/>&nbsp;(or which must be defined following the inclusion of Makefile.lib, to override or augment its definitions). This section is conceptually terminated by the .KEEP_STATE directive.</li><li>A list of targets.</li></ol><p>&nbsp;The first section is self-explanatory. The second typically consists of the following macros:</p><div class="box code">LIBRARY</div><p>&nbsp;Set to the name of the static version of your library, such as `libinetutil.a'. You should always specify the `.a' suffix, since pattern-matching rules in higher-level Makefiles rely on it, even though static libraries are not normally built in <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#HON">ON</a></span>, and are never installed in the proto area. Note that the LIBS macro (described below) controls the types of libraries that are built when building your library.</p><p>&nbsp;If you are building a loadable module (i.e., a shared object that is only linked at runtime with dlopen(3dl)), specify the name of the loadable module with a `.a' suffix, such as `devfsadm_mod.a'.</p><div class="box code">VERS</div><p>&nbsp;Set to the version of your shared library, such as `.1'. You actually do not need to set this prior to the inclusion of Makefile.lib, but it is good practice to do so since VERS and LIBRARY are so closely related.</p><div class="box code">OBJECTS</div><p>&nbsp;Set to the list of object files contained in your library, such as `a.o b.o'. Usually, this will be the same as your library's source files (except with .o extensions), but if your library compiles source files outside of the library directory itself, it will differ. We'll see an example of this with libinetutil.</p><p>&nbsp;The third section typically consists of the following macros:</p><div class="box code">LIBS</div><p>&nbsp;Set to the list of the types of libraries to build when building your library. For dynamic libraries, you should set this to `$(DYNLIB) $(LINTLIB)' so that a dynamic library and lint library are built. For loadable modules, you should just list DYNLIB, since there's no point in building a lint library for libraries that are never linked at compile-time.</p><p>&nbsp;If your library needs to be built as a static library (typically to be used in other parts of the build), you should set LIBS to `$(LIBRARY)'. However, you should do this only when absolutely necessary, and you must *never* ship static libraries to customers.</p><p><span class="box code">ROOTLIBDIR</span> (if your library installs to a nonstandard directory)</p><p>&nbsp;Set to the directory your 32-bit shared objects will install into with the standard $(ROOTxxx) macros. Since this defaults to $(ROOT)/usr/lib ($(ROOT)/lib if you included Makefile.rootfs), you usually do not need to set this.</p><p><span class="box code">ROOTLIBDIR64</span> (if your library installs to a nonstandard directory)</p><p>&nbsp;Set to the directory your 64-bit shared objects will install into with the standard $(ROOTxxx64) macros. Since this defaults to $(ROOT)/usr/lib/$(MACH64) ($(ROOT)/lib/$(MACH64) if you included Makefile.rootfs), you usually do not need to set this.</p><div class="box code">SRCDIR</div><p>&nbsp;Set to the directory containing your library's source files, such as `../common'. Because this Makefile is actually included from your ISA-specific Makefiles, make sure you specify the directory relative to your library's &lt;isa&gt; directory.</p><p><span class="box code">SRCS</span> (if necessary)</p><p>&nbsp;Set to the list of source files required to build your library. This defaults to $(OBJECTS:%.o=$(SRCDIR)/%.c) in Makefile.lib, so you only need to set this when source files from directories other than SRCDIR are needed. Keep in mind that SRCS should be set to a list of source file *pathnames*, not just a list of filenames.</p><p>&nbsp;LINTLIB-specific SRCS (required if building a <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#Hlint">lint</a></span> library)</p><p>&nbsp;Set to a special "lint stubs" file to use when constructing your library's lint library. The lint stubs file must be used to guarantee that programs that link against your library will be able to lint clean. To do this, you must conditionally set SRCS to use your stubs file by specifying `LINTLIB := SRCS= $(SRCDIR)/$(LINTSRC)' in your Makefile. Of course, you do not need to set this if your library does not build a lint library.</p><div class="box code">LDLIBS</div><p>&nbsp;Appended with the list of libraries and library directories needed to build your library; minimally "-lc". Note that this should *never* be set, since that will inadvertently clear the library search path, causing the linker to look in the wrong place for the libraries.</p><p>&nbsp;Since lint targets also make use of LDLIBS, LDLIBS *must* only contain -l and -L directives; all other link-related directives should be put in DYNFLAGS (if they apply only to shared object construction) or LDFLAGS (if they apply in general).</p><div class="box code">MAPDIR</div><p>&nbsp;Set to the directory in which your library mapfile is built. If your library builds its mapfile from specfiles, set this to `../spec/$(TRANSMACH)' (TRANSMACH is the same as MACH for 32-bit targets, and the same as MACH64 for 64-bit targets).</p><p><span class="box code">MAPFILE</span> (required if your mapfile is under source control)</p><p>&nbsp;Set to the path to your library mapfile. If your library builds its mapfile from specfiles, this need not be set. If you set this, you must also set DYNFLAGS to include `-M $(MAPFILE)' and set DYNLIB to depend on MAPFILE.</p><p><span class="box code">SPECMAPFILE</span> (required if your mapfile is generated from specfiles)</p><p>&nbsp;Set to the path to your generated mapfile (usually `$(MAPDIR)/mapfile'). If your library mapfile is under source control, you need not set this. Setting this triggers a number of features in higher-level Makefiles:</p><ul><li>Your shared library will automatically be linked with `-M $(SPECMAPFILE)'.</li></ul><ul><li>A `make clobber' will remove $(SPECMAPFILE).</li></ul><ul><li>Changes to $(SPECMAPFILE) will cause your shared library to be rebuilt.</li></ul><ul><li>An attempt to build $(SPECMAPFILE) will automatically cause a `make mapfile' to be done in MAPDIR.</li></ul><p><span class="box code">CPPFLAGS</span> (if necessary)</p><p>&nbsp;Appended with any flags that need to be passed to the C preprocessor (typically -D and -I flags). Since lint macros use CPPFLAGS, CPPFLAGS *must* only contain directives known to the C preprocessor. When compiling MT-safe code, CPPFLAGS *must* include -D_REENTRANT. When compiling large file aware code, CPPFLAGS *must* include -D_FILE_OFFSET_BITS=64.</p><div class="box code">CFLAGS</div><p>&nbsp;Appended with any flags that need to be passed to the C compiler. Minimally, append `$(CCVERBOSE)'. Keep in mind that you should add any C preprocessor flags to CPPFLAGS, not CFLAGS.</p><p><span class="box code">CFLAGS64</span> (if necessary)</p><p>&nbsp;Appended with any flags that need to be passed to the C compiler when compiling 64-bit code. Since all 64-bit code is compiled $(CCVERBOSE), you usually do not need to modify CFLAGS64.</p><p><span class="box code">COPTFLAG</span> (if necessary)</p><p>&nbsp;Set to control the optimization level used by the C compiler when compiling 32-bit code. You should only set this if absolutely necessary, and it should only contain optimization-related settings (or -g).</p><p><span class="box code">COPTFLAG64</span> (if necessary)</p><p>&nbsp;Set to control the optimization level used by the C compiler when compiling 64-bit code. You should only set this if absolutely necessary, and it should only contain optimization-related settings (or -g).</p><p><span class="box code">LINTFLAGS</span> (if necessary)</p><p>&nbsp;Appended with any flags that need to be passed to lint(1) when linting 32-bit code. You should only modify LINTFLAGS in rare instances where your code cannot (or should not) be fixed.</p><p><span class="box code">LINTFLAGS64</span> (if necessary)</p><p>&nbsp;Appended with any flags that need to be passed to lint(1) when linting 64-bit code. You should only modify LINTFLAGS64 in rare instances where your code cannot (or should not) be fixed.</p><p>&nbsp;Of course, you may use other macros as necessary.</p><p>&nbsp;The fourth section typically consists of the following targets:</p><ul><li>all<br/>&nbsp;Build all of the types of the libraries named by LIBS. Must always be the first real target in common Makefile. Since the higher-level Makefiles already contain rules to build all of the different types of libraries, you can usually just specify</li></ul><pre>
all: $(LIBS)
</pre><p>&nbsp;though it should be listed as an empty target if LIBS is set by your ISA-specific Makefiles (see above).</p><ul><li>lint<br/>&nbsp;Use the `lintcheck' rule provided by lib/Makefile.targ to lint the actual library sources. Historically, this target has also been used to build the lint library (using LINTLIB), but that usage is now discouraged. Thus, this rule should be specified as</li></ul><pre>
lint: lintcheck
</pre><p>&nbsp;Conspicuously absent from this section are the `clean' and `clobber' targets. These targets are already provided by lib/Makefile.targ and thus should not be provided by your common Makefile. Instead, your common Makefile should list any additional files to remove during a `clean' and `clobber' by appending to the CLEANFILES and CLOBBERFILES macros.</p><p>&nbsp;Once again, here's libinetutil's common Makefile, which shows how many of these directives go together. Note that Makefile.rootfs is included to cause libinetutil.so.1 to be installed in /lib rather than /usr/lib:</p><pre>

LIBRARY =	libinetutil.a
VERS =		.1
OBJECTS =	octet.o inetutil4.o ifspec.o

</pre><pre>

include ../../Makefile.lib
include ../../Makefile.rootfs

</pre><pre>

LIBS =		$(DYNLIB) $(LINTLIB)
SRCS =		$(COMDIR)/octet.c $(SRCDIR)/inetutil4.c \
		$(SRCDIR)/ifspec.c
$(LINTLIB):=	SRCS = $(SRCDIR)/$(LINTSRC)
LDLIBS +=	-lsocket -lc

</pre><pre>

SRCDIR =	../common
COMDIR =	$(SRC)/common/net/dhcp
MAPDIR =	../spec/$(TRANSMACH)
SPECMAPFILE =	$(MAPDIR)/mapfile

</pre><pre>

CFLAGS +=	$(CCVERBOSE)
CPPFLAGS +=	-I$(SRCDIR)

</pre><pre>

.KEEP_STATE:

</pre><pre>

all: $(LIBS)

</pre><pre>

lint: lintcheck

</pre><pre>

pics/%.o: $(COMDIR)/%.c
	$(COMPILE.c) -o $@ $&lt;
	$(POST_PROCESS_O)

</pre><pre>

include ../../Makefile.targ

</pre><p>&nbsp;Note that for libinetutil, not all of the object files come from SRCDIR. To support this, an alternate source file directory named COMDIR is defined, and the source files listed in SRCS are specified using both COMDIR and SRCDIR. Additionally, a special build rule is provided to build object files from the sources in COMDIR; the rule uses COMPILE.c and POST_PROCESS_O so that any changes to the compilation and object-post-processing phases will be automatically picked up.</p><p><strong>The ISA-Specific Makefiles</strong></p><p>&nbsp;As the name implies, your ISA-specific Makefiles should contain macros and rules that cannot be expressed in an ISA-independent way. Usually, the only rule you will need to put here is `install', which has different dependencies for 32-bit and 64-bit libraries. For instance, here are the ISA-specific Makefiles for libinetutil:</p><pre>

sparc/Makefile:

</pre><pre>

include ../Makefile.com

</pre><pre>

install: all $(ROOTLIBS) $(ROOTLINKS) $(ROOTLINT)

</pre><pre>

sparcv9/Makefile:

</pre><pre>

include ../Makefile.com
include ../../Makefile.lib.64

</pre><pre>

install: all $(ROOTLIBS64) $(ROOTLINKS64)

</pre><pre>

i386/Makefile:

</pre><pre>

include ../Makefile.com

</pre><pre>

install: all $(ROOTLIBS) $(ROOTLINKS) $(ROOTLINT)

</pre><p>&nbsp;Observe that there is no .KEEP_STATE directive in these Makefiles, since all of these Makefiles include libinetutil/Makefile.com, and it already has a .KEEP_STATE directive. Also, note that the 64-bit Makefile also includes Makefile.lib.64, which overrides some of the definitions contained in the higher level Makefiles included by the common Makefile so that 64-bit compiles work correctly.</p><p><strong>CTF Data in Libraries</strong></p><p>&nbsp;By default, all position-independent objects are built with <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#HCTF">CTF</a></span> data using ctfconvert, which is then merged together using ctfmerge when the shared object is built. All C-source objects processed via ctfmerge need to be processed via ctfconvert or the build will fail. Objects built from non-C sources (such as assembly or C++) are silently ignored for CTF processing.</p><p>&nbsp;Filter libraries that have no source files will need to explicitly disable CTF by setting CTFMERGE_LIB to ":"; see libw/Makefile.com for an example.</p><p><strong>More Information</strong></p><p>&nbsp;Other issues and questions will undoubtedly arise while you work on your library's Makefiles. To help in this regard, a number of libraries of varying complexity have been updated to follow the guidelines and practices outlined in this document:</p><ul><li>lib/libdhcputil<br/>&nbsp;Example of a simple 32-bit only library.</li><li>lib/libdhcpagent<br/>&nbsp;Example of a simple 32-bit only library that obtains its sources from multiple directories.</li><li>lib/ncad_addr<br/>&nbsp;Example of a simple loadable module.</li><li>lib/libipmp<br/>&nbsp;Example of a simple library that builds a message catalog.</li><li>lib/libdhcpsvc<br/>&nbsp;Example of a Makefile hierarchy for a library and a collection of related pluggable modules.</li><li>lib/lvm<br/>&nbsp;Example of a Makefile hierarchy for a collection of related libraries and pluggable modules.<br/>&nbsp;Also an example of a Makefile hierarchy that supports the _dc target for domain and category specific messages.</li></ul><h2 id="H3.4KeepingYourWorkspaceinSync"><span>3.4 Keeping Your Workspace in Sync</span></h2><p>&nbsp;Over time, other developers will put back their work into the main <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#Hgate">gate</a></span>, and your <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#Hworkspace">workspace</a></span> will become out of date with respect to these changes. By keeping your workspace in sync as much as possible, you will save time in two ways.</p><p>&nbsp;First, you will have less merging to do when you are ready to put back, which will reduce or eliminate conflict resolution and simplify testing.</p><p>&nbsp;Second, the risk of missing semantic changes in other parts of the code will be reduced. If an interface you use is changed, you want to know about it as soon as possible so you will not continue to implement your features on the basis of a deprecated or nonexistent interface. This will save much work and grief; you do not want to be preparing to put back and only then discover that your code no longer compiles because a crucial interface has been removed.</p><p>&nbsp;Keeping your workspace in sync is not difficult, and should be done as often as practical. However, there is one drawback, which may limit the frequency at which you choose to sync your workspace. Pulling in changes unrelated to your work exposes you to the risk of breakage caused by those changes. If an unrelated change breaks your workspace, you could waste time trying to identify the cause of breakage by assuming it is in your changes rather than someone else's. Also, it is possible that an unrelated change will render your workspace unable to boot or perform any useful work at all, which would make it impossible for you to test your changes until the original bugs are fixed. For these reasons, you will want to carefully consider your synchronization process to minimize risk while keeping as up to date as possible. Merging with recent, tested build snapshots on a biweekly basis rather than merging daily with the gate is often a good compromise.</p><p>&nbsp;Until the main gate is accessible to all developers, the Sun engineer who is carrying the fix will have to do any final merges with the internal gate. If you have submitted a change that causes this merge to get too hairy, you should be ready to answer questions about the change and provide assistance during the merge. In extreme cases, the Sun engineer may ask that you do the merge externally (i.e., after the next snapshot has been released) and resubmit your source patch. This reduces the chance that your change will break other changes being made to the same area of code.</p><h3 id="H3.4.1WorkspaceUpdateswithMercurial"><span>3.4.1 Workspace Updates with Mercurial</span></h3><p>&nbsp;You can use the command "hg pull -u" to synchronize your workspace with the <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary#Hgate">gate</a></span>. If you haven't made any changes in your workspace, this will pull down any new <span class="wikiexternallink"><a href="http://www.selenic.com/mercurial/wiki/ChangeSet">changesets</a></span> and update your <span class="wikiexternallink"><a href="http://www.selenic.com/mercurial/wiki/WorkingDirectory">working directory</a></span> to the last one.</p><p>&nbsp;External developers may wish to specify a revision with "hg pull", to match up a source changeset with closed binaries and signed crypto, as described in <span class="wikilink"><a href="/bin/view/Community+Group+on/devref_3a">Section 3.1.2 Obtaining Sources via Mercurial</a></span>.</p><p>&nbsp;Internal developers should remember to update both their open and closed repositories.</p><p>&nbsp;If you have made changes in your workspace, bringing down changes from the gate will create a branch in your workspace. The last changeset in each branch is called a "head", so you will see a message from Mercurial about the creation of a new head. You should merge these branches before proceeding, using "hg merge". See the Mercurial wiki for an <span class="wikiexternallink"><a href="http://www.selenic.com/mercurial/wiki/Merge">overview of the merge process</a></span>.</p><p>&nbsp;If you have nightly(1) configured to do a pull (the default for internal developers), nightly(1) will attempt an automated merge if one is needed. The build will error out if the merge fails. Even if the automated merge succeeds, be sure to review the changes before committing them.</p>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by Administrator on 2009/10/26 12:08<br/>
          </div>
    <div class="xdocLastModification">       Last modified by Mark Nelson on 2010/04/05 20:25
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Community Group on Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/ON+IPS+FAQ">ON IPS FAQ</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/crt">CRT</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/advocates">Advocates & Sponsors</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/becoming%2Da%2Dsponsor">Becoming a Sponsor</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/becoming%2Dan%2Dadvocate">Becoming a CRT Advocate</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/charter">Charter</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/rti%2Dnits">RTI nits to avoid</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/sponsor%2Dtasks">Sponsor Tasks</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/dev_solaris">Developing Solaris</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/qual_death_spiral">Quality Death Spiral</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_toc">Developer’s Reference</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_1">Introduction</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_2">Prerequisites</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_3a">The Source Tree, part 1</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_3b">The Source Tree, part 2</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_4">Building OpenSolaris</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_5">Installing and Testing OpenSolaris</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_6">Integration Procedure</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_7">Best Practices and Requirements</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/devref_glossary">Glossary</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/findunref">findunref and unreferenced files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/flag%2Ddays">ONNV Flag Days, Heads Ups, and Project Integration History</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/101%2D105">Builds 101&#45;105</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/106%2D110">Builds 106&#45;110</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/111%2D115">Builds 111&#45;115</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/116%2D120">Builds 116&#45;120</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/121%2D125">Builds 121&#45;125</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/126%2D130">Builds 126&#45;130</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/21%2D25">Builds 21&#45;25</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/26%2D30">Builds 26&#45;30</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/31%2D35">Builds 31&#45;35</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/36%2D40">Builds 36&#45;40</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/41%2D45">Builds 41&#45;45</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/46%2D50">Builds 46&#45;50</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/51%2D55">Builds 51&#45;55</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/56%2D60">Builds 56&#45;60</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/61%2D65">Builds 61&#45;65</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/66%2D70">Builds 66&#45;70</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/71%2D75">Builds 71&#45;75</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/76%2D80">Builds 76&#45;80</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/81%2D85">Builds 81&#45;85</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/86%2D90">Builds 86&#45;90</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/91%2D95">Builds 91&#45;95</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/96%2D100">Builds 96&#45;100</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/install_quickstart">Installation (from source) Quickstart</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/example_nightly">Annotated nightly(1) Mail Example</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/known_issues">Currently Known Issues</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/onnv_putback_logs">Putback Logs</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/os_dev_process">Development Process</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/schedule">Schedule</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/shellstyle">Bourne/Korn Shell Coding Conventions</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+on/wx">wx</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2013, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
