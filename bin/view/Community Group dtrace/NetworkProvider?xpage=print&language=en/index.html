<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>DTrace Network Provider (Community Group dtrace.NetworkProvider) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Community+Group+dtrace/NetworkProvider" />
                    <link rel="canonical" href="/bin/view/Community+Group+dtrace/NetworkProvider" />
                            <meta name="document" content="Community Group dtrace.NetworkProvider"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Community Group dtrace"/>
    <meta name="page" content="NetworkProvider"/>
    <meta name="version" content="3.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Community+Group+dtrace/pages/NetworkProvider"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="DTrace Network Provider" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="Alta Elstad" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="all" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Community Group dtrace";
XWiki.currentPage = "NetworkProvider";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Community+Group+dtrace/NetworkProvider";
window.docediturl = "/bin/edit/Community+Group+dtrace/NetworkProvider";
window.docsaveurl = "/bin/save/Community+Group+dtrace/NetworkProvider";
window.docgeturl = "/bin/get/Community+Group+dtrace/NetworkProvider";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Community_Group_dtrace viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FCommunity%2BGroup%2Bdtrace%2FNetworkProvider%3Fxpage%3Dprint%26%2338%3Blanguage%3Den"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+dtrace/"><strong>Community Group dtrace</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Community+Group+dtrace" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
            </td>
            <td id="logo-text" style="width: 1%;">
                Solaris
            </td>         
            <td style="width: 98%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                  <span class='current'>DTrace Network Provider</span>
          </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Community+Group+dtrace/NetworkProvider?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Community+Group+dtrace/NetworkProvider?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+dtrace/NetworkProvider?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+dtrace/NetworkProvider?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+dtrace/NetworkProvider?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Community+Group+dtrace/NetworkProvider?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+dtrace/NetworkProvider?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+dtrace/NetworkProvider?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+dtrace/NetworkProvider?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+dtrace/NetworkProvider?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Community+Group+dtrace/NetworkProvider?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>DTrace Network Provider</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h1 id="HDTraceNetworkProviders"><span>DTrace Network Providers</span></h1><p>The following is a design proposal for a collection of DTrace Networking Providers. These providers aim to provide networking observability and troubleshooting information for Solaris users. The first prototype TCP provider was <span class="wikilink"><a href="/bin/view/Community+Group+dtrace/CEC2006">demonstrated</a></span> at CEC 2006.</p><p>This document will list the probes that may be made available, their arguments, and link prototypes and examples. Feedback is welcome, please post to <span class="wikiexternallink"><a href="http://mail.opensolaris.org/mailman/listinfo/dtrace-discuss">dtrace-discuss</a></span>. NOTE: this is a work in progress, and most of these network providers are not yet available.</p><ul><li><span class="wikilink"><a href="#HPrototypes">Prototypes</a></span></li><li><span class="wikilink"><a href="#HAims">Aims</a></span></li><li><span class="wikilink"><a href="#HNews">News</a></span></li><li><span class="wikilink"><a href="#HProviders">Providers</a></span></li><li><span class="wikilink"><a href="#HProbes">Probes</a></span></li><li><span class="wikilink"><a href="#HArguments">Arguments</a></span></li><li><span class="wikilink"><a href="#HPlan">Plan</a></span><ul><li><span class="wikilink"><a href="#HCustomerProviderPlan">Customer Provider Plan</a></span></li><li><span class="wikilink"><a href="#HEngineerProviderPlan">Engineer Provider Plan</a></span></li></ul></li><li><span class="wikilink"><a href="#HTesting">Testing</a></span></li><li><span class="wikilink"><a href="#HSolutions">Solutions</a></span></li><li><span class="wikilink"><a href="#HComments">Comments</a></span></li></ul><h4 id="HWhoistalkingtomywebserver3F"><span>Who is talking to my web server?</span></h4><pre>
# dtrace -n 'tcp:::receive /args[2]-&gt;tcp_dport == 80/ {
        @pkts[args[1]-&gt;ip_daddr] = count();
}'
dtrace: description 'tcp:::receive' matched 1 probe
^C

  192.168.1.8                                                       9
  fe80::214:4fff:fe3b:76c8                                         12
  192.168.1.51                                                     32
  10.1.70.16                                                       83
  192.168.7.3                                                     121
  192.168.101.101                                                 192
</pre><h4 id="HWhatportsarepeopleconnectingto3F"><span>What ports are people connecting to?</span></h4><pre>
# dtrace -n 'tcp:::accept-established { @[args[2]-&gt;tcp_dport] = count(); }'
dtrace: description 'tcp:::accept-established' matched 1 probe
^C

       79                2
       22               14
       80              327
</pre><h2 id="HPrototypes"><span>Prototypes</span></h2><p>The following prototypes demonstrate older designs than what is described on this main page, however what they demonstrate should still be doable albiet with slightly different probe names and arguments.</p><ul><li><span class="wikiexternallink"><a href="http://wikis.sun.com/display/DTrace/tcp+Provider"><strong>Prototype #4</strong></a></span>, Aug 2008. TCP provider. Similar to the TCP probes from prototype #1. The <span class="wikiexternallink"><a href="http://cr.opensolaris.org/bgregg/tcp-provider-prototype2">source code</a></span> is available.</li><li><span class="wikiexternallink"><a href="http://wikis.sun.com/display/DTrace/ip+Provider"><strong>Prototype #3</strong></a></span>, Dec 2007. IP provider (covers IPv4 and IPv6). Similar to prototype #2, but with the probe arguments as described in the Arguments section below.</li><li><strong>Prototype #2</strong>, Jun 2007. IP, IPv4, IPv6 providers.</li><li><strong>Prototype #1</strong>, Oct 2006. TCP, UDP and IP providers. Also see the <span class="wikilink"><a href="/bin/view/Community+Group+dtrace/CEC2006">CEC2006 Demo</a></span>.</li></ul><h2 id="HAims"><span>Aims</span></h2><p>The main aims of the network providers are:</p><ul><li>Support for common network protocols: TCP, UDP, IP.</li><li>Everyday observability: connections/packets/bytes by address/port.</li><li>Performance observability: throughputs, network latencies.</li><li>Socket level tracing: associate events to PIDs.</li><li>Further troubleshooting support: TCP flag analysis, header info.</li></ul><p>Future enhancements and additions to the providers include:</p><ul><li>Other protocol support: ICMP, SCTP, ...</li><li>Kernel code path latency probes.</li></ul><h2 id="HNews"><span>News</span></h2><p>The IP provider was integrated into Solaris Nevada build 93, and OpenSolaris. The official documentation is here: <span class="wikiexternallink"><a href="http://wikis.sun.com/display/DTrace/ip+Provider">DTrace IP Provider</a></span>.</p><p>The TCP provider is now being prepared for integration, and prototype documentation is available here: <span class="wikiexternallink"><a href="http://wikis.sun.com/display/DTrace/tcp+Provider">DTrace TCP Provider</a></span>.</p><h2 id="HProviders"><span>Providers</span></h2><p>The Network provider will be a collection of several DTrace providers, such as ipv4, ipv6 and tcp (there is no monolithic net provider). The proposed providers are,</p><table><tr><th scope="col">Provider</th><th scope="col">Description</th></tr><tr><td>gld</td><td>This traces the generic LAN device layer, and shows link layer activity such as Ethernet frames. The probes allow frame by frame tracing.</td></tr><tr><td>arp</td><td>This traces ARP and RARP packets.</td></tr><tr><td>icmp</td><td>This traces ICMP packets, and provides the type and code from the ICMP header.</td></tr><tr><td>ip</td><td>This traces high level IP details for IPv4 and IPv6.</td></tr><tr><td>tcp</td><td>This traces the TCP layer, and shows what TCP activity is occuring.</td></tr><tr><td>udp</td><td>This traces UDP events.</td></tr><tr><td>sctp</td><td>This traces SCTP events.</td></tr><tr><td>socket</td><td>This traces the socket layer, close to the application. These probes fire in the same context as the corresponding process, and show data sent to or received from sockets.</td></tr></table><p>Other providers will be added as required.</p><h2 id="HProbes"><span>Probes</span></h2><p>The following is the master plan for the net providers - what probes could be exported, what their arguments could be, and how they fit together. See the prototype pages for implementation details.</p><table><tr><th scope="col">probes</th><th scope="col">args[0]</th><th scope="col">args[1]</th><th scope="col">args[2]</th><th scope="col">args[3]</th><th scope="col">args[4]</th><th scope="col">args[5]</th></tr><tr><td>gld:::send, gld:::receive</td><td>pktinfo_t *</td><td>NULL</td><td>ipinfo_t</td><td>illinfo_t *</td><td>etherinfo_t *</td><td>&nbsp;</td></tr><tr><td>ip:::send, ip:::receive</td><td>pktinfo_t *</td><td>csinfo_t</td><td>ipinfo_t *</td><td>illinfo_t *</td><td>ipv4info_t *</td><td>ipv6info_t *</td></tr><tr><td>tcp:::send, tcp:::receive</td><td>pktinfo_t *</td><td>csinfo_t *</td><td>ipinfo_t *</td><td>tcpsinfo_t *</td><td>tcpinfo_t *</td><td>&nbsp;</td></tr><tr><td>tcp:::accept-*, tcp:::connect-*</td><td>pktinfo_t *</td><td>csinfo_t *</td><td>ipinfo_t *</td><td>tcpsinfo_t *</td><td>tcpinfo_t *</td><td>&nbsp;</td></tr><tr><td>tcp:::state-change</td><td>NULL</td><td>csinfo_t *</td><td>tcpsinfo_t *</td><td>tcpnsinfo_t *</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>tcpf:::send, tcpf:::receive</td><td>pktinfo_t *</td><td>csinfo_t *</td><td>ipinfo_t *</td><td>tcpsinfo_t *</td><td>tcpfinfo_t *</td><td>&nbsp;</td></tr><tr><td>udp:::send, udp:::receive</td><td>pktinfo_t *</td><td>csinfo_t *</td><td>ipinfo_t *</td><td>udpinfo_t *</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>udp:::stream-*</td><td>pktinfo_t *</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr><tr><td>icmp:::send, icmp:::receive</td><td>pktinfo_t *</td><td>NULL</td><td>ipinfo_t *</td><td>illinfo_t *</td><td>icmpinfo_t *</td><td>&nbsp;</td></tr></table><p>Other probes will be added as required.</p><h2 id="HArguments"><span>Arguments</span></h2><p>The role of the arguments listed above is as follows:</p><ul><li>pktinfo_t * - packet info; After task 7 in the Customer Provider Plan in the following section, this will provide packet IDs to allow a packet to be followed as it passes through the network stack. For now, it will use mblk pointers as packet IDs.</li><li>csinfo_t * - connection state info; After task 13 in the Customer Provider Plan in the following section, this will provide connection IDs to assist associating packets with user-level process IDs. For now, it will use conn_t pointers as packet IDs.</li><li>ipinfo_t * - IP info; basic IP info that is available throughout the stack.</li><li>illinfo_t * - IP lower level info; details about the network interface.</li><li>etherinfo_t * - Ethernet header info.</li><li>ipv4info_t * - IPv4 header info.</li><li>ipv6info_t * - IPv6 header info.</li><li>tcpinfo_t * - TCP header info.</li><li>tcpfuseinfo_t * - TCP fusion details.</li><li>udpinfo_t * - UDP header info.</li><li>icmpinfo_t * - ICMP header info.</li></ul><p>Other arguments will be added as required.</p><h2 id="HPlan"><span>Plan</span></h2><p>Network stack instrumentation with DTrace will be achieved through two projects, one to create customer-orientated providers, the other for engineer-orintated providers:</p><ul><li>public/stable/customer providers for generic observability<br/>ip:::, tcp:::, udp:::, ...</li><li>private/unstable/engineer interface for code path observability<br/>sdt:::ip*</li></ul><h3 id="HCustomerProviderPlan"><span>Customer Provider Plan</span></h3><p>The following are rough steps for creating a suite of customer-orientated network providers. Each step may be integrated separately.</p><pre>
1. IP Provider
        ip:::send
        ip:::receive

2. TCP Provider
        tcp:::send
        tcp:::receive
        tcp:::accept-*
        tcp:::connect-*
        tcp:::state-*
        tcp:::retransmit
        tcp:::timeout-*
        tcpf:::send
        tcpf:::receive

3. UDP Provider
        udp:::send
        udp:::receive
        udp:::stream-*

4. IP Provider
        ip:::drop-in
        ip:::drop-out
        (usr/src/uts/common/inet/ip/ipdrop.c)

5. IP Provider
        ip:::request
        ip:::deliver

6. IP packet ids
        ip:::packet-free
        perhaps a new mblk_t member: (uint64_t)mblk_t-&gt;b_id;
        future, any suitible uint64_t: (uint64_t)nifty_t-&gt;n_id;

7. Socket Provider
        socket:::send
        socket:::receive

8. ICMP Provider
        icmp:::send
        icmp:::receive

9. ARP Provider
        arp:::send
        arp:::receive

10. SCTP Provider
        sctp:::send
        sctp:::receive

11. GLD Provider
        gld:::send
        gld:::receive

12. TCP/UDP connection ids
        /connfs
</pre><p>Dropped from the list:</p><pre>
13. DTrace Enhancements
        write() action
        msgdcopy() action
</pre><p>Task 13 would allow a DTrace script to output an RFC 1761 file for reading using snoop or wireshark. A prototype was written, but work has been halted in favour of the other tasks in the plan. Snoop is more suitable for capturing packet data on high speed networks.</p><h3 id="HEngineerProviderPlan"><span>Engineer Provider Plan</span></h3><p>Many probes have already been integrated into Solaris Nevada for detailed observability of network stack behaviour:</p><pre>
dtrace -ln 'sdt:::ip*' | awk 'BEGIN { OFS=":::" } { print $2,$5 }'
PROVIDER:::NAME
sdt:::ip-ire-del
sdt:::ip-ire-del-origin
sdt:::ip6-physical-out-end
sdt:::ip6-physical-out-end
sdt:::ip6-physical-out-start
sdt:::ip6-loopback-in-end
sdt:::ip6-loopback-in-end
sdt:::ip6-loopback-in-start
sdt:::ip6-loopback-in-start
sdt:::ip6-forwarding-end
sdt:::ip6-forwarding-start
sdt:::ip6-physical-in-end
sdt:::ip6-physical-in-start
sdt:::ip-xmit-incomplete
sdt:::ip-xmit-v4
sdt:::ip-wput-ipsec-bail
sdt:::ip6-loopback-out-end
sdt:::ip6-loopback-out-end
sdt:::ip6-loopback-out-end
sdt:::ip6-loopback-out-start
sdt:::ip6-loopback-out-start
sdt:::ip6-loopback-out-start
sdt:::ip4-loopback-in-end
sdt:::ip4-loopback-in-end
sdt:::ip4-loopback-in-start
sdt:::ip4-loopback-in-start
sdt:::ip4-loopback-out_end
sdt:::ip-xmit-1
sdt:::ip-xmit-2
sdt:::ip4-loopback-out-end
sdt:::ip4-loopback-out-end
sdt:::ip4-loopback-out-end
sdt:::ip4-loopback-out-end
sdt:::ip4-loopback-out-start
sdt:::ip4-loopback-out-start
sdt:::ip4-loopback-out-start
sdt:::ip4-loopback-out-start
sdt:::ip4-dhcpinit-pkt
sdt:::ip4-physical-in-end
sdt:::ip4-physical-in-start
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-end
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-physical-out-start
sdt:::ip4-forwarding-end
sdt:::ip4-forwarding-end
sdt:::ip4-forwarding-start
sdt:::ip4-forwarding-start
sdt:::ip-newroute-drop
sdt:::ip6-physical-out_start
</pre><p>In particular, the probes added as part of ipf (eg, sdt:::ip4-physical-out-start) form a good model to build upon.</p><h2 id="HTesting"><span>Testing</span></h2><p>Ongoing testing of the network providers will be needed for maintaining their accuracy. It is expected to be achieved through two forms of testing:</p><ol><li><strong>Customer testing.</strong> The SUNWdtrt (DTrace Test Suite) package will include basic tests that can be initiated from a single host, as with the other tests in SUNWdtrt. These tests will generate simple network traffic which will be traced, confirming that the probes and arguments work as expected. These tests are expected to be frequently executed by engineers as part of existing ongoing testing of SUNWdtrt, and by customers when troubleshooting DTrace. There are limitations with single host testing, and some code paths such as those that require special hardware (crypto accelerator cards, NICs that support LSO, etc.) will usually not be tested.</li><li><strong>Engineer testing.</strong> Using multiple hosts with a variety of different hardware, tests can be executed by hand by generating traffic, tracing details, and confirming that all values are as expected. This will happen during development of each task from the plan and if/whenever bugs are lodged. A test team at Sun with access to a test farm could take this onboard as an ongoing task.</li></ol><h2 id="HSolutions"><span>Solutions</span></h2><p>Some of the network obserability problems that this provide will solve include:</p><ul><li>Who is connecting to my web server? (TCP accepts by IP address)</li><li>Which services are busy? (bytes by destination port)</li><li>Which hosts are responsible for network load? (bytes by IP address)</li><li>Are hackers/crackers port scanning my server? (TCP flag matching by IP address)</li><li>Why are outbound connections slow? (Connect latency, 1st byte latency, throughput latency)</li></ul><h2 id="HComments"><span>Comments</span></h2><p>This design has been publically open for comments for several months, and discussed a number of times on the <span class="wikiexternallink"><a href="http://mail.opensolaris.org/mailman/listinfo/dtrace-discuss">dtrace-discuss</a></span> mailing list. Time is now running out before these probes will begin to be integrated.</p><p>Updated: 27-Aug-2008</p>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:07<br/>
          </div>
    <div class="xdocLastModification">       Last modified by Alta Elstad on 2009/10/29 00:44
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Community Group dtrace Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+dtrace/ChangeLog">Change Log</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+dtrace/NetworkProvider">DTrace Network Provider</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+dtrace/CEC2006">CEC 2006 Demo</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+dtrace/dexplorer">DExplorer</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+dtrace/dtest">DTrace Test Suite</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+dtrace/dtracetoolkit">DTraceToolkit</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+dtrace/shells">Providers for Various Shells</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2012, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
