<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Solaris Drivers (Community Group advocacy.intro-solaris-drivers) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers" />
                    <link rel="canonical" href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers" />
                            <meta name="document" content="Community Group advocacy.intro-solaris-drivers"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Community Group advocacy"/>
    <meta name="page" content="intro-solaris-drivers"/>
    <meta name="version" content="1.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Community+Group+advocacy/pages/intro-solaris-drivers"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Solaris Drivers" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="admin" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Community Group advocacy";
XWiki.currentPage = "intro-solaris-drivers";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers";
window.docediturl = "/bin/edit/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers";
window.docsaveurl = "/bin/save/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers";
window.docgeturl = "/bin/get/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Community_Group_advocacy viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FCommunity%2BGroup%2Badvocacy%2Fintro-solaris-drivers"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+advocacy/"><strong>Community Group advocacy</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Community+Group+advocacy" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
            </td>
            <td id="logo-text" style="width: 1%;">
                Solaris
            </td>         
            <td style="width: 98%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Community+Group+advocacy/articles'>Articles</a> <span class='separator'>&#187;</span> <span class='current'>Solaris Drivers</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Solaris Drivers</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h1 id="HInsideOpenSolaris:IntroductiontoSolarisDrivers"><span>Inside OpenSolaris: Introduction to Solaris Drivers</span></h1><h3 id="HbyMaxBruning"><span>by Max Bruning</span></h3><p>April 1, 2005</p><p>This article explains basic driver programming. We assume some familiarity with device drivers and devices and in general discuss Solaris 10 and Linux 2.6. Most of the article should hold for earlier releases of either system.</p><p>The covered topics are:</p><ul><li>Introduction</li><li>System Architecture and the Device Tree</li><li>Types of Devices/Drivers<ul><li>Host Bus Adapters (SCSI, IDE, etc.)</li><li>Network Drivers</li><li>USB Drivers</li></ul></li><li>Tools</li><li>Compilation and Installation</li><li>Debugging</li></ul><p>Introduction</p><p>This section describes how devices are visible to users on Solaris, that is, where the device files reside on Solaris and what their organization. It also gives an overview of Solaris and Linux device drivers, listing routines and data structures needed to implement device drivers in both systems along with a brief description. A table lists similarities and differences between routines and data structures.</p><p>Both Solaris and Linux device drivers serve the same purpose, to provide a means for the system, as well as users on the system, to control and access devices. For the most part, user access to devices is via standard I/O system calls: <span class="box code">open(2)</span>, <span class="box code">close(2)</span>, <span class="box code">read(2)</span>, <span class="box code">write(2)</span>, <span class="box code">ioctl(2)</span>, <span class="box code">poll(2)</span>, <span class="box code">mmap(2)</span>, <span class="box code">readv(2)</span>, <span class="box code">writev(2)</span>. These system calls result in calls to device driver routines. In addition, the operating system itself calls driver routines for handling page faults and the various bus architectures that may exist on a system. Various system administrative related system calls may also make calls to device driver routines.</p><p>System Architecture and the Device Tree</p><p>Solaris organizes its devices in a "device tree". Each node on the tree represents a device. The device tree shows the geographical location of devices on the system. In other words, it shows the directory tree in Solaris which corresponds to the location of the the system. Users and programs can examine it via the <em>/devices</em> directory tree and via the <span class="box code">prtconf(1)</span> command. Following is an example, with some output truncated and various devices omitted.</p><pre>
bash-2.05b# ls -R /devices
/devices: &lt;~--- //the "root" of the device tree//
isa pci@0,0 pseudo:devctl xsvc
objmgr pci@0,0:devctl scsi_vhci xsvc:xsvc
options pseudo scsi_vhci:devctl

/devices/isa: &lt;~--- //the system has an isa bus//
asy@1,2f8 asy@1,2f8:b,cu i8042@1,60 lp@1,3bc:ecpp0 &lt;~--- //devices on the isa bus//
asy@1,2f8:b fdc@1,3f0 lp@1,3bc

/devices/isa/fdc@1,3f0: &lt;~--- //a floppy disk controller on the isa bus//
fd@0,0 fd@0,0:a,raw fd@0,0:b,raw fd@0,0:c,raw &lt;~--- floppy disk drives/slices
fd@0,0:a fd@0,0:b fd@0,0:c

/devices/isa/i8042@1,60: &lt;~--- //an i8042 controller//
keyboard@0 keyboard@0:kb8042 mouse@1 mouse@1:l

/devices/pci@0,0: &lt;~--- //pci-host bus bridge//
pci-ide@7,1 pci8086,7112@7,2 pci8086,7112@7,2:hubd
pci1014,130@2 pci8086,7112@7,2:1 pci8086,7191@1
pci1014,130@2,1 pci8086,7112@7,2:2 pci8086,7191@1:devctl

/devices/pci@0,0/pci-ide@7,1: &lt;~--- //pci-ide bridge//
ide@0 ide@0:control ide@1 ide@1:control

/devices/pci@0,0/pci-ide@7,1/ide@0: &lt;~--- //1 of 2 ide controllers//
cmdk@0,0 cmdk@0,0:e cmdk@0,0:i,raw cmdk@0,0:n cmdk@0,0:r,raw &lt;~--- //disks/slices//
cmdk@0,0:a cmdk@0,0:e,raw cmdk@0,0:j cmdk@0,0:n,raw cmdk@0,0:s
cmdk@0,0:a,raw cmdk@0,0:f cmdk@0,0:j,raw cmdk@0,0:o cmdk@0,0:s,raw
cmdk@0,0:b cmdk@0,0:f,raw cmdk@0,0:k cmdk@0,0:o,raw cmdk@0,0:t
cmdk@0,0:b,raw cmdk@0,0:g cmdk@0,0:k,raw cmdk@0,0:p cmdk@0,0:t,raw
cmdk@0,0:c cmdk@0,0:g,raw cmdk@0,0:l cmdk@0,0:p,raw cmdk@0,0:u
cmdk@0,0:c,raw cmdk@0,0:h cmdk@0,0:l,raw cmdk@0,0:q cmdk@0,0:u,raw
cmdk@0,0:d cmdk@0,0:h,raw cmdk@0,0:m cmdk@0,0:q,raw
cmdk@0,0:d,raw cmdk@0,0:i cmdk@0,0:m,raw cmdk@0,0:r

/devices/pci@0,0/pci-ide@7,1/ide@1: &lt;~--- //second ide controller//
sd@0,0 sd@0,0:e sd@0,0:i,raw sd@0,0:n sd@0,0:r,raw
sd@0,0:a sd@0,0:e,raw sd@0,0:j sd@0,0:n,raw sd@0,0:s
sd@0,0:a,raw sd@0,0:f sd@0,0:j,raw sd@0,0:o sd@0,0:s,raw
sd@0,0:b sd@0,0:f,raw sd@0,0:k sd@0,0:o,raw sd@0,0:t
sd@0,0:b,raw sd@0,0:g sd@0,0:k,raw sd@0,0:p sd@0,0:t,raw
sd@0,0:c sd@0,0:g,raw sd@0,0:l sd@0,0:p,raw sd@0,0:u
sd@0,0:c,raw sd@0,0:h sd@0,0:l,raw sd@0,0:q sd@0,0:u,raw
sd@0,0:d sd@0,0:h,raw sd@0,0:m sd@0,0:q,raw
sd@0,0:d,raw sd@0,0:i sd@0,0:m,raw sd@0,0:r

/devices/pseudo: &lt;~--- //pseudo device nexus node//
arp@0 pm@0 ptsl@0:ttyp4 &lt;~--- //pseudo devices//
arp@0:arp pm@0:pm ptsl@0:ttyp5
bl@0 poll@0 ptsl@0:ttyp6
 &lt;//output truncated//&gt;
bash-2.05b#
</pre><p>In the example <span class="box code">ls</span> listing above, the name of a device, for instance, <span class="box code"><span style="color: #666666; ">/</span>devices<span style="color: #666666; ">/</span>pci@0,0<span style="color: #666666; ">/</span>pci<span style="color: #666666; ">-</span>ide@7,1</span> shows that there is a PCI controller on the system bus (or motherboard), and on the PCI bus is a PCI-IDE bridge. The device above the given device on the tree chooses the name of the device (preceding the '<span class="box code">@</span>' sign). The device above also chooses the portion of the name following the <span class="box code">@</span> until the '<span class="box code">:</span>' and typically shows the slot number and an offset on the bus on which the device resides. The device driver itself chooses the portion following the '<span class="box code">:</span>'. Linux uses the same names for devices regardless of their location (and regardless of the hardware). For instance, Linux disks are <em>/dev/hda</em>, <em>/dev/hdb</em>, etc., regardless of whether the disk is IDE or SCSI. On Solaris, IDE disks will be <span class="box code">cmdk</span> and SCSI (or ATAPI-based) CD-ROM drives show up as <span class="box code">sd</span>. There are files under <em>/dev</em> as in other Unixes, but these files are symbolic links to the "real" devices under <em>/devices</em>.</p><p>NOTE: Both linux and Solaris 10 use a <span class="box code">devfs</span> device file system to manage devices. This means that the device drivers themselves create and remove nodes. On Solaris, drivers do this by calling <span class="box code">ddi_create_minor_node(9f)</span> and <span class="box code">ddi_remove_minor_node(9f)</span> in their <span class="box code">attach(9f)</span> and <span class="box code">detach(9f)</span> routines respectively. The corresponding routines in Linux are <span class="box code">devfs_mk_dir()</span>, <span class="box code">devfs_mk_cdev()</span>, and <span class="box code">devfs_mk_bdev()</span>, called from the driver's init function and <span class="box code">devfs_remove()</span> called from the driver's cleanup function. Note also that a Linux driver does not have to use devfs, in which case it creates device files by calling <span class="box code">mknod()</span> within the driver or <span class="box code">register_chrdev()</span>, (or register_netdev() for network devices, or other related routine), or by hand. Solaris drivers always use <span class="box code">ddi_create_minor_node(9f)</span> even in Solaris versions before Solaris 10 which did not have devfs, and regardless of the type of device (disk, network, pseudo, etc.).</p><p>Here is <span class="box code">prtconf(1)</span> output, again truncated.</p><pre>
bash-2.05b# prtconf
System Configuration: Sun Microsystems i86pc
Memory size: 512 Megabytes
System Peripherals (Software Nodes):

i86pc
 scsi_vhci, instance #0
 +boot (driver not attached) &lt;~--- //"driver not attached" explained below//
 memory (driver not attached)
 aliases (driver not attached)
 chosen (driver not attached)
 i86pc-memory (driver not attached)
 i86pc-mmu (driver not attached)
 openprom (driver not attached)
 options, instance #0
 packages (driver not attached)
 delayed-writes (driver not attached)
 itu-props (driver not attached)
 isa, instance #0 &lt;~--- //an isa bus on the system board//
 motherboard (driver not attached)
 i8042, instance #0
 mouse, instance #0
 keyboard, instance #0
 fdc, instance #0
 fd, instance #0
 lp, instance #0
 asy, instance #0
 pci, instance #0 &lt;~--- //a pci bus on the system board//
 pci8086,7190 (driver not attached)
 pci8086,7191, instance #0
 display, instance #0
 pci1014,130, instance #0
 pci1014,130, instance #1
 pci10b7,6356 (driver not attached)
 pci10b7,6159 (driver not attached)
 pci1014,153 (driver not attached)
 pci8086,7110 (driver not attached)
 pci-ide, instance #0 &lt;~--- //pci-ide bridge//
 ide, instance #0
 cmdk, instance #0
 ide, instance #1
 sd, instance #0
 pci8086,7112, instance #0
 pci8086,7113 (driver not attached)
 used-resources (driver not attached)
 pseudo, instance #0
 xsvc, instance #0
 objmgr, instance #0
 cpus (driver not attached)
 cpu, instance #0 (driver not attached)
bash-2.05b#
</pre><p><span class="box code">"driver not attached"</span> means either there is no driver, the device is not being used and the driver is not loaded, or the hardware is configured but physically does not exist. Use <span class="box code">prtconf <span style="color: #666666; ">-</span>D</span> to find the driver (if one exists) for each device.</p><p>It's possible to classify drivers on Solaris as "nexus" drivers and "leaf node" drivers. Those devices which have other devices attached to them (typically via a bus) use nexus drivers. Examples include bus controllers, such as PCI-host bus bridges, and PCI-PCI bridges. Leaf node drivers are for devices that do not have additional attached devices. These include pseudo devices, network drivers, graphics cards, and storage devices. Most devices on a system are leaf node devices.</p><p>Leaf node device drivers are either character devices and/or block devices. A block device is any device that has addressable, re-usable data -- disks, for example. Any device can be implemented as a character device. A disk driver is both a character and a block device. Some nexus devices have a character device implementation as well as a nexus driver implementation.</p><p>Types of Devices/Drivers</p><p>Some bus drivers allow <span class="box code">ioctl(2)</span> calls, which necessitates leaf driver structures and routines. SCSI host bus adapters (devices that convert between some bus on the system; PCI, for instance), and a SCSI bus are a form of nexus node that use a framework developed for handling SCSI hba's called SCSA (Sun Common SCSI Architecture). The following sections briefly describe some of the different types of devices and device driver frameworks used to support the different types of devices.</p><p>Host Bus Adapters (SCSI, IDE, etc.)</p><p>&nbsp;The Sun Common SCSI Architecture, or SCSA, allows the development of target drivers (such as disk, tape, scanner, etc.) without knowledge of the HBA controller that manages the SCSI bus. Likewise, HBA drivers do not need to know anything about the targets that are on the SCSI bus.</p><p>The following is a high level view of how SCSA-compliant target and HBA drivers work together. All routines starting with <span class="box code">scsi_</span> are part of the SCSA. NOTE: This is not a complete description. Refer to <span class="wikiexternallink"><a href="http://docs.sun.com/app/docs/doc/816-4854">Writing Device Drivers</a></span> for more detail.</p><pre>

User reads/writes a file;

 foo_strategy(struct buf *bp) /* target driver strategy routine */
 scsi_init_pkt(...); /* calls hba to alloc and init a SCSI packet */
 /* see scsi_init_pkt(9F) and scsi_pkt(9s) */
 makecom_g5(...); /* build the scsi command descriptor block, see makecom(9f) */
 place completion callback routine pointer into scsi_pkt;

 scsi_transport(...); /* hand over built scsi packet to HBA for transport on the bus */

 bar_tran_start(...) /* hba routine to handle scsi pkts */

 send command to target on SCSI bus via HBA;

 bar_intr(...) /* interrupt handler following completion/timeout */
 clean up;
 call target callback function via scsi_pkt;
 foo_completion(...) /* target callback function */
 biodone(bp); /* wakeup waiting readers/writers */
 scsi_free_pkt(...);
</pre><p>Network Drivers</p><p>Solaris uses STREAMS messages to pass packets between different components of the network protocol stack. The <span class="wikiexternallink"><a href="http://docs.sun.com/app/docs/doc/806-6546">STREAMS Programming Guide</a></span> has a detailed discussion of STREAMS. Note that Solaris 10 has reworked TCP/IP so that TCP and IP are not separate STREAMS modules. This was done mostly to address performance issues. See the description of "fireengine" on Solaris Express for more details.</p><p>On Solaris, a network driver must be STREAMS cognizant and must adhere to the DLPI specification. DLPI (Data Link Provider Interface), is a specification for STREAMS data link (network controller) drivers. Because STREAMS and DLPI add a lot of complexity to writing a network driver, Sun developed the Generic Lan Driver (gld) to hide DLPI and most of STREAMS from network drivers.</p><p>With gld, you register a set of callbacks with GLD in your driver's attach function. When gld needs your driver to do something, it calls one of your registered callbacks. A full Chapter 18 of <span class="wikiexternallink"><a href="http://docs.sun.com/app/docs/doc/816-4854/6mb1o3agr?a=view">Writing Device Drivers</a></span> gives a full example of a gld-based driver.</p><p>USB Drivers</p><p>Solaris has a framework analogous to Linux's framework (api) for developing USB drivers. See the <span class="wikiexternallink"><a href="http://www.sun.com/bigadmin/software/usbskel">USB Skeleton Device Driver</a></span> for an example. Also, the Writing Device Drivers guide has a description of the USB framework in <span class="wikiexternallink"><a href="http://docs.sun.com/app/docs/doc/816-4854/6mb1o3ah2?a=view">Chapter 19</a></span>.</p><p>Tools</p><p>This section describes how to build and install a Solaris driver and debugging tools.</p><p>Compilation and Installation</p><p>To compile your driver, use Sun's C compiler (though I have had some success with gcc). THe steps are:</p><pre>
# cc -xarch=v9 -D_KERNEL -O -c foo.c &lt;~-- //-xarch=v9 needed for SPARC//
# cc -xarch=v9 -D_KERNEL -O -c bar.c &lt;~-- //compile each .c file for your driver//
# ld -r -o foobar foo.o bar.o &lt;~-- //create a relocatable object, foobar//
 &lt;~-- //dependencies on other kernel modules//
 &lt;~-- //can be specified with -Ndrv/module//
 &lt;~-- //for example, ld -Nmisc/scsi ...//
 &lt;~-- //for a scsa-compliant driver//
</pre><p>To install your driver, copy the relocatable module to the appropriate directory (typically <em>/usr/kernel/drv, /kernel/drv</em>, or <em>/kernel/`uname -m`/kernel/drv</em>. On SPARC, the driver goes in the <em>sparcv9</em> subdirectory. If your driver has a <em>driver.conf</em> file, it goes in the <em>drv</em> directory (not the <em>sparcv9</em> directory). After copying the driver to the appropriate location, use <span class="box code">devfsadm(1M)</span> or <span class="box code">add_drv(1M)</span>.</p><pre>
# cp foobar /usr/kernel/drv/sparcv9/foobar &lt;~-- //no sparcv9 for x86//
# cp foobar.conf /usr/kernel/drv/foobar.conf
#
# add_drv foobar
# &lt;~-- // any output here is probably an error!//
#
</pre><p>After installing the driver, you should find device files for it in the <em>/devices</em> tree. NOTE: If you run into problems, be sure to <span class="box code">rem_drv foobar</span> before adding it again. Also note that <span class="box code">devfsadm <span style="color: #666666; ">-</span>v foobar</span> can give better diagnostics when things don't work.</p><p>Debugging</p><p>Solaris has four basic debugging tools that come with the system:</p><ul><li><span class="box code">mdb</span>, the Modular Debugger. This is useful in examining panic dumps as well as the running system. It also works with applications. The syntax of mdb is basically the same as <span class="box code">ed</span>, the old Unix line text editor. The <span class="wikiexternallink"><a href="http://docs.sun.com/app/docs/doc/806-6545">Modular Debugger Guide</a></span> gives a complete description and various usage examples.</li><li><span class="box code">kmdb</span> allows you to set breakpoints and single step within the kernel on a live system. Invoke it via <span class="box code">mdb <span style="color: #666666; ">-</span>K</span>. The syntax and features are very similar to mdb. It's very useful for analyzing hangs (provided you can reproduce them under kmdb). You may load kmdb via <span class="box code">mdb <span style="color: #666666; ">-</span>k</span>, or have it loaded on boot by <span class="box code">boot kmdb</span>. To enter into kmdb once it loads, use <span class="box code">stop<span style="color: #666666; ">-</span>A</span> on a Sun console or <span class="box code">ctl<span style="color: #666666; ">-</span>alt<span style="color: #666666; ">-</span>d</span> on an x86 console, or use <span class="box code">tip(1)</span> or <span class="box code">telnet</span> into a terminal server with the console set up to use a serial port. Be careful with <span class="box code">ctl<span style="color: #666666; ">-</span>alt<span style="color: #666666; ">-</span>d</span> on x86, as you must not be in a graphics mode, so no windowing system (JDS, Gnome, KDE, CDE, etc.). If you enter kmdb on such a system, you will not be able to see what is going on. It's better to reboot and use command line login, or, even better, set up a serial console and run kmdb from a window on another machine. <span class="wikiexternallink"><a href="http://docs.sun.com/app/docs/doc/816-4854/6mb1o3ahp?a=view">Chapter 21</a></span> of Writing Device Drivers gives examples of using mdb and kmdb for debugging.</li><li><span class="box code">dtrace</span>, the Dynamic Tracing Tool. This tool allows you to trace entry and return from function calls within the kernel dynamically. It also does much more. <span class="wikiexternallink"><a href="http://docs.sun.com/app/docs/doc/817-6223">Solaris Dynamic Tracing Guide</a></span> is a 275 page manual describing dtrace.</li><li><span class="box code">cmn_err(9f)</span> is the equivalent to Linux's <span class="box code">printk()</span>.</li></ul><p>Conclusion</p><p>Now that you know how Solaris manages its drivers and have some familiarity with the available tools for using, compiling, and debugging drivers, perhaps you'd like to write drivers. Fear not; the next article in this series will explain some of the kernel interfaces and conventions for Solaris driver programming.</p><p>Max Bruning currently teaches and consults on Solaris internals, device drivers, kernel (as well as application) crash analysis and debugging, networking internals, and specialized topics. Contact him at <span class="wikiexternallink"><a href="mailto:max%20at%20bruningsystems%20dot%20com">max at bruningsystems dot com</a></span> or <span class="wikiexternallink"><a href="http://mbruning.blogspot.com/"><span class="wikiexternallink"><a class="wikimodel-freestanding" href="http://mbruning.blogspot.com/."><span class="wikigeneratedlinkcontent">http://mbruning.blogspot.com/.</span></a></span></a></span></p>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:07<br/>
          </div>
    <div class="xdocLastModification">       Last modified by admin on 2009/10/26 12:07
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Community Group advocacy Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/articles">Articles</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/christensen%2Dprofile">Profile: Christensen</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/dtrace%2Dteam%2Dprofile">Profile: DTrace</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/intro%2Dsolaris%2Ddrivers">Solaris Drivers</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/schilling%2Dprofile">Profile: Schilling</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/solaris%2Ddriver%2Dprogramming">Driver Programming</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/solaris%2Dlinux%2Dfreebsd">Solaris, Linux, BSD</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/solaris%2Dx86%2Dnotebooks">Solaris on Notebooks</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/teer%2Dprofile">Profile: Teer</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/tucker%2Dprofile">Profile: Tucker</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/using%2Dvmware">OpenSolaris & VMWare</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/buttons">Fan Buttons</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/files">Files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/marketing">Marketing</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/articles%2Dvideos%2Dstuff">Articles and Videos</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/buy%2Dswag">OpenSolaris Swag</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/contributoraward">Contributor Awards</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/help">How you can help</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/highlights">Marketing Highlights</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/homepagegraphics">Graphics July 2006</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/immigrants">Immigrants</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/mktg%2Dannouncements">Marketing Announces</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/mktgdownloads">OpenSolaris Artwork</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/merger%2Darchive">Merger Archive</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/newsletter">Newsletter Archive</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/0405">2004&#45;2005</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/2006">2006</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/2007">2007</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/2008">2008</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/2009">2009</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/os%2Dpresentations">OSUG Presentations</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/techdays%2Darchive%2D06%2D07">Tech Days 06&#45;07</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/techdays%2Darchive%2D07%2D08">Tech Days 07&#45;08</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/ug%2Dleaders">User Group Leaders</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Community+Group+advocacy/usergroups">User Group Background</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2013, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
