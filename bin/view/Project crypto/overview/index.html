<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Overview (Project crypto.overview) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Project+crypto/overview" />
                    <link rel="canonical" href="/bin/view/Project+crypto/overview" />
                            <meta name="document" content="Project crypto.overview"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Project crypto"/>
    <meta name="page" content="overview"/>
    <meta name="version" content="1.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Project+crypto/pages/overview"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Overview" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="Administrator" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Project crypto";
XWiki.currentPage = "overview";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Project+crypto/overview";
window.docediturl = "/bin/edit/Project+crypto/overview";
window.docsaveurl = "/bin/save/Project+crypto/overview";
window.docgeturl = "/bin/get/Project+crypto/overview";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Project_crypto viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FProject%2Bcrypto%2Foverview"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+crypto/"><strong>Project crypto</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Project+crypto" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <div id="header_banner">
	<table style="width: 100%;">
	    <tr>
		<td style="width: 1%;">
		    <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
		</td>
		<td id="logo-text" style="width: 1%;">
		    Solaris
		</td>         
		<td style="width: 98%;">
		    <table id="loading-indicator">
			<tr>
			    <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
				    alt="Loading" title="Loading"/></td>
			    <td>Loading...</td>
			</tr>
		    </table>
		</td>
		<td style="width: 1%;">
		    <table id="iconbar">
			<tr>
			<td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
			    Collectives</a></td>
			<td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
				Discussions</a></td>
			<td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
				Documentation</a></td>
			<td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
				Download</a></td>
			<td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
				Source Browser</a></td>
			</tr>
		    </table>
		</td>
	    </tr>
	</table>
    </div>
    <div id="site-notice">
	<span>
	    <a href="https://markebrooks.github.io/bin/view/Main/">ATTENTION: This website and all services within the opensolaris.org domain will be unavailable after March 24, 2013.</a>	   
	</span>
    </div>
</div>
 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                  <span class='current'>Overview</span>
          </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Project+crypto/overview?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Project+crypto/overview?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+crypto/overview?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+crypto/overview?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+crypto/overview?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Project+crypto/overview?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crypto/overview?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crypto/overview?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crypto/overview?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Project+crypto/overview?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Project+crypto/overview?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Project+crypto/overview?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Overview</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h2 id="H1.0OverviewoftheCryptoFramework"><span>1.0 Overview of the Crypto Framework</span></h2><p>[ Note that these are extracts from the original white paper, there are<br/>&nbsp;&nbsp;sections omitted because they are no longer relevant but the original<br/>&nbsp;&nbsp;numbering has been left alone ]</p><p>The (Open)Solaris Cryptographic Framework provides cryptographic services to users and applications through commands, a user-level programming interface, a kernel programming interface, and user-level and kernel-level frameworks. &nbsp;The Solaris Cryptographic Framework provides these cryptographic services to applications and kernel modules in a manner seamless to the end user, and brings direct cryptographic services, like encryption and decryption for files, &nbsp;to the end user.</p><p>The user-level framework is responsible for providing cryptographic services to consumer applications and the end user commands. The kernel-level framework provides cryptographic services to kernel modules and device drivers. &nbsp;Both frameworks give developers and users access to software optimized cryptographic algorithms.</p><p>The programming interfaces are a front end to each of the frameworks. &nbsp;A library or a kernel module that provides cryptographic services can be plugged into one of the frameworks by the system administrator, making the plugin's cryptographic services available to applications or kernel modules. &nbsp;This flexibility allows the system administrator to plugin different cryptographic algorithm implementations or hardware accelerated cryptographic providers.</p><h2 id="H2.0FrameworkArchitecture"><span>2.0 Framework Architecture</span></h2><p>This section provides an overview of the Solaris Cryptographic Framework's architecture. &nbsp;The following diagram illustrates this architecture and the interrelationships between its many components and the Solaris Operating System.</p><h2 id="H2.1CryptographicApplications"><span>2.1 Cryptographic Applications</span></h2><p>Components found in the application layer generally are not intended to provide generalized features to other applications, but rather perform a single class of function. &nbsp;An example application would be a Sendmail mail server whose role is to route the transfer of an email message towards its recipient. &nbsp;The mail server may make use of cryptography in order to protect the message as it traverses a hop to the next mail server. &nbsp;However the mail server does not provide protection for any other type of communication between the nodes.</p><p>In Solaris’s cryptographic architecture, applications will not directly contain cryptographic algorithms (e.g. DES). &nbsp;Instead they will just make use of features of the Cryptographic Security Services available from the Solaris Operating System. &nbsp;This reduces code redundancy and provides access to optimized algorithms for all applications.</p><h2 id="H2.2CryptographicSecurityServices"><span>2.2 Cryptographic Security Services</span></h2><p>The Solaris Operating System contains a variety of security services that will make indirect use of cryptography. &nbsp;A high level library offers a generalized interface for authenticating entities communicating across the network and optionally message integrity and privacy. &nbsp;Similar to the application components, these security services will not contain cryptographic algorithms in them, but rather will leverage a common set of cryptography frameworks below.</p><div class="wikimodel-emptyline"></div><h2 id="H2.3Framework"><span>2.3 Framework</span></h2><p>The framework components provide an abstracted, consistent interface to the Cryptographic Security Services for use of cryptography. &nbsp;These interfaces intend to make it easier for operating system components to integrate strong security into their offerings. &nbsp;An example framework component is the User-Level Cryptographic Framework. &nbsp;This framework offers an RSA Security Inc. PKCS #11 Cryptographic Token Interface (Cryptoki) standards-based [1] programmatic interface to security services, and a pluggable interface where appropriately signed cryptographic providers can register and provide services via the framework.</p><p>Similar to the Cryptographic Security Service components, the framework components do not directly include cryptography, but do offer a generalized programmatic interface to other parts of the operating system.</p><h2 id="H2.4CryptographyProviders"><span>2.4 Cryptography Providers</span></h2><p>The components at this bottom layer offer the actual cryptographic algorithms. &nbsp;For example, this layer includes software implementations of 3DES, AES, RSA, and SHA-1 just to name a few in the Sun Software Crypto Plugin. &nbsp;These providers offer a PKCS #11 compliant user-level interface and PKCS #11 like kernel-level interface that is designed to plug into the Cryptographic Frameworks.</p><p>Since it is possible for 3rd parties to write new or replace existing algorithms used by the Solaris Cryptographic Framework, the framework validates that each plugin provider has an appropriate, embedded cryptographic signature. &nbsp;This signature limits who can write a provider that the framework will recognize and allow to operate and potentially limit the consumers who can make use of it.&nbsp;</p><h2 id="H3.2User-LevelCryptographicFramework28uCF29"><span>3.2 User-Level Cryptographic Framework (uCF)</span></h2><p>The first framework exists outside the kernel (at the user process level) and is intended for use by most consumers. This framework is referred to as the User-Level Cryptographic Framework, or uCF for short. &nbsp;The uCF offers a PKCS #11 v2.11 based API to callers wishing to have cryptographic operations performed. &nbsp;PKCS #11 was chosen for the User-Level Cryptographic Framework API because of the large volume of existing software that already supports this interface and the large number of developers that already understand this interface.&nbsp;&nbsp;</p><p>Below the API is mostly logic intending to glue the many cryptographic providers together and make it appear as single aggregate provider. &nbsp;The uCF exposes a list of cryptographic ?slots? (as they are known in PKCS #11) that enable the application to select the provider which best suits the application's particular needs.&nbsp;&nbsp;</p><p>At the bottom of the uCF is the pluggable cryptography provider interface. &nbsp;This interface is what cryptographic providers must implement in order to be usable with uCF. &nbsp;This provider interface also follows the PKCS #11 v2.11 interface, with the additional requirement that any provider that is configured to plug in must include a cryptographic signature. The signature is associated with an RSA key included in a certificate issued by Sun. &nbsp;&nbsp;&nbsp;This framework uses the Module Verification Daemon to verify that the provider is authorized for use, and to determine if there are usage restrictions on the provider. &nbsp;See section 3.3 for details on this daemon.</p><h3 id="H3.2.1.1ConvenienceFunctions"><span>3.2.1.1 Convenience Functions</span></h3><p>In addition to the standard PKCS #11 interfaces, Sun has provided two convenience functions that assist in the setup of PKCS #11 and with object creation. &nbsp;These functions do not exist in other implementations of PKCS #11, but rather are part of uCF.</p><p>CK_RV SUNW_C_GetMechSession(CK_MECHANISM_TYPE mech,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CK_SESSION_HANDLE_PTR hSession);</p><p>Calling SUNW_C_GetMechSession() initializes the &nbsp;framework and &nbsp;does &nbsp;all of the necessary PKCS #11 calls to create a session that is capable of providing operations on the requested mechanism. It is not necessary to call C_Initalize() or C_GetSlotList() before the first call to SUNW_C_GetMechSession().</p><p>If the function is called multiple times it will return a new session without re-initalizing the framework. If it is unable to return a new session, then CKR_SESSION_COUNT is returned.</p><p>C_CloseSession() should be used to release the session when it is no longer required.</p><p>CK_RV SUNW_C_KeyToObject(CK_SESSION_HANDLE hSession,<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CK_MECHANISM_TYPE mech, const void *rawkey, <br/>&nbsp;&nbsp;&nbsp;&nbsp;size_t rawkey_len, CK_OBJECT_PTR obj)</p><p>Calling SUNW_C_KeyToObject() creates a symmetric key object for the given mechanism from the rawkey data. The rawkey is a pointer to any buffer. &nbsp;The value of rawkey will be used to set the CKA_VALUE attribute in the resulting object. This function is useful if the programmer does not want to take all the steps necessary to setup a key template. The object should be destroyed with C_DestroyObject() when it is no longer required.</p><p>For more detailed information on the uCF API, please see the RSA PKCS #11 website [1].</p><h2 id="H3.2.2Kernel-LevelCryptographicFramework28kCF29"><span>3.2.2 Kernel-Level Cryptographic Framework (kCF)</span></h2><p>The other framework associated with the Solaris Cryptographic Framework exists<br/>within the kernel boundary and is known as the Kernel-level Cryptographic<br/>Framework, or kCF. &nbsp;&nbsp;The kCF contains similar functionality to the uCF. The kCF<br/>offers a consumer and provider interface that is more applicable for kernel<br/>modules, such as cryptographic modules and device drivers from Sun and from<br/>third parties. The kCF can be used for Sun and third party cryptographic modules<br/>and device drivers. &nbsp;&nbsp;The kCF contains no cryptography itself, not even for<br/>performing plugin provider verification. &nbsp;This is because verification of each<br/>kernel-level provider is delegated to the Module Verification Daemon that<br/>executes at the user level and uses the same verification code as is used by<br/>uCF.</p><p>There are some differences between the frameworks. The kCF not only offers a<br/>consumer and provider interface, but it also has two private device drivers,<br/>/dev/crytpo and /dev/cryptoadm. &nbsp;uCF uses /dev/crypto (via a plugin provider) to<br/>communicate with kCF. The module verification daemon and the cryptoadm(1M)<br/>command use /dev/cryptoadm to communicate with kCF. Additionally, kCF provides<br/>scheduling and load balancing for cryptographic operations for kernel consumer,<br/>as well as offers an asynchronous mode for the consumer interface routines.</p><h2 id="H4.0KernelProgrammingInterface"><span>4.0 Kernel Programming Interface</span></h2><p>The common data structures crypto_mechanism_t, crypto_data_t,<br/>crypto_dual_data_t, &nbsp;crypto_key_t, crypto_context_t and<br/>crypto_context_template_t are defined in the following man pages:</p><pre>
    crypto~_data(9S)
    crypto~_dual~_data (9S)
    crypto~_mechanism(9S)
    crypto~_mech~_info(9S)
    crypto~_object~_attribute(9S)
    crypto~_key(9S)
    crypto~_call~_req(9S)
</pre><p>The routines that make up this programming interface are detailed in the<br/>following man pages:</p><pre>
    crypto~_bufcall(9F)
    crypto~_bufcall~_alloc(9F)
    crypto~_bufcall~_free(9F)
    crypto~_cancel~_ctx(9F)
    crypto~_cancel~_req(9F)
    crypto~_create~_ctx~_template(9F)
    crypto~_digest(9F)
    crypto~_encrypt(9F)
    crypto~_encrypt~_mac(9F)
    crypto~_get~_all~_mech~_info(9F)
    crypto~_get~_mech~_list(9F)
    crypto~_key~_check(9F)
    crypto~_mac(9F)
    crypto~_mac~_decrypt(9F)
    crypto~_mech2id(9F)
    crypto~_notify~_events(9F)
    crypto~_unbufcall(9F)
</pre><p>Draft text only copies of the man pages can be found <span class="wikiexternallink"><a href="https://markebrooks.github.io/bin/download/Community+Group+security/files/kcf-man.tar.gz">here</a></span>.</p><p>The programmer should be particularly aware of the following features emphasized<br/>hereafter.</p><h3 id="H4.1.1Callrequests"><span>4.1.1 Call requests</span></h3><p>Most of the functions of this programming interface take a pointer to a<br/>crypto_call_req structure that specifies the conditions of an asynchronous call<br/>and the expected behavior. A NULL crypto_call_req_t pointer indicates a<br/>synchronous call.</p><p>The API/framework internally allocates memory for a request when it needs to<br/>queue it. This allocation uses KM_SLEEP for synchronous calls and KM_NOSLEEP for<br/>asynchronous calls. As a result, asynchronous calls can fail with a<br/>CRYPTO_HOST_MEMORY error if memory is not available when the request is issued.</p><p>Some of the Cryptographic Service Provider Interface (CSPI) entry points, such<br/>as digest_init(), allocate memory, and take a kmflag argument which can be<br/>KM_SLEEP or KM_NOSLEEP. This kmflag is set to the appropriate value by the<br/>framework when calling the provider's CSPI entry point.</p><h3 id="H4.1.2Asynchronouscalls"><span>4.1.2 Asynchronous calls</span></h3><p>For asynchronous calls, a caller has to pass non-NULL crypto_call_req_t pointer.</p><p>When the caller passes in a non-NULL crypto_call_req_t pointer, there are two<br/>cases:</p><ul><li>CRYPTO_ALWAYS_QUEUE cr_flag set:<br/>The calling code does not want to spend any CPU cycles on costly cryptographic<br/>operations, or cannot safely make any blocking call (blocking memory allocation<br/>acquiring a mutex possibly held at a different PIL). This is typically the case<br/>of a call coming from an interrupt context, or timeout handler.</li></ul><p>The request associated to this call is always queued and the call returns<br/>CRYPTO_QUEUED.</p><ul><li>CRYPTO_ALWAYS_QUEUE cr_flag clear:<br/>The calling code can spend the CPU cycles on the cryptographic operations, and<br/>can tolerate spinning on locks. However, the calling code doesn't want to be put<br/>in cv_wait() internally.<br/> &nbsp;<br/>A typical consumer of this case is a streams module running its service or write<br/>put procedure. This is especially reasonable with message digest operations that<br/>are fast enough in software and the overhead of extra queuing/interruptions and<br/>context switching overcomes the potential performance gain from offloading these<br/>operations to hardware accelerators.<br/> &nbsp;<br/>The framework will return asynchronously only when it is necessary; that is,<br/>when it needs to either queue the request or dispatch it to a hardware<br/>provider.<br/>&nbsp;&nbsp;</li></ul><p>When a request is submitted; that is, when the returned value from a crypto<br/>function is CRYPTO_QUEUED, the cr_req is initialized to a handle for the<br/>request. The consumer code will use that handle to cancel the request if it<br/>needs to do so.</p><p>In all cases of a queued request, upon completion, the framework will call</p><p>&nbsp;(cr-&gt;cr_callback_f)(cr-&gt;cr_callback_arg, finish_status);</p><p>where finish_status contains an integer value corresponding to the execution<br/>status of the request. Possible values are defined &nbsp;in &lt;sys/crypto/common.h&gt;,<br/>see Appendix E.</p><p>Once a crypto context of a multipart crypto operation is initialized (an<br/>xxx_init() completed), a consumer does not need to wait for the completion of<br/>the previous part before submitting the next one. Several requests for the same<br/>crypto_context can be pending.</p><p>The order of submission is guaranteed to be preserved for requests of the same<br/>context. Thus, a notification of request completion implicitly notifies the<br/>completion of ALL the preceding requests.&nbsp;</p><p>The consumer code can choose to disable the callback to be invoked after the<br/>intermediate calls are complete with success, by leaving the cr_flag<br/>CRYPTO_NOTIFY_OPDONE clear in the crypto_call_req. This flag is ignored for<br/>final and single step operations, as well as for nonsuccessful termination of<br/>the request.</p><p>The typical use of this feature is a consumer that initializes a crypto_context,<br/>then submits the parts of the operation as it receives them asynchronously. The<br/>consumer doesn't have a useful thing to do with the information of the<br/>completion of a part of the operation. It is notified only after the final step<br/>is done.</p><p>CRYPTO_SKIP_REQID is set in cr_flag by a client if it does not need a handle for<br/>the request that is submitted. The framework will skip generating a request ID<br/>and will skip the related routines.</p><p>Note that the callback routine for a request with the CRYPTO_SKIP_REQID set can<br/>still be called by the framework, in case an error occurs during the<br/>asynchronous processing of the request. &nbsp;A client using the CRYPTO_SKIP_REQID<br/>flag must make sure the callback routine is valid, and take the necessary<br/>measures to prevent getting modunloaded &nbsp;when it has any pending requests.</p><p>Notes:</p><ol><li>The callback routine can run in an interrupt context, and has to adhere to<br/>the same restrictions as interrupt and timeout handlers (no sleeping, no door<br/>upcalls, no blocking memory allocations, etc.)</li><li>The framework uses the information passed in the crypto_call_req_t structure<br/>to internally build its own requests, but does not keep any reference to that<br/>crypto_call_req_t structure. That structure does not need to persist until the<br/>operation finishes and the call-back routine is invoked (it can be allocated on<br/>the stack of the calling code). However, the cr_callback_f function, and the<br/>cr_callback_arg have to stay valid until either the operation is complete and<br/>the framework calls cr_callback_f, or until the request is canceled.</li><li>Although canceling a request from a multipart operation is likely to make the<br/>whole operation useless, the consumer is responsible for explicitly canceling<br/>all the other pending requests. The consumer is given the choice of canceling<br/>all the requests submitted for one context &nbsp;(cancel_req() vs cancel_ctx()).</li></ol><h3 id="H4.1.3Synchronouscalls"><span>4.1.3 Synchronous calls</span></h3><p>When the caller passes in a NULL crypto_call_req_t pointer, the function is<br/>attempted and possibly blocks. This is typically the case of a consumer code<br/>running in the context of a system call coming from a user process.</p><p>When a request needs to be queued or dispatched to a hardware provider, the<br/>framework will internally schedule it asynchronously, and block until the<br/>operation is complete, then wakeup and return, thus simulating a synchronous<br/>behavior.</p><h3 id="H4.1.4Flowcontrol"><span>4.1.4 Flow control</span></h3><p>When there is a temporary shortage of queue resources to handle a cryptographic<br/>request, the synchronous calls will block until enough are released.<br/>Asynchronous calls will fail with CRYPTO_BUSY.</p><p>The calling code can either tolerate this failure and adapt to it (e.g. dropping<br/>incoming IP packets, retry after some timeout), or may register for a<br/>notification when resources are made available.</p><p>Four routines are provided to this effect:</p><p>crypto_bc_t crypto_bufcall_alloc();<br/>int crypto_bufcall(bc_handle, func, arg);<br/>int crypto_unbufcall(crypto_bc_t bc_handle);<br/>int crypto_bufcall_free(bc_handle)</p><p>The semantics of these routines are similar to the STREAMS bufcall(9F) routine,<br/>with one difference: crypto_bufcall() takes a preallocated bufcall handle, so it<br/>is guaranteed to succeed.</p><p>Note that the client should use bufcall(9F) when it gets a CRYPTO_HOST_MEMORY<br/>error. It should use crypto_bufcall(), for the CRYPTO_BUSY case only.&nbsp;</p><h3 id="H4.1.5Deadlockavoidance"><span>4.1.5 Deadlock avoidance</span></h3><p>Canceling asynchronous crypto requests and bufcalls follows the semantics of<br/>timeout(9F) routine in Solaris. The code that cancels an asynchronous request<br/>must not attempt to acquire a mutex lock that could be acquired by the callback<br/>routine for that request. When the callback routine for a request already<br/>started, the cancel call for that request is guaranteed to block until that<br/>callback is finished.<br/>&nbsp;&nbsp;</p><h2 id="H4.2KernelProviderInterface"><span>4.2 Kernel Provider Interface</span></h2><p>The CSPI (Cryptographic Service Provider Interface) is defined by routines and<br/>constants exported by providers, routines imported by providers, and by data<br/>structures. &nbsp;Routines exported by providers are those that perform cryptographic<br/>operations.&nbsp;</p><p>The following two header files have the constants and data structure<br/>definitions, as well as the prototype declarations of the CSPI &nbsp;routines. They<br/>need to be included by kernel modules and device drivers that use this SPI. They<br/>are attached in Appendix E:</p><p>&nbsp;&lt;sys/crypto/common.h&gt;<br/>&nbsp;&lt;sys/crypto/spi.h&gt;</p><p>Providers import two routines that allow them to register and unregister with<br/>the framework and two routines that notify the framework of changes in status.</p><p>These routines are defined in the following man pages:</p><pre>
    crypto~_provider~_notification(9F)
    crypto~_op~_notification(9F)
    crypto~_register~_provider(9F)
    crypto~_unregister~_provider(9F)
</pre><p>Providers export a set of function vectors &nbsp;for cryptographic operations,<br/>session and cryptographic context management, and for object manipulation. The<br/>function vectors are defined in the following man pages:</p><pre>
    crypto~_cipher~_ops(9S)
    crypto~_control~_ops(9S)
    crypto~_ctx~_ops(9S)
    crypto~_digest~_ops(9S)
    crypto~_dual~_cipher~_mac~_ops(9S)
    crypto~_dual~_ops(9S)
    crypto~_key~_ops(9S)
    crypto~_mac~_ops(9S)
    crypto~_object~_ops(9S)
    crypto~_ops(9S)
    crypto~_provider~_management~_ops(9S)
    crypto~_random~_number~_ops(9S)
    crypto~_session~_ops(9S)
    crypto~_sign~_ops(9S)
    crypto~_verify~_ops(9S)
</pre><p>This CSPI introduces a new "crypto" module type for software cryptographic<br/>modules and device drivers. Software modules in /kernel/crypto have a modlinkage<br/>structure containing a single pointer to a modlcrypto structure. Device drivers<br/>have a modlcrypto pointer as well as a modldrv pointer. Device drivers in<br/>/kernel/crypto have a hard link to their entry in /kernel/drv. 'modlcrypto' is<br/>defined in the modlcrypto(9S) man page.</p><p>The remainder of this section has some additional notes for programmers writing<br/>to this SPI.</p><div class="wikimodel-emptyline"></div><h3 id="H4.2.1LockingConsiderations"><span>4.2.1 Locking Considerations</span></h3><p>The following locking issues must be considered by providers when interacting<br/>with the framework:</p><p>crypto_unregister_provider() can be called from user context only, &nbsp;for example<br/>from the provider detach(9E) routine.</p><p>crypto_unregister_provider() may sleep while pending requests are being<br/>processed by the Provider, and will cause any remaining sessions on the provider<br/>unregistering to be closed. For these reasons, the provider must not hold any<br/>mutex that it may need to acquire from any of the entry points it exports to the<br/>framework.</p><p>The same restrictions apply to the crypto_provider_notification() entry point<br/>exported by the framework.</p><p>Entry points exported by providers to the framework are never &nbsp;invoked from an<br/>interrupt context.</p><p>The crypto_op_notification() can be called by a provider from its interrupt<br/>context while it holds locks.</p><div class="wikimodel-emptyline"></div><h3 id="H4.2.2MultipleRegistrations"><span>4.2.2 Multiple Registrations</span></h3><p>Some cryptographic accelerators may consist of one device with multiple<br/>cryptographic engines, for example one engine for asymmetric operations (RSA,<br/>DSA, etc.) and another engine for symmetric ciphers (3DES, AES, etc.), or two<br/>separate cryptographic engines on a single board. Device drivers for these<br/>devices can register two providers for one device with the framework, which<br/>allows separate scheduling queues to be created, and allows the separate engines<br/>of a single device instance to be flow-controlled independently.</p><p>Providers that register more than once using the same crypto_provider_dev_t<br/>appear as a single device to administrators and users.</p><p>Input and Output Data Buffers</p><p>Data buffers passed to cryptographic operations are specified by crypto_data_t<br/>and crypto_dual_data_t structures.</p><p>Initialization information for block-chaining ciphers can be passed to providers<br/>via the crypto_mechanism structure or the cd_miscdata field in the crypto_data<br/>structure. &nbsp;If the cd_miscdata field is used for update operations, then it<br/>should be set to NULL for all but the first update operation. When cd_miscdata<br/>is used, the initialization information from the crypto_mechanism structure is<br/>ignored.</p><p>When the result of a cryptographic operation is returned by a provider to the<br/>framework, the provider entry point must return the length in bytes of the<br/>output data. Depending on the data format, the provider uses the following<br/>fields to return this value:</p><ul><li>&nbsp;crypto_data_t: cd_length.</li><li>&nbsp;crypto_dual_data_t: dd_len1 if encryption or decryption is the first &nbsp;of the</li><li>&nbsp;dual operation (e.g. encrypt_mac_atomic()), or dd_len2 if encryption or</li><li>&nbsp;decryption is the second of the dual operations (e.g. mac_decrypt_atomic()).</li></ul><h3 id="H4.2.4Recoverableerrors"><span>4.2.4 Recoverable errors</span></h3><p>We define the following error codes as recoverable. All of these error codes<br/>require that the provider does not modify any of the input parameters.</p><p>The provider must return different error codes in cases where the input<br/>parameters are modified. Further to this case, it must return CRYPTO_FAILED, if<br/>no specific error code except one of the following is available:</p><ul><li>CRYPTO_BUFFER_TOO_BIG<br/>Input data buffer too big for this mechanism of the provider. This &nbsp;error code<br/>must not be returned by an update operation.</li></ul><ul><li>CRYPTO_BUSY<br/>This is an optional error code the provider may return if flow controls in<br/>effect. The provider must notify the framework (or already must have notified)<br/>with a crypto_provider_notification(CRYPTO_PROVIDER_BUSY) before &nbsp;returning this<br/>error.</li></ul><ul><li>CRYPTO_DEVICE_ERROR<br/>The device has failed. This error code should be returned for all the pending<br/>requests on the internal wait queue of the provider and any new requests sent to<br/>the provider.</li></ul><p>The provider should notify the framework with a<br/>crypto_provider_notification(CRYPTO_PROVIDER_FAILED, etc.), so that &nbsp;new<br/>requests will not be sent to the provider.</p><ul><li>CRYPTO_DEVICE_MEMORY<br/>Operation failed due to lack of memory on the device. Note that this is<br/>different from CRYPTO_HOST_MEMORY, which is a failure of kmem_alloc().</li></ul><ul><li>CRYPTO_KEY_SIZE_RANGE<br/>The key size is outside the range allowed or possible on this provider for the<br/>mechanism. For example, a non-full strength version of a provider &nbsp;may return<br/>this error for a key size outside its supported range.</li></ul><ul><li>CRYPTO_NO_PERMISSION<br/>The client has no permission to perform operation on the provider. &nbsp;The<br/>permission check mechanism is private to the provider and the client. &nbsp;The<br/>framework does not do any checks.</li></ul><h3 id="H4.2.5Multipartoperations"><span>4.2.5 Multipart operations</span></h3><p>The ctx_provider_private field in the context structure may be used by a<br/>provider to store a pointer to provider-supplied storage. &nbsp;Such storage is<br/>typically allocated by providers in initialization routines such as<br/>digest_init(). &nbsp;If the ctx_provider_private field is NULL, then a provider is<br/>free to use the field. &nbsp;If, however, the field is non-NULL, then pre-initialized<br/>storage is being passed to a provider.</p><p>Note: A provider supporting init/update/final can not fail with<br/>CRYPTO_BUFFER_TOO_BIG during an update. If it can not support this, it should<br/>have only the atomic entry point.</p>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by Administrator on 2009/10/26 12:13<br/>
          </div>
    <div class="xdocLastModification">       Last modified by Administrator on 2009/10/26 12:13
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Project crypto Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+crypto/Accelerators">Hardware Crypto</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/Documentation">Documentation</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+crypto/kcf%2Dman">KCF Man Pages</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/kef_design_spec">kCF Functional Spec</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/signing">Signing crypto modules</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/sunwcry">Strong Crypto and the Encryption Kit</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/completed">Completed Projects</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+crypto/Nylon">Modes Library (Nylon)</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/fips">FIPS 140</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/freeobjects">Hardware Key Generation</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/libmd">libmd &#45; Message Digest Library</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/libsoftcrypto">HL: libsoftcrypto</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/pkcs11_220">PKCS 11 v2.20</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/files">Files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/future">Future Projects</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+crypto/dev_crypto">HL: /dev/crypto engine</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/highlander_libmerge">HL: Library Merge</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/inprogress">Active Projects</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+crypto/padlock">VIA Padlock</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/news_wolfgang_key_prague2008">OSDevCon 2008 &#45; Prague &#45; Wolfgang Ley</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/overview">Overview</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+crypto/test_debug">Test & Debug</a></span></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2013, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
