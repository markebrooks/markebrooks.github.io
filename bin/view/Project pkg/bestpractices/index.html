<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>Best Practices (Project pkg.bestpractices) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Project+pkg/bestpractices" />
                    <link rel="canonical" href="/bin/view/Project+pkg/bestpractices" />
                            <meta name="document" content="Project pkg.bestpractices"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Project pkg"/>
    <meta name="page" content="bestpractices"/>
    <meta name="version" content="1.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Project+pkg/pages/bestpractices"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="Best Practices" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="Administrator" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Project pkg";
XWiki.currentPage = "bestpractices";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Project+pkg/bestpractices";
window.docediturl = "/bin/edit/Project+pkg/bestpractices";
window.docsaveurl = "/bin/save/Project+pkg/bestpractices";
window.docgeturl = "/bin/get/Project+pkg/bestpractices";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Project_pkg viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FProject%2Bpkg%2Fbestpractices"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+pkg/"><strong>Project pkg</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Project+pkg" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <div id="header_banner">
	<table style="width: 100%;">
	    <tr>
		<td style="width: 1%;">
		    <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>  
		</td>
		<td id="logo-text" style="width: 1%;">
		    Solaris
		</td>         
		<td style="width: 98%;">
		    <table id="loading-indicator">
			<tr>
			    <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
				    alt="Loading" title="Loading"/></td>
			    <td>Loading...</td>
			</tr>
		    </table>
		</td>
		<td style="width: 1%;">
		    <table id="iconbar">
			<tr>
			<td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
			    Collectives</a></td>
			<td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
				Discussions</a></td>
			<td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
				Documentation</a></td>
			<td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
				Download</a></td>
			<td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
				Source Browser</a></td>
			</tr>
		    </table>
		</td>
	    </tr>
	</table>
    </div>
    <div id="site-notice">
	<span>
	    <a href="https://markebrooks.github.io/bin/view/Main/">ATTENTION: This website and all services within the opensolaris.org domain will be unavailable after March 24, 2013.</a>	   
	</span>
    </div>
</div>
 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Project+pkg/devinfo'>Developer information</a> <span class='separator'>&#187;</span> <span class='current'>Best Practices</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Project+pkg/bestpractices?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Project+pkg/bestpractices?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+pkg/bestpractices?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+pkg/bestpractices?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+pkg/bestpractices?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Project+pkg/bestpractices?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+pkg/bestpractices?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+pkg/bestpractices?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Project+pkg/bestpractices?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Project+pkg/bestpractices?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Project+pkg/bestpractices?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Project+pkg/bestpractices?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








    
<div id="document-title"><h1>Best Practices</h1></div>





              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h2 id="HBestPracticesforDevelopers"><span>Best Practices for Developers</span></h2><p>The objective of this page is to bring together best practices for developers working on pkg, meant to enhance its supportability and usability. This document does not intend to be a comprehensive guide to the processes and tools used to assemble and deliver packages.</p><hr/><h3 id="HTableofContents"><span>Table of Contents</span></h3><ul><li>Build Framework</li><li>Multi-Platform Considerations</li></ul><hr/><h3 id="HBuildFramework"><span>Build Framework</span></h3><p>There are two build frameworks currently in use for pkg(5): The <em>Make</em> framework, and the <em>distutils</em> framework. The Makefile provides a wrapper around the distutils setup.py, adding functionality that is specific to OpenSolaris. Anything that is intended to be cross-platform is implemented using the distutils framework. OpenSolaris-specific functionality (e.g. ability to convert a host of SVR4 packages into pkg(5) packages) is implemented in additional Makefiles and is then called by the top-level Makefile. Unless you have a specific reason to use the <em>Make</em> framework, you should use the <em>distutils</em> framework, even when building on OpenSolaris.</p><ul><li>==== distutils (setup.py)<br/>This framework is based on Python's <span class="wikiexternallink"><a href="http://docs.python.org/dist/dist.html">Distutils</a></span> framework, and provides a platform-independent interface for building and distributing pkg(5). To use this framework, you must have a Python 2.4 distribution installed on your build machine. The following commands assume the <span class="box code">python</span> command is accessible (e.g. in your <span class="box code">$PATH</span>).<ul><li><span class="box code">python setup.py <span style="color: #666666; ">~--</span>help<span style="color: #666666; ">-</span>commands</span> - Command help information, including the pkg(5)-specific command additions. Note that most of the generic distutils commands are useful to the pkg(5) developer.</li><li><span class="box code">python setup.py build</span> - Builds everything, including binary modules, C extensions, and front-end CLIs. The results are placed in ../proto/build_&lt;os&gt;.</li><li><span class="box code">python setup.py install</span> - Does a <span class="box code">build</span>, builds dependencies and then creates a <em>prototype</em> area in ../proto/root_&lt;os&gt; containing a hierarchy of files intended to represent what pkg(5) looks like when installed on a particular OS.</li><li><span class="box code">python setup.py bdist <span style="color: #666666; ">-</span>&nbsp;</span>Creates a <em>binary distribution</em> of the resulting build. This is in most cases a simple zip or gzipped tarball of the relocatable pkg(5) binaries.</li><li><span class="box code">python setup.py clean</span> - Un-does what <span class="box code"><span style="color: #666666; ">~--</span>build</span> did: Removes binary artifacts.</li><li><span class="box code">python setup.py clobber</span> - Un-does what <span class="box code">make <span style="color: #666666; ">~--</span>install</span> did. This removes the prototype area and the dependencies.</li><li><span class="box code">python setup.py lint</span> - Runs the pkg(5) C Extension source code through the <span class="box code">lint</span> checker. In addition, runs the pkg(5) pure Python source code through <em>pylint</em>. It is assumed <em>pylint</em> has been installed into the python installation area <em>site-packages</em>).</li><li><span class="box code">python setup.py test</span> - Runs unit and functional tests. This should be run as root, e.g., with pfexec or sudo.</li></ul></li><li>==== Makefiles<br/>To use the <em>make</em> framework to build pkg(5), one must build on a machine installed with Solaris or OpenSolaris. The following main <span class="box code">make</span> targets are available:<ul><li><span class="box code">make link</span> - Connects your local machine to the current repository's working copy's version of the commands, modules, and supporting files.</li><li><span class="box code">make link<span style="color: #666666; ">-</span>clean</span> - Un-does what <span class="box code">make link</span> did</li><li><span class="box code">make all</span> - Does a setup.py build, followed by builds of OpenSolaris-specific modules.</li><li><span class="box code">make install</span> - Does a setup.py install, followed by installs of OpenSolaris-specific modules such as the packagemanager GUI, update notifier, brand, and the miscellaneous utilities.</li><li><span class="box code">make clean</span> - Un-does what <span class="box code">make all</span> did: Removes binary artifacts.</li><li><span class="box code">make clobber</span> - Un-does what <span class="box code">make install</span> did: Does a <span class="box code">make clean</span> followed by removing the <em>prototype</em> files</li><li><span class="box code">make test</span> - Runs unit and functional tests. This should be run as root, e.g., with pfexec or sudo.</li><li><span class="box code">make test<span style="color: #666666; ">-</span>verbose</span> - Same as <span class="box code">make test</span>, only with more output useful for debugging unit tests themselves. ==== The following makefile policy is in effect</li><li>An incremental build when nothing has changed must do nothing except traverse makefiles. Like this:</li></ul></li></ul><pre>
     $ make
     /net/xanadu/aux0/ws/makefile-fixes/src/web
     /net/xanadu/aux0/ws/makefile-fixes/src/gui
     /net/xanadu/aux0/ws/makefile-fixes/src/um
     /net/xanadu/aux0/ws/makefile-fixes/src/po
     /net/xanadu/aux0/ws/makefile-fixes/src/util/misc
     /net/xanadu/aux0/ws/makefile-fixes/src/brand
     /usr/bin/python setup.py build
     running build
     running build_py
     running build_ext
     $
</pre><ul><li><ul><li>This also applies to "make install" and other targets.</li><li>If any portion of a build fails, make must exit w/ a non-zero exit status.</li><li>clobber and clean should work properly:<ul><li>clean should delete *all* artifacts of the build that occur in the source hierarchy (like .o files).</li><li>clobber should depend on clean, and should destroy from the proto area all components which are placed there by "install"</li></ul></li><li>Test each target with a clean workspace (i.e. hg clone your workspace to get a virgin one, and test builds there). Test install targets by deleting the proto area and rebuilding.</li></ul></li></ul><h3 id="HMulti-PlatformBestPractices"><span>Multi-Platform Best Practices</span></h3><p>pkg(5) was originally designed for use with OpenSolaris. However, the underlying concepts and usefulness apply more broadly. This fact, coupled with the fact that pkg(5) is currently implemented using a mostly cross-platform language (python) has led the team to produce and maintain pkg(5) in a portable manner for use in projects like <span class="wikiexternallink"><a href="http://wiki.updatecenter.java.net/">Update Center</a></span>, which is developing tooling based on a <span class="wikiexternallink"><a href="http://wiki.updatecenter.java.net/Wiki.jsp?page=IPSAssessment">multi-platform pkg(5)</a></span>. This has a non-trivial impact to pkg(5) developers, who must take care when evolving pkg(5) to do so in a way that allows pkg(5) to continue to be portable to other platforms.<br/>This does not mean platform-specific characteristics and features cannot be used in pkg(5). For example, <span class="wikilink"><a href="/bin/view/Community+Group+zfs/">OpenSolaris' ZFS</a></span> is used to implement some or all of pkg(5)' rollback capability. However, it does mean the implementation must either make an attempt to implement a degraded version of rollback on when not used on OpenSolaris, <strong>or</strong> the feature must be gracefully disabled and appropriate warnings issued when the feature would normally be employed.</p><h4 id="HWritingportablePythonThefollowingnotesandbestpracticesaidthepkg28529developerinkeepingpkg28529portable."><span>Writing portable Python<br/>The following notes and best practices aid the pkg(5) developer in keeping pkg(5) portable.</span></h4><ul><li><ul><li><strong>Best Practice: Avoid non-portable APIs</strong><br/>Python has a number of useful libraries that can be sourced when looking for an implementation. Unfortunately, many of them, especially those at the OS/file layer, are not portable. When code containing calls to these APIs is encountered on platforms where the APIs are not available, an ugly error occurs, and system integrity may even be compromised. Therefore, it is important to avoid these APIs whenever possible. When an API is only available on a subset of major platform types, it is usually denoted in the API Documentation. For example, see the <span class="wikiexternallink"><a href="http://docs.python.org/lib/os-file-dir.html">Python API Documentation for the <span class="box code">os</span> module</a></span> for several examples of non-portable APIs. Look for notes like <em>"Availability: Macintosh, Unix"</em> (which is an example of an API not available on Microsoft Windows)</li><li><strong>Best Practice: Use <span class="box code">pkg.portable</span> module for platform-specific functionality</strong><br/>If it is imperative that you use a platform-specific API, a special OS abstraction layer is present in pkg(5) which defines, in abstract terms, operations that are typically implemented using platform-specific methods. At runtime, pkg(5) selects which underlying implementation of this interface to load, based on the runtime platform.<br/>This allows developers to keep platform-specific code cordoned off in specific modules that are only loaded when a compatible platform is in use. Platform-neutral code (that which makes up the bulk of pkg(5)) can call these interfaces through this abstraction layer. See the documentation present in the <span class="box code"></span> module for more information.</li><li><strong>Best Practice: Be aware of variations in return values</strong><br/>Some Python operating system-level library routines have different return values on different platforms under certain error conditions. For example, when os.rmdir is called on a existing directory that contains files, Solaris returns errno.EEXIST, but Linux returns errno.ENOTEMPTY. Another example is when shutil.rmtree is called on a non-existent directory. Solaris return errno.ENOENT, but Windows returns errno.ESRCH. When calling these methods, try to copy code from another place within pkg(5) that is already doing the same thing. It probably has the error checking correct already.</li><li><strong>Best Practice: Avoid filesystem specifics</strong><br/>The concept of filesystems is pretty universal when it comes to the platforms pkg(5) is intended to support. However, there are some differences, especially between Microsoft Windows and other OS's. In particular, the concepts found in the filesystem implementations are "similar but different". For example, Windows has the concept of a <em>drive</em> (e.g. "C:\"), which is not found on Unix. Also, filesystem separators tend to be different (however over time Windows has evolved to recognize and properly deal with "/" in many cases).<br/>When using python to explore the filesystem and construct paths, if you have code that deals with the root of the filesystem in any way, be sure to account for the fact that the root looks different on Windows, and that one cannot assume that "/" is the root of the filesystem. Python has the ability to discover the "drive" portion of paths, using <span class="xwikirenderingerror">Failed to execute the [code] macro</span><span class="xwikirenderingerrordescription hidden"><tt class="wikimodel-verbatim">org.xwiki.rendering.macro.MacroExecutionException: Failed to highlight content
	at org.xwiki.rendering.internal.macro.code.CodeMacro.parseContent(CodeMacro.java:108)
	at org.xwiki.rendering.internal.macro.code.CodeMacro.parseContent(CodeMacro.java:48)
	at org.xwiki.rendering.macro.box.AbstractBoxMacro.execute(AbstractBoxMacro.java:125)
	at org.xwiki.rendering.macro.box.AbstractBoxMacro.execute(AbstractBoxMacro.java:51)
	at org.xwiki.rendering.internal.transformation.macro.MacroTransformation.transformOnce(MacroTransformation.java:184)
	at org.xwiki.rendering.internal.transformation.macro.MacroTransformation.transform(MacroTransformation.java:129)
	at org.xwiki.rendering.internal.transformation.DefaultTransformationManager.performTransformations(DefaultTransformationManager.java:72)
	at com.xpn.xwiki.doc.XWikiDocument.performSyntaxConversion(XWikiDocument.java:7483)
	at com.xpn.xwiki.doc.XWikiDocument.performSyntaxConversion(XWikiDocument.java:7432)
	at com.xpn.xwiki.doc.XWikiDocument.getRenderedContent(XWikiDocument.java:835)
	at com.xpn.xwiki.doc.XWikiDocument.getRenderedContent(XWikiDocument.java:783)
	at com.xpn.xwiki.doc.XWikiDocument.getRenderedContent(XWikiDocument.java:878)
	at com.xpn.xwiki.api.Document.getRenderedContent(Document.java:545)
	at sun.reflect.GeneratedMethodAccessor306.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.velocity.util.introspection.UberspectImpl$VelMethodImpl.doInvoke(UberspectImpl.java:389)
	at org.apache.velocity.util.introspection.UberspectImpl$VelMethodImpl.invoke(UberspectImpl.java:378)
	at org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:270)
	at org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:252)
	at org.apache.velocity.runtime.parser.node.ASTReference.value(ASTReference.java:493)
	at org.apache.velocity.runtime.parser.node.ASTExpression.value(ASTExpression.java:71)
	at org.apache.velocity.runtime.parser.node.ASTSetDirective.render(ASTSetDirective.java:142)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:72)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:336)
	at org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:106)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:336)
	at org.xwiki.velocity.internal.DefaultVelocityEngine.evaluate(DefaultVelocityEngine.java:196)
	at org.xwiki.velocity.internal.DefaultVelocityEngine.evaluate(DefaultVelocityEngine.java:161)
	at com.xpn.xwiki.render.XWikiVelocityRenderer.evaluate(XWikiVelocityRenderer.java:116)
	at com.xpn.xwiki.XWiki.evaluateTemplate(XWiki.java:1895)
	at com.xpn.xwiki.XWiki.parseTemplate(XWiki.java:1833)
	at com.xpn.xwiki.api.XWiki.parseTemplate(XWiki.java:860)
	at sun.reflect.GeneratedMethodAccessor109.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.velocity.util.introspection.UberspectImpl$VelMethodImpl.doInvoke(UberspectImpl.java:389)
	at org.apache.velocity.util.introspection.UberspectImpl$VelMethodImpl.invoke(UberspectImpl.java:378)
	at org.apache.velocity.runtime.parser.node.ASTMethod.execute(ASTMethod.java:270)
	at org.apache.velocity.runtime.parser.node.ASTReference.execute(ASTReference.java:252)
	at org.apache.velocity.runtime.parser.node.ASTReference.render(ASTReference.java:332)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:72)
	at org.apache.velocity.runtime.directive.VelocimacroProxy.render(VelocimacroProxy.java:212)
	at org.apache.velocity.runtime.directive.RuntimeMacro.render(RuntimeMacro.java:247)
	at org.apache.velocity.runtime.parser.node.ASTDirective.render(ASTDirective.java:175)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:72)
	at org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:87)
	at org.apache.velocity.runtime.parser.node.ASTBlock.render(ASTBlock.java:72)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:336)
	at org.apache.velocity.runtime.parser.node.ASTIfStatement.render(ASTIfStatement.java:106)
	at org.apache.velocity.runtime.parser.node.SimpleNode.render(SimpleNode.java:336)
	at org.xwiki.velocity.internal.DefaultVelocityEngine.evaluate(DefaultVelocityEngine.java:196)
	at org.xwiki.velocity.internal.DefaultVelocityEngine.evaluate(DefaultVelocityEngine.java:161)
	at com.xpn.xwiki.render.XWikiVelocityRenderer.evaluate(XWikiVelocityRenderer.java:116)
	at com.xpn.xwiki.XWiki.parseTemplate(XWiki.java:1943)
	at com.xpn.xwiki.XWiki.evaluateTemplate(XWiki.java:1856)
	at com.xpn.xwiki.web.Utils.parseTemplate(Utils.java:154)
	at com.xpn.xwiki.web.XWikiAction.execute(XWikiAction.java:226)
	at com.xpn.xwiki.web.XWikiAction.execute(XWikiAction.java:117)
	at org.apache.struts.action.RequestProcessor.processActionPerform(RequestProcessor.java:431)
	at org.apache.struts.action.RequestProcessor.process(RequestProcessor.java:236)
	at org.apache.struts.action.ActionServlet.process(ActionServlet.java:1196)
	at org.apache.struts.action.ActionServlet.doGet(ActionServlet.java:414)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.xpn.xwiki.web.ActionFilter.doFilter(ActionFilter.java:129)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at com.xpn.xwiki.wysiwyg.server.filter.ConversionFilter.doFilter(ConversionFilter.java:152)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.xwiki.container.servlet.filters.internal.SavedRequestRestorerFilter.doFilter(SavedRequestRestorerFilter.java:218)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.xwiki.container.servlet.filters.internal.SetCharacterEncodingFilter.doFilter(SetCharacterEncodingFilter.java:112)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:433)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
	at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:568)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:845)
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:354)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.Thread.run(Thread.java:662)
Caused by: Traceback (most recent call last):
  File "&lt;string&gt;", line 1, in &lt;module&gt;
NameError: name 'listener' is not defined

	at org.python.core.PyException.fillInStackTrace(PyException.java:70)
	at java.lang.Throwable.&lt;init&gt;(Throwable.java:181)
	at java.lang.Exception.&lt;init&gt;(Exception.java:29)
	at java.lang.RuntimeException.&lt;init&gt;(RuntimeException.java:32)
	at org.python.core.PyException.&lt;init&gt;(PyException.java:46)
	at org.python.core.PyException.&lt;init&gt;(PyException.java:43)
	at org.python.core.PyException.&lt;init&gt;(PyException.java:61)
	at org.python.core.Py.NameError(Py.java:246)
	at org.python.core.PyFrame.dellocal(PyFrame.java:319)
	at org.python.pycode._pyx17675422.f$0(&lt;string&gt;:1)
	at org.python.pycode._pyx17675422.call_function(&lt;string&gt;)
	at org.python.core.PyTableCode.call(PyTableCode.java:165)
	at org.python.core.PyCode.call(PyCode.java:18)
	at org.python.core.Py.runCode(Py.java:1261)
	at org.python.core.Py.exec(Py.java:1305)
	at org.python.util.PythonInterpreter.exec(PythonInterpreter.java:206)
	at org.xwiki.rendering.internal.parser.pygments.PygmentsParser.highlight(PygmentsParser.java:248)
	at org.xwiki.rendering.internal.parser.pygments.PygmentsParser.highlight(PygmentsParser.java:193)
	at org.xwiki.rendering.internal.macro.code.CodeMacro.highlight(CodeMacro.java:146)
	at org.xwiki.rendering.internal.macro.code.CodeMacro.parseContent(CodeMacro.java:105)
	... 92 more
</tt></span>. This API is available on all platforms, but returns '' (empty string) when not on Windows.<br/><strong>Path separators</strong> - Unix uses "/", Windows uses "<br/>". In general, python APIs can deal with either one, regardless of platform. So, things like <span class="box code">os.path.exists("<span style="font-weight: italic; color: #408080; ">%s/%s/%s", d1, d2, file)</span></span> generally work as expected. However, be careful when comparing filesystem paths using <em>string</em> operations. Doing things like <span class="box code">mypath.split("<span style="color: #666666; ">/</span>")</span> is bad, since <span class="box code">mypath</span>, if representative of a path to a file or directory, would likely be in its platform-specific representation. (use <span class="box code">os.path.pathsep</span>, or even better, split it up using the <span class="box code">os.path.split</span> API). In general, be aware that processing paths using string functions is dangerous and should be avoided.</li><li><strong>Best Practice: Avoid APIs with behavioral differences</strong><br/>Python has many cross-platform APIs that are universally available. However, many of them behave differently (usually because the underlying OS implementation is different). For example, <span class="box code">os.unlink()</span> deletes files, but on Windows, if a file is "in use", this API throws an exception. It's certainly possible to write code to properly deal with these, but in general it's best to avoid it, to minimize the bugs and maximize portability. Consult python documentation for more information on behavioral differences such as these.</li><li><strong>Best Practice: Use EnvironmentError</strong> If you look at <span class="wikiexternallink"><a href="http://docs.python.org/lib/module-exceptions.html">python's built-in exceptions</a></span>, there are a few that are worth mentioning in the context of writing portable code. Take a look at this code:</li></ul></li></ul><pre>
    try:
      f = file("%s/filters" % some_path), "r")
    except IOError, e:
      if e.errno != errno.ENOENT:
        raise
</pre><p>&nbsp;In this example, python's built-in <span class="box code">file()</span> function is used. The documentation for this API states "If the file cannot be opened, IOError is raised". However, on Windows, if the file cannot be opened, an OSError is raised. It's unfortunate that the python documentation is ambiguous in this regard, so when dealing with failures relating to files, it is best to use EnvironmentError.</p><ul><li><ul><li><strong>Best Practice: Test C Extensions on Linux</strong><br/>pkg(5) currently contains some python extensions written in C: the <span class="box code">arch</span> extension for getting access to lower-level OpenSolaris platform characteristics, and the <span class="box code">elf</span> extension for reading information from within ELF files. The <span class="box code">elf</span> C code is portable to other Unix operating systems which use the ELF format (e.g. Linux), using <span class="box code">[[libelf<span style="color: #666666; ">&gt;&gt;</span>http:<span style="color: #666666; ">//</span>directory.fsf.org<span style="color: #666666; ">/</span>project<span style="color: #666666; ">/</span>libelf<span style="color: #666666; ">/</span>]]</span>, an open source library for accessing ELF libraries. However, there are still some differences. For example, the <span class="box code">EM_AMD64</span> constant is <span class="box code">EM_X86_64</span> when using libelf. In addition, the routines used to calculate SHA-1 hashes come from a built-in library (<span class="box code">libmd</span>) on OpenSolaris, but must use <span class="wikiexternallink"><a href="http://openssl.org/">OpenSSL</a></span> on other platforms. These differences manifest themselves as several <span class="box code"><span style="font-weight: italic; color: #408080; ">#ifdef</span></span>s in the C extensions. If you are making changes to this code, it is best to test on a Linux platform using this library.</li><li><strong>Best Practice: write relocatable code</strong><br/>As noted earlier, pkg(5) was originally developed for use on OpenSolaris, with some bootstrapping assumptions about its installed location. However, modern pkg(5) now makes no absolute assumptions about its installed locations, and makes references to its needed external files using relative references or paths passed in from the external user. Therefore, you should never make assumptions about the installed location of pkg(5) itself. It may be completely installed and isolated in <span class="box code">x:<span style="color: #666666; ">\</span>Program Files<span style="color: #666666; ">\</span>Sun<span style="color: #666666; ">\</span>MessageQueue<span style="color: #666666; ">\</span>pkg</span>, or it may be installed into <span class="box code"><span style="color: #666666; ">/</span>usr</span>. pkg(5) code that requires external resources should always make relative references to its files, based on the known location of the package front-end at runtime, and its location relative to the needed files. This would also apply to any future library-level interface, using some kind of $ORIGIN interface for location discovery.</li><li><strong>Best Practice: Write unit tests to test known platform differences</strong><br/>If you develop new functionality that has known differences between platforms, make sure to supply new unit or other tests that test that the expected differences have been properly dealt with.<br/>In addition to python APIs, the use of external resources for testing purposes should be limited to those that exist across all platforms, when required. For example, do not assume the presence of "/bin/ls" for tests that test functionality that is expected to work on Windows.</li></ul></li></ul><h4 id="HTestingPortabilityAsnotedabove2Catabareminimum2Ctestinginvolvesrunningthesuppliedtesttargets28usingtheappropriatebuildinfrastructure29.Ideally2Cthiswouldbeexecutedonallplatformsonwhichpkg28529isexpectedtooperate.Generally2CtheOpenSolarisdevelopersthatworkonpkg28529onlytestonOpenSolaris.TheUpdateCenterteammembersthatareresponsibleforportingpkg28529tootherplatformstakecareofdoingthistestingonotherplatforms."><span>Testing Portability<br/>As noted above, at a bare minimum, testing involves running the supplied <em>test</em> targets (using the appropriate build infrastructure). Ideally, this would be executed on <strong>all</strong> platforms on which pkg(5) is expected to operate. Generally, the OpenSolaris developers that work on pkg(5) only test on OpenSolaris. The Update Center team members that are responsible for porting pkg(5) to other platforms take care of doing this testing on other platforms.</span></h4>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by Administrator on 2009/10/26 12:16<br/>
          </div>
    <div class="xdocLastModification">       Last modified by Administrator on 2009/10/26 12:16
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Project pkg Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+pkg/FAQ">FAQ</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/Mirroring">Mirroring repositories</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/Renamed">OpenSolaris Packages Renamed in Oracle Solaris 11 Express</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/add_package">Adding Packages to IPS</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/devinfo">Developer information</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+pkg/IPS+for+Consolidations">IPS for Consolidations</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/bestpractices">Best Practices</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/rtinotes">Integration Notes</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/documents">Documentation</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+pkg/May2008">Getting Started with IPS for 2008.05</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/Nov2008">Getting Started with IPS for 2008.11</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/Using+repositories">Repositories</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/files">Files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+pkg/testing">Testing</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+pkg/testplan">Test Plan</a></span></li>
</ul></li>
</ul>
                              </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2013, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
