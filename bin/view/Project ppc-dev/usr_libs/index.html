<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
                    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                                    <title>User Libraries (Project ppc-dev.usr_libs) - XWiki</title>
                <meta http-equiv="Content-Script-Type" content="text/javascript" />
                        <meta http-equiv="imagetoolbar" content="no"/>
                      <link rel="alternate" type="application/x-wiki" title="Edit" href="/bin/edit/Project+ppc%2Ddev/usr_libs" />
                    <link rel="canonical" href="/bin/view/Project+ppc%2Ddev/usr_libs" />
                            <meta name="document" content="Project ppc-dev.usr_libs"/>
    <meta name="wiki" content="xwiki"/>
    <meta name="space" content="Project ppc-dev"/>
    <meta name="page" content="usr_libs"/>
    <meta name="version" content="1.1"/>
    <meta name="restURL" content="/rest/wikis/xwiki/spaces/Project+ppc-dev/pages/usr_libs"/>
                <meta name="gwt:property" content="locale=en" />
                <meta name="revisit-after" content="7 days" />
<meta name="description" content="User Libraries" />
<meta name="keywords" content="wiki " />
<meta name="distribution" content="GLOBAL" />
<meta name="rating" content="General" />
<meta name="author" content="admin" />
<meta http-equiv="reply-to" content="" />
<meta name="language" content="en" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="alternate" type="application/rss+xml" title="Wiki Feed RSS" href="/bin/view/Main/WebRss?xpage=rdf" />
<link rel="alternate" type="application/rss+xml" title="Blog RSS Feed" href="/bin/view/Blog/GlobalBlogRss?xpage=plain" />
<link rel="shortcut icon" href="/resources/icons/oso/icon.png">
                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
<link href="https://markebrooks.github.io/static/css/stylesheet.css" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/style.css?colorTheme=ColorThemes.Oso" rel="stylesheet" type="text/css" media="all" />
<link href="/bin/skin/skins/colibri/print.css" rel="stylesheet" type="text/css" media="print" />
        <!--[if IE]>
  <link href="/bin/skin/skins/colibri/ie%2Dall.css" rel="stylesheet" type="text/css" />
<![endif]-->
<!--[if IE 6]>
  <link href="/bin/skin/skins/colibri/ie%2D6.css" rel="stylesheet" type="text/css" />
<![endif]-->
<link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Settings?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/AnnotationCode/Style?language=en'/><link rel='stylesheet' type='text/css' href='/bin/ssx/XWiki/SharePage?language=en'/>
<link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/modalPopup.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/js/xwiki/widgets/jumpToPage.css?language=en'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/confirmationBox.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/resources/uicomponents/widgets/notification.css'/><link rel='stylesheet' type='text/css' href='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.css'/>

    
    <link href="/bin/skin/resources/js/xwiki/suggest/ajaxSuggest.css" rel="stylesheet" type="text/css" />
<link href="/bin/skin/resources/js/xwiki/lightbox/lightbox.css" rel="stylesheet" type="text/css" />
<!--[if IE]>
  <link href="/bin/skin/resources/js/xwiki/lightbox/lightboxIE.css" rel="stylesheet" type="text/css" />
<![endif]-->












<script type="text/javascript" src="/resources/js/prototype/prototype.js"></script>
<script type="text/javascript" src="/bin/skin/resources/js/xwiki/xwiki.js"></script>
<script type="text/javascript">
// <![CDATA[
XWiki.webapppath = "";
XWiki.servletpath = "bin/";
XWiki.contextPath = "";
XWiki.mainWiki = "xwiki";
XWiki.currentWiki = "xwiki";
XWiki.currentSpace = "Project ppc-dev";
XWiki.currentPage = "usr_libs";
XWiki.editor = "";
XWiki.viewer = "";
XWiki.contextaction = "view";
XWiki.docisnew = false;
XWiki.docsyntax = "xwiki/2.0";
XWiki.blacklistedSpaces = [ "Import","Panels","Scheduler","Stats","XAppClasses","XAppSheets","XAppTemplates","XWiki","WatchCode","WatchSheets","XApp","WatchAdmin","Watch","ColorThemes","AnnotationCode" ];
XWiki.hasEdit = false;
XWiki.hasProgramming = false;
XWiki.hasBackupPackImportRights = false;
window.docviewurl = "/bin/view/Project+ppc%2Ddev/usr_libs";
window.docediturl = "/bin/edit/Project+ppc%2Ddev/usr_libs";
window.docsaveurl = "/bin/save/Project+ppc%2Ddev/usr_libs";
window.docgeturl = "/bin/get/Project+ppc%2Ddev/usr_libs";
// ]]>
</script>
<script type='text/javascript' src='/bin/skin/resources/js/scriptaculous/effects.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/modalPopup.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/js/xwiki/widgets/jumpToPage.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmationBox.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/confirmedAjaxRequest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/resources/uicomponents/widgets/notification.js' defer='defer'></script>
<script type='text/javascript' src='/resources/uicomponents/widgets/list/xlist.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/suggest/ajaxSuggest.js' defer='defer'></script>
<script type='text/javascript' src='/bin/skin/skins/colibri/resources/uicomponents/viewers/tags.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/scriptaculous/scriptaculous.js' defer='defer'></script>
<script type='text/javascript' src='/resources/js/xwiki/accordion/accordion.js' defer='defer'></script>

<script type='text/javascript' src='/bin/jsx/XWiki/WebDAV?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Settings?language=en' defer='defer'></script>
<script type='text/javascript' src='/bin/jsx/AnnotationCode/Script?language=en' defer='defer'></script>

<script type="text/javascript" src="/resources/js/xwiki/compatibility.js" defer="defer"></script>

  </head>
  <body id="body" class="wiki-xwiki space-Project_ppc-dev viewbody hideright">
<div id="xwikimaincontainer">
<div id="xwikimaincontainerinner">

  <div id="menuview">
    <div id="mainmenu" class="layoutsubsection actionmenu">
<strong id="xwikimenutitle" class="hidden">General Actions:</strong>
<div class="rightmenu">
      <div id="tmLogin" class="tmLogin topmenuentry ">
   <a class="tme" href="https://auth.opensolaris.org/login.action?targetUrl=http%3A%2F%2Fmarkebrooks.github.io%2Fbin%2Fview%2FProject%2Bppc%252Ddev%2Fusr_libs"><strong>Log-in</strong></a>
  </div>
  </div>
<div class="leftmenu">
  <div id="tmWiki" class="tmWiki topmenuentry hasIcon">
   <a class="tme" href="/bin/view/Main/"><strong>Wiki</strong></a>
  </div>
  <div id="tmSpace" class="tmSpace topmenuentry dropdownmenuentry  hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+ppc%2Ddev/"><strong>Project ppc-dev</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
                <span class="submenuitem "><a href="/bin/view/Main/SpaceIndex?space=Project+ppc%2Ddev" id="tmSpaceDocumentIndex" class="tmSpaceDocumentIndex">Document Index</a></span>
    </span></div>

<div id="tmSubSites" class="tmSubSites topmenuentry dropdownmenuentry dropdownnolink hasIcon" onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Subsites</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem hasIcon"><a href="https://cr.opensolaris.org/" id="tmCR" class="tmCR">Code Reviews</a></span>
<span class="submenuitem hasIcon"><a href="http://repo.opensolaris.org/" id="tmRepo" class="tmRepo">SCM Management</a></span>
<span class="submenuitem hasIcon"><a href="http://pkg.opensolaris.org/" id="tmPkg" class="tmPkg">Package Search</a></span>
<span class="submenuitem hasIcon"><a href="http://bugs.opensolaris.org/" id="tmBugs" class="tmBugs">Bugster</a></span>
<span class="submenuitem hasIcon"><a href="http://defect.opensolaris.org/" id="tmDefect" class="tmDefect">Bugzilla</a></span>
<span class="submenuitem hasIcon"><a href="http://test.opensolaris.org/" id="tmTest" class="tmTest">Test Machines</a></span>
<span class="submenuitem hasIcon"><a href="http://planet.opensolaris.org/" id="tmPlanet" class="tmPlanet">Planet</a></span>
<span class="submenuitem hasIcon"><a href="http://mail.opensolaris.org/" id="tmMail" class="tmMail">Mailing Lists</a></span>
<span class="submenuitem hasIcon"><a href="http://poll.opensolaris.org/" id="tmPoll" class="tmPoll">Elections &amp; Polls</a></span>
<span class="submenuitem hasIcon"><a href="http://arc.opensolaris.org/" id="tmArc" class="tmArc">ARC Case Logs</a></span>
<span class="submenuitem hasIcon"><a href="http://jucr.opensolaris.org/" id="tmJucr" class="tmJucr">Source Juicer</a></span>
<span class="submenuitem hasIcon"><a href="http://pkgfactory.opensolaris.org/" id="tmPkgfactory" class="tmPkgfactory">Package Factory</a></span>
<span class="submenuitem hasIcon"><a href="http://auth.opensolaris.org/" id="tmAuth" class="tmAuth">Auth</a></span>
</span></div>

</div>
</div>

  </div>
 <div id="header" class="layoutsection">
<div class="minwidthb"></div>

  <div id="header">
    <table style="width: 100%;">
        <tr>
            <td style="width: 1%;">
                 <a href="https://markebrooks.github.io/bin/view/Main/"><div id="logo"></div></a>
            </td>
            <td style="width: 99%;">
                <table id="loading-indicator">
                    <tr>
                        <td><img src="https://markebrooks.github.io:443/static/images/busy.gif"
                                 alt="Loading" title="Loading"/></td>
                        <td>Loading...</td>
                    </tr>
                </table>
            </td>
            <td style="width: 1%;">
                <table id="iconbar">
                    <tr>
                    <td><a id="collectives-icon" href="https://markebrooks.github.io/bin/view/Main/collectives">
                        Collectives</a></td>
                    <td><a id="discussions-icon" href="https://markebrooks.github.io/bin/view/Main/discussions">
                            Discussions</a></td>
                    <td><a id="documentation-icon" href="https://markebrooks.github.io/bin/view/Main/documentation">
                            Documentation</a></td>
                    <td><a id="download-icon" href="https://markebrooks.github.io/bin/view/Main/downloads">
                            Download</a></td>
                    <td><a id="source-browser-icon" href="http://src.opensolaris.org/source">
                            Source Browser</a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
</div>

 </div> 
  <div id="globallinks">
    <form action="/bin/view/Main/Search">
      <div class="globalsearch">
        <label class="hidden" for="headerglobalsearchinput">Search</label><input class="globalsearchinput withTip" id="headerglobalsearchinput" type="text" name="text" value="search..." size="15"/><input class="button" type="image" value="Go" alt="Go" src="/resources/icons/xwiki/search.png"/>
      </div>
    </form>
  </div> <div style="float:left;">

                

   <div id="hierarchy">
                              <a href='/bin/view/Project+ppc%2Ddev/task_map'>Project Task Map</a> <span class='separator'>&#187;</span> <span class='current'>User Libraries</span>
                </div>

</div>
  <span class="glink" id="headerlanguages" style="float:right">
        <a href="/bin/view/Project+ppc%2Ddev/usr_libs?language=en" class="language-default language-current">en</a>
    </span>


<div class="contenthideright" id="contentcontainer">
<div id="contentcontainerinner">
<div class="leftsidecolumns">
  <div id="contentcolumn"> 
          <div class="main layoutsubsection">
      <div id="contentmenu" class="actionmenu">
    <strong id="xwikicontentmenutitle" class="hidden">Page Actions:</strong>
<div class="rightmenu">
</div>
<div class="leftmenu">
  <div id="tmExport" class="tmExport topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>Export</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/export/Project+ppc%2Ddev/usr_libs?format=pdf&amp;language=en" id="tmExportPdf" class="tmExportPdf">Export as PDF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+ppc%2Ddev/usr_libs?format=rtf&amp;language=en" id="tmExportRtf" class="tmExportRtf">Export as RTF</a></span>
  <span class="submenuitem "><a href="/bin/export/Project+ppc%2Ddev/usr_libs?format=html&amp;language=en" id="tmExportHtml" class="tmExportHtml">Export as HTML</a></span>
    </span></div>

<div id="tmShow" class="tmShow topmenuentry dropdownmenuentry  " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme" href="/bin/view/Project+ppc%2Ddev/usr_libs?viewer=code&amp;language=en"><strong>View</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
<span class="submenuitem "><a href="/bin/view/Project+ppc%2Ddev/usr_libs?viewer=comments&amp;language=en" id="tmViewComments" class="tmViewComments">Comments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+ppc%2Ddev/usr_libs?viewer=attachments&amp;language=en" id="tmViewAttachments" class="tmViewAttachments">Attachments</a></span>
<span class="submenuitem "><a href="/bin/view/Project+ppc%2Ddev/usr_libs?viewer=history&amp;language=en" id="tmViewHistory" class="tmViewHistory">History</a></span>
<span class="submenuitem "><a href="/bin/view/Project+ppc%2Ddev/usr_libs?viewer=information&amp;language=en" id="tmViewInformation" class="tmViewInformation">Information</a></span>
<span class="submenuitem "><a href="/bin/view/Project+ppc%2Ddev/usr_libs?viewer=code&amp;language=en" id="tmViewSource" class="tmViewSource">View Source</a></span>
</span></div>

  <div id="tmMoreActions" class="tmMoreActions topmenuentry dropdownmenuentry dropdownnolink " onmouseover="showsubmenu(this);" onmouseout="hidesubmenu(this);">
<span class="tme-extensible">
   <a class="tme"><strong>More actions</strong></a>
    <span class="hidden menucolon">: </span>
</span><span class="submenu hidden">
  <span class="submenuitem "><a href="/bin/view/Project+ppc%2Ddev/usr_libs?xpage=print&amp;language=en" id="tmPrintPreview" class="tmPrintPreview">Print preview</a></span>
          <span class="submenuitem "><a href="/bin/view/Project+ppc%2Ddev/usr_libs?xpage=copy" id="tmActionCopy" class="tmActionCopy">Copy</a></span>
      </span></div>
</div>

    </div>
    <div id="mainContentArea">
      








                      
<div id="document-title"><h1>User Libraries</h1></div>

              <div id="document-info">
    <div>
          </div>
    <div class="clearfloats"></div>
  </div>

<div id="xwikicontent">
<h2 class='hidden'>User Libraries</h2><h3 id="HStatus022F112F09"><span>Status 02/11/09</span></h3><p>libc now builds cleanly along with a number of additional libs. Please consult the README.polaris or the usr/src/lib/README.ppc for specifics on the details. Make sure you have the latest updated /opt/onbld tools. On a fresh repo pull you first must build genassym and assym.h in the libc/ppc dir as follows&nbsp;</p><p>make genassym<br/>make assym.h</p><p>Then use the following in /libc or the root /lib.&nbsp;</p><p>CHECK_FNAMES=/bin/true make install</p><h3 id="HStatus112F022F07"><span>Status 11/02/07</span></h3><p>Many of the shared libraries are now building. If you do a make -k install in usr/src/lib you'll get a good pass at a number of them. The GNU toolchain has an issue with creating incorrect relocations. Basically if you have a recursive call in a function of the primary function you will get the following after the link stage.</p><p>text relocation failed</p><p>To correct this declare the called func extern within the func.&nbsp;</p><p>Others may show up.</p><p>For libnsl we had to create the front end language for g++ and cpp. &nbsp;You will need to update your GNU toolchain and install the ones we have created.</p><h3 id="Hlibcstatus012F082F2007"><span>libc status 01/08/2007</span></h3><p>Outline:</p><p>*How lib/ppc was made<br/><strong>Copy and modify<br/></strong>Trend toward more portable code<br/><strong>Makefile.com</strong></p><p>*What is in libc - Issues</p><ul><li>&nbsp;*genassym</li><li>&nbsp;*C Preprocessor used for asm</li><li>&nbsp;*pre-ANSI C function prototypes</li><li>&nbsp;*Assembly code</li><li>&nbsp;*Floating-point</li><li>&nbsp;*Unimplemented functions<br/>*Porting Schedule<br/>*Testing<br/>*Documentation</li></ul><h3 id="HHowlibc2Fppcwasmade"><span>How libc/ppc was made</span></h3><h4 id="HCopyandmodify"><span>Copy and modify</span></h4><p>-<del>-<br/>Many aspects of Solaris/PPC, not just libc, are made by copying existing <br/>code and modifying. &nbsp;It is a judgement call, made on a case-by-case basis, <br/>what existing code to use as the starting point.</del></p><p>Sometimes, it is best to start from the old Solaris/PPC 2.6 code. This is almost always appropriate for small leaf nodes that deal more with instruction-set architecture, which has not changed much over the last decade. &nbsp;Other times, it seems better to start with modern (ONNV) code for another processor, and modify for PowerPC. This is more appropriate for things that interact with operating system services, where the interfaces may have changed considerably.</p><p>Then, there is the question of which processor to use as a starting point. &nbsp;Our current work on 32-bit PowerPC is more like x86 in some ways, but more like Sparc in other ways.</p><p>PowerPC is more like x86:</p><ol><li>Both are 32-bit only. &nbsp;Yes, there are 64-bit PowerPC machines, but we are not porting to those, yet. &nbsp;Yes, there are 64-bit x86 machines, but that is practically a different ISA, so we need not consider that for our purposes, here.&nbsp;</li><li>Both are little-endian, see note:1 , so layout of some data structures can be cribbed off of IA32 code.</li><li>Both carve out a portion of each userland process address space for the kernel address space, whereas sparc has its own completely separate kernel address space. <br/>1.There is no dynamic reconfiguration to deal with, so physical memory management is easier.</li></ol><p>PowerPC is more like sparc:</p><ol><li>Both are big-endian, see note:1, so layout of some data structures can be cribbed off of sparc code.</li><li>Both have 32 general-purpose (integer) registers, whereas x86 has significantly fewer registers and almost none are truly general-purpose. &nbsp;And, as a consequence ...</li><li>Both almost always pass all function arguments in registers, whereas x86 must almost always pass arguments on the stack.&nbsp;</li><li>Both have 32-bit, 64-bit, and 128-bit binary IEEE 754 floating-point and a set of directly addressed floating-point registers, whereas x86 has its own 80-bit extended format, and has a mixed bag of floating-point stack and SSE &nbsp;registers.</li><li>Both use some form of OpenFirmware.</li></ol><p>note:1 PowerPC can work in big-endian or little-endian mode. Solaris/PPC supports both. &nbsp;Solaris 2.6 code was little-endian only; Solaris 2.11 code is big-endian, but code is written to work both ways. &nbsp;Some libc functions were built using a merge of x86 and sparc code for 2.11, and Tim Marsland's 2.6 PPC big-endian workspace.</p><h4 id="HTrendtowardmoreportablecode"><span>Trend toward more portable code</span></h4><p>-<del>-</del></p><p>Solaris 2.6 had a relatively small amount of code in usr/src/lib/libc/port <br/>and more code in usr/src/lib/libc/${ISA} for each instruction-set architecture.</p><div class="wikimodel-emptyline"></div><p>The trend over the last decade has been to rely more on libc/port. &nbsp;This has <br/>been driven by the higher cost of maintaining code for more processors, and by <br/>faster processors and better compilers making it less important to do <br/>isa-specific optimizations using hand-code assembly language.</p><p>Many libc/ppc functions from Solaris/PPC 2.6 were abandoned. That is, they <br/>simply did not make it into the port to Solaris/PPC 2.11. And, good riddance. &nbsp;<br/>The libc/port function was used, instead. There are probably yet more libc/ppc 2.6 functions that could be removed, after a more careful review. &nbsp;I am not <br/>completely confident that my first pass did the job perfectly. &nbsp;It was a pretty <br/>quick-and-dirty first pass.</p><p>Makefile.com<br/>-<del>-</del></p><p>The starting point for the file, usr/src/lib/libc/ppc/Makefile.com was <br/>usr/src/lib/libc/i386/Makefile.com. &nbsp;There are some files that have a <br/>corresponding name, such as i386_data.o vs. ppc_data.o. There are files that <br/>exist only in i386, such as lxstat.o, xmknod.o and xstat.o. &nbsp;So far, these <br/>difference have been an annoyance, because, when there are changes to 2.11 <br/>libc/i386, it is very likely that we want to make the corresponding change to <br/>libc/ppc, but automatic merging of Makefile.com can fail due to mismatches in <br/>surrounding context. &nbsp;I am considering coming up with empty files for lxstat.o, <br/>xmknod.o, and xstat.o, and maybe making a few other changes, just to make <br/>automatic merging easier.</p><h4 id="HWhatisinlibc"><span>What is in libc</span></h4><p>-<del>-</del></p><p>Subdirectories<br/>-<del>-<br/>Each processor (and libc/port) has the following subdirectories:<br/>*crt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;C runtime<br/>*etc<br/>*fp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;floating-point functions<br/>*gen &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;general-purpose<br/>*inc &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header files<br/>*sys &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system calls (not header files, like other 'sys' directories)<br/>*threads<br/>*unwind</del></p><p><span class="wikicreatelink"><a href="/bin/create/+More+detail+to+be+added%2C+later/++%2D%2D+Guy+Shaw+?parent=Project+ppc%2Ddev.usr_libs"><span class="wikigeneratedlinkcontent">  -- Guy Shaw </span></a></span></p><div class="wikimodel-emptyline"></div><h4 id="HIssues"><span>Issues</span></h4><p>-<del>-</del></p><p>genassym<br/>-<del>-<br/>genassym.c and offset.in &nbsp;have the same issues as genassym<br/>in usr/src/uts. &nbsp;The compiler used on the build machine<br/>must be an x86 compiler, which does not necessarily produce<br/>the same results as a PowerPC compiler, for things like<br/>offsets within data structures.</del></p><p>As more libc functions are fleshed out, this problem may<br/>get worse. &nbsp;But, if we move to a strategy of doing more in<br/>C, taking advantage of GNU C <strong>inline</strong> <strong>asm</strong> functions,<br/>then the problem might be reduced, or go away, entirely.<br/>But, since there are many .s files in libc/port, they<br/>would have to be taken care of by a more clever, more<br/>general-purpose solution. &nbsp;But, it could be done.</p><p>C Preprocessor used for asm<br/>-<del>-<br/>Cpp is not a general-purpose preprocessor. &nbsp;It is specialized<br/>for the C programming language. &nbsp;That specialization has<br/>advantages and disadvantages.</del></p><p>Any attempt to use cpp for anything other than C programs<br/>is likely to run into trouble. &nbsp;The less like C the subject<br/>programming language, the more likely it is that there will<br/>be some problem with comments, token-pasting behavior,<br/>line continuation, preprocessor arithmetic, or something.<br/>The problems get worse if there is much in the way of "clever"<br/>use of preprocessor features, such as using token pasting to<br/>construct identifiers from fragments of identifiers.</p><p>Construction of identifiers using ANSI C token pasting fails<br/>for assembly language in the case of local identifiers that<br/>start with '.'. &nbsp;A period is not part of a valid C identifier,<br/>so token ANSI C token pasting will not work. &nbsp;Unfortunately,<br/>this is not some exotic corner case; construction of local<br/>identifiers is very useful. &nbsp;It would not do to confine<br/>construction of identifiers to global symbols.</p><p>Token pasting is also used to create symbols of the form:<br/>identifier@qualifier, where 'qualifier' is 'ha', 'la', 'plt',<br/>etc. &nbsp;Sparc has similar kinds of symbols. &nbsp;Fortunately,<br/>whitespace is allowed between identifier and qualifier.<br/>But that just means we lucked out on that issue, not that<br/>we can ignore the cpp problem.</p><p>There is a significant amount of code in Solaris that depends<br/>on Sun's cpp, which suppresses null comments entirely, rather<br/>than treating them is a single space. &nbsp;This is used to construct<br/>identifiers a/<strong>/b, where 'ab' is the identifier that is needed.<br/>This code occurs not only in processor-specific code all processors,<br/>but in common code.</strong></p><p>Due to the legacy of common code, Solaris/PPC 2.11 continues to rely<br/>Sun's cpp.</p><p>pre-ANSI C function prototypes<br/>-<del>-<br/>Much of the C code that came from Solaris/PPC 2.6 has<br/>C functions with pre-ANSI C prototypes. &nbsp;The code builds,<br/>and much of it probably still works. &nbsp;But, it would be<br/>nice to convert to ANSI-C prototypes. &nbsp;Of course, the most<br/>portable thing to do would be to use the preprocessor and<br/>generate both ANSI and K&amp;R function declarations, but I<br/>don't know if anyone cares about that, now.&nbsp;</del></p><p>Some converted code is present, as long as I was visiting it for<br/>some other reasoning, but it is not completeI. &nbsp;Not even close.</p><p>Assembly code<br/>-<del>-<br/>Assembly language code from Solaris/PPC 2.6 has had to<br/>be modified, partly to account for differences in notation,<br/>but mostly to update the mnemonics used.</del></p><p>Some changes are to ensure correct code for both 32-bit and 64-bit<br/>hardware, others are changes in usage of simplified mnemonics.</p><p>Here is a table of opcodes that have had to be modified.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old &nbsp;&nbsp;&nbsp;&nbsp;new &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;page[2] note<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-<del>- &nbsp;-</del>- &nbsp;&nbsp;&nbsp;-<del>- &nbsp;-</del>-<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp &nbsp;&nbsp;&nbsp;&nbsp;cmpw &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8-28 &nbsp;&nbsp;&nbsp;cmp, L=0<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmpi &nbsp;&nbsp;&nbsp;cmpwi &nbsp;&nbsp;&nbsp;&nbsp;8-29 &nbsp;&nbsp;&nbsp;cmpi, L=0<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmpl &nbsp;&nbsp;&nbsp;cmplw &nbsp;&nbsp;&nbsp;&nbsp;8-30 &nbsp;&nbsp;&nbsp;cmpl, L=0<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmpli &nbsp;&nbsp;cmplwi &nbsp;&nbsp;&nbsp;8-31 &nbsp;&nbsp;&nbsp;cmpli, L=0<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sl &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;slw &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8-158<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sli &nbsp;&nbsp;&nbsp;&nbsp;slwi &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8-155 &nbsp;&nbsp;rlwinm<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sri &nbsp;&nbsp;&nbsp;&nbsp;srwi &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8-155 &nbsp;&nbsp;rlwinm</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1] page: Page number in MPCFPE32B, Rev. 3, 2005/09.</p><div class="wikimodel-emptyline"></div><p>Floating-point<br/>-<del>-<br/>libc/ppc/fp -- quadruple (128-bit) floating-point arithmetic.</del></p><ul><li>Not in i386; In sparc; some in sparcv9</li><li>Low priority</li><li>Reference:<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title: Doubled-Precision IEEE Standard 754 Floating-Point Arithmetic<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Author: Kahan, W.<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date: 1987-Feb-26</li><li>Reference:<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Title: Software for Doubled-Precision Floating-Point Computations<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Author: Linnainmaa, Seppo<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ACM TOMS vol 7 no 3, September 1981, pages 272-283<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Date: 1981-Sep</li></ul><p>See also, &lt;section&gt;Testing&lt;/section&gt; for testing of floating-point.</p><p><span class="wikicreatelink"><a href="/bin/create/+Fill+in+more+detail/++%2D%2D+Guy+Shaw+?parent=Project+ppc%2Ddev.usr_libs"><span class="wikigeneratedlinkcontent">  -- Guy Shaw </span></a></span></p><div class="wikimodel-emptyline"></div><h4 id="HUnimplementedfunctions"><span>Unimplemented functions</span></h4><p>-<del>-<br/>Many functions in libc/ppc are not implemented, at all, or<br/>are partially coded, but have some portion that is unimplemented.<br/>These can be located by looking for two patterns:</del></p><ol><li>calls to libc_unimplemented()</li><li>preprocessor directives that conditionally compile<br/>based on preprocessor symbols of the form XXX_*</li></ol><p>All calls to libc_unimplemented() in C code pass no arguments.<br/>So you can find all calls by searching for the string,<br/>'libc_unimplemented()'.</p><p>In assembly language, all occurrence can be found by searching<br/>for the regular expression, 'bl\t+libc_unimplemented', where '\t'<br/>is a tab.</p><p>Searching for all calls to libc_unimplemented and for all<br/>/^#if.*defined(XXX_/ would generate a pretty complete list<br/>of things to do. &nbsp;However, that list contains no information<br/>about priority (urgency and/or importance), schedule, or<br/>anything else. &nbsp;See &lt;section&gt;Porting Schedule&lt;/section&gt;.</p><h4 id="HPortingSchedule"><span>Porting Schedule</span></h4><p>-<del>-<br/>In order to meet our next milestone, userland process,<br/>we do not really need any libraries, not even libc. &nbsp;We<br/>can create a statically linked program that does its own<br/>traps to do system calls directly. &nbsp;But, the milestone<br/>after that, single user prompt with Bourne shell, would<br/>require at least a good bit of libc, and some other libraries.</del></p><p>If we do things in the "natural" order, that is, if we wait<br/>until userland processes work before we write and test libc<br/>functions, then there will be considerable extra delay in<br/>the schedule. &nbsp;A great deal of writing and testing needs<br/>to be done "out of order", before <em>any</em> testing can be done<br/>on a live system running Solaris/PPC.</p><p>See the section, &lt;section&gt;Testing&lt;/section&gt;, immediately below.</p><p>We will definitely need many of the general-purpose functions</p><p>and system calls. &nbsp;We can probably skip many less frequently<br/>called functions. &nbsp;I have not done a detailed analysis of<br/>what is needed. &nbsp;I will probably run truss on Bourne shell<br/>to collect the list of functions and system calls it really<br/>needs just to come up and do something light-duty but<br/>realistic. &nbsp;We want to make "accomodations" for early<br/>bringup, but we don't want to cross the line, where we<br/>would be just plain cheating.</p><p>We can probably postpone work on floating-point. &nbsp;However,<br/>that has not changed much, so we might do it because it is<br/>cheap, and effectively just comes along for the ride, since<br/>much of the cost of porting and testing can be shared.<br/>Thorough testing of floating-point arithmetic, on the other<br/>hand, can be very costly.</p><p>I am hoping that single-user prompt using Bourne shell<br/>will not require any support for multi-threading. &nbsp;Threads<br/>is one of those areas that had undergone a great deal of<br/>revision over the last decade, including Roger Faulkner's<br/>"great reform". &nbsp;This is one area of libc that might better<br/>done by throwing away all Solaris/PPC 2.6 code and starting<br/>anew from Solaris/x86 2.11.</p><p>What I fear is that, even though Bourne shell does not<br/>require fully functional multi-threading support, the<br/>new thread model means that support for multi-threading<br/>is an integral part of even the simplest process, and<br/>so, in modern Solaris, it can never again be treated<br/>as a bolt-on. &nbsp;That is as it should be. &nbsp;But, it means<br/>we may have to implement the bulk of the libc/ppc/thread<br/>functions, up front.</p><p>Testing<br/>-<del>-</del></p><p>A nice thing about working on libraries is that,<br/>except for things like libc/ppc/sys (system calls),<br/>almost everything can be tested on a hosted system,<br/>with the same ISA. &nbsp;For example, Linux on an Apple.</p><p>Test suite</p><ul><li>QA at Sun<br/><tt class="wikimodel-verbatim">
    Q: Are Sun's test suites available under CDDL license?
  * Low priority background task for me: obtain info about
    Sun's QA arsenal for testing libraries, especially libc.
</tt></li></ul><p>Paranoia - for testing floating-point</p><ul><li>Low priority background task for me: obtain, build, and test Paranoia</li></ul><p>Documentation<br/>-<del>-</del></p><p>Show work<br/>-<del>-<br/>Much of the existing Solaris code gets low marks for documentation<br/>because the source code lacks background material, an overview of<br/>program logic, rationale, original work, etc. &nbsp;Only polished code<br/>makes it into the gate. &nbsp;Everything else is jettisoned.</del></p><div class="wikimodel-emptyline"></div><div class="wikimodel-emptyline"></div><div class="wikimodel-emptyline"></div><div class="wikimodel-emptyline"></div>
</div>


    <div class="clearfloats"></div>
  </div>      <div id="xdocFooter">
  
                

       <div class="doc-tags" id="xdocTags">
        Tags:
        </div>
  
  <div id="xdocAuthors">
    <div class="xdocCreation">       Created by admin on 2009/10/26 12:17<br/>
          </div>
    <div class="xdocLastModification">       Last modified by admin on 2009/10/26 12:17
    </div>
  </div>
</div>
<div id="xwikidata" class="layoutsubsection">
        </div>  
    </div>      </div><div id="leftPanels" class="panels left">
                  <div class="panel expanded OSNav">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSNav');">Collectives</h1>
<div class="xwikipanelcontents">
<div id="xwikinavcontainer">
<span class="wikilink"><a href="/bin/view/Main/communities">Community Groups</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/projects">Projects</a></span><br/>
<span class="wikilink"><a href="/bin/view/Main/usergroups">User Groups</a></span>
</div><p/>
<script type="text/javascript">
document.observe('xwiki:dom:loaded', function() {
var obj = {div:'xwikinav',no:$count,height:250};
var acc = createAccordion(obj);
});
</script>
</div>
</div>
                        <div class="panel expanded OSDocs">
<h1 class="xwikipaneltitle" onclick="XWiki.togglePanelVisibility(this.parentNode, 'XWiki.XWikiGuest_Panels.OSDocs');">Project ppc-dev Pages</h1>
<div class="xwikipanelcontents">
<ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/GetStarted">Getting Started</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/faq">FAQ</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/files">Files</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/kickstart">Kickstarting OpenSolaris on PowerPC</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/status">Status</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/task_map">Project Task Map</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/atomic">Low Level Atomic Operations</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/bld_env">GNU Toolchain and Host Environment</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/boot_ldr">Bootloader &#45; Net/Disc</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/cache_behav">Cache Behavior</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/cbe">Cyclic Backend &#45; Timers</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/chk_res">Checkpoint and Restore</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/console">Console Items</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/ctf">CTF &#45; Compressed Text Format</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/ddi">DDI &#45; Device Driver Interface</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/dtrace">DTrace</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/hw_tools">Hardware Tools for the Target</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/inst">Installer</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/ism">ISM</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/kern_init">Kernel Inititalization</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/kmdb_mdb">KMDB / MDB / PMDB</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/krn_swtch">Kernel  Context Switching</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/krtld">Kernel Runtime Loader</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/modstubs">Module Stubs</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/mp">MP Support</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/openfirm">Openfirmware &#45; VOF</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/panic">Panic Handling</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/psm">Platform Specific Modules</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/root_nex">Root Nexus</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/rtld_ld">RTLD and ld</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/sys_calls">System Calls</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/traps">Exceptions, Traps and Interrupts</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/usr_libs">User Libraries</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/usr_swtch">User Context Switching</a></span></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/vm">Virtual Memory &#45; HAT</a></span></li>
</ul></li>
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/tools">Project Tools</a></span><ul class="star">
<li><span class="wikilink"><a href="/bin/view/Project+ppc%2Ddev/proj_xtra">Project Extras</a></span></li>
</ul></li>
</ul>
                    </div>
</div>
      </div>

  </div>
<div class="clearfloats"></div>
  </div></div><div id="footerglobal" class="layoutsection">
<div class="minwidth"></div>
<hr/>
        <div id="xwikiplatformversion">XWiki Enterprise 2.7.1.34853 - <a onclick="openURL('http://enterprise.xwiki.org/xwiki/bin/view/Main/Documentation', '_blank'); return false;" href="http://www.xwiki.org/xwiki/bin/view/Main/Documentation">Documentation</a></div>
<br/>
  
      <div id="footer">
    <p>
                <a href="https://markebrooks.github.io/bin/view/Main/tou/">Terms of Use</a>
                |
                <a href="http://www.oracle.com/html/privacy.html">Privacy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/trademark/">Trademarks</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/copyrights/">Copyright Policy</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site_guidelines/">Site Guidelines</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/site-map/">Site Map</a>
                |
                <a href="https://markebrooks.github.io/bin/view/Main/help/">Help</a>
                <br/>Your use of this web site or any of its content or software indicates your agreement to be bound by these Terms of Use.<br/>
                &copy; 2011, Oracle Corporation and/or its affiliates.<br/><img src="https://markebrooks.github.io:443/static/images/logo_oracle_footer.gif" alt="Oracle Logo"/>
            </p>
        </div>

  
</div>

</div></div></body>
</html>
